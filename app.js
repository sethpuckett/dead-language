!function(e){function t(t){for(var a,o,r=t[0],l=t[1],h=t[2],c=0,d=[];c<r.length;c++)o=r[c],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&d.push(s[o][0]),s[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(u&&u(t);d.length;)d.shift()();return n.push.apply(n,h||[]),i()}function i(){for(var e,t=0;t<n.length;t++){for(var i=n[t],a=!0,r=1;r<i.length;r++){var l=i[r];0!==s[l]&&(a=!1)}a&&(n.splice(t--,1),e=o(o.s=i[0]))}return e}var a={},s={0:0},n=[];function o(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=a,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(i,a,function(t){return e[t]}.bind(null,a));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/dead-language/";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var h=0;h<r.length;h++)t(r[h]);var u=l;n.push([539,1]),i()}({1443:
/*!**********************************!*\
  !*** ./js/main.js + 101 modules ***!
  \**********************************/
/*! no exports provided */
/*! all exports used */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/firebase/app/dist/index.cjs.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/firebase/firestore/dist/index.esm.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/firebaseui/dist/esm.js (<- Module uses injected variables (module, global)) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/phaser/src/phaser.js (<- Module is not an ECMAScript module) */function(e,t,i){"use strict";i.r(t);var a=i(1),s=i.n(a),n={zombieBounce:"zombie-bounce",zombieWalk:"zombie-walk",zombieRun:"zombie-run",zombieFall:"zombie-fall",zombieDamage:"zombie-damage",zombieDie:"zombie-die",zombieStun:"zombie-stun",zombieAttack:"zombie-attack",shotBlastExplode:"shot-blast-explode",shotgunBlastExplode:"shotgun-blast-explode",shotBlastGreenExplode:"shot-blast-green-explode",shotgunBlastGreenExplode:"shotgun-blast-green-explode",shotBlastBottleExplode:"shot-blast-bottle-explode",shotBlastDirtExplode:"shot-blast-dirt-explode",bottle1Explode:"bottle1-explode",popWhitePop:"pop-white-pop",frames:{zombieBounce:[0,1,2,3],zombieWalk:[6,7,8,9],zombieRun:[12,13,14,15,16,17],zombieFall:[18,19,20,21],zombieDamage:[24,25,26,26],zombieDie:[26,24,24,24],zombieStun:[30,31,32,33],zombieAttack:[36,36,36,36,36,37,38],shotBlastExplode:[0,1,1,2,2,3],shotgunBlastExplode:[0,1,1,2,2,3],shotBlastGreenExplode:[0,1,1,2,2,3],shotgunBlastGreenExplode:[0,1,1,2,2,3],shotBlastBottleExplode:[0,1,1,2,2,3],shotBlastDirtExplode:[0,1,1,2,2,3],bottle1Explode:[0,1,2,3,4,5,6],popWhitePop:[2,0,1,3]},frameRates:{zombieBounce:8,zombieWalk:6,zombieRun:12,zombieFall:15,zombieDamage:10,zombieDie:15,zombieStun:8,zombieAttack:10,shotBlastExplode:20,shotBlastGreenExplode:20,shotBlastBottleExplode:15,shotBlastDirtExplode:20,bottle1Explode:13,popWhitePop:12}},o=!1,r={minigame:{background:0,splatter:1,itemTextBackground:2,itemText:3,item:4,itemPop:5,zombieTextBackground:1e3,zombieText:1001,zombie:2e3,shotBlast:4e3},titleMenu:{sky:0,backGrass:1,backZombies:2,trees:11,frontZombies:12,frontGrass:21,text:22},story:{background:0},hud:{buffer:900,uiBackground:901,ui:902,entryText:903},vocabStudy:{background:0,objects:1,bottle:2,shotBlast:3,wordBackground:3,word:4},modal:{fade:1e4,bg:10001,border:10002,text:10003},choiceModal:{fade:1e4,bg:10001,border:10002,text:10003,selector:10003},townMap:{border:10,mapGrid:10,requirementLine:11,lessonPin:12},endgame:{background:0,text:1},optionsMenu:{background:0,text:1,selector:2},registration:{background:0,text:1}},l=.2,h="none",u="menu-move",c="menu-select-shoot",d="menu-select-wave",g="menu-backout",m="click",p="buzz",f="thud",b="glass-break",y="hit-pistol",v="hit-shotgun",w="item-get",k="item-spawn",S="zombie-attack",T="merc-hit",I="shot-miss",x="out-of-ammo",O={menuMove:"assets/audio/menu-move.mp3",menuSelectShoot:"assets/audio/menu-select-shoot.mp3",menuSelectWave:"assets/audio/menu-select-wave.mp3",menuBackout:"assets/audio/menu-backout.mp3",buzz:"assets/audio/buzz.mp3",click:"assets/audio/click.mp3",thud:"assets/audio/thud.mp3",glassBreak:"assets/audio/glass-break.mp3",hitPistol:"assets/audio/hit-pistol.mp3",hitShotgun:"assets/audio/hit-shotgun.mp3",itemGet:"assets/audio/item-get.mp3",itemSpawn:"assets/audio/item-spawn.mp3",zombieAttack:"assets/audio/zombie-attack.mp3",mercHit:"assets/audio/merc-hit.mp3",shotMiss:"assets/audio/shot-miss.mp3",outOfAmmo:"assets/audio/out-of-ammo.mp3"},M={carousingEveryNight:"carousing-every-night",inTheBackPocket:"in-the-back-pocket",catchTheMystery:"catch-the-mystery",inEarlyTime:"in-early-time",zombieAssaultIntro:"zombie-assault-intro",zombieAssaultLoop:"zombie-assault-loop",zombieAssaultReviewIntro:"zombie-assault-review-intro",zombieAssaultReviewLoop:"zombie-assault-review-loop",cheerfulPiano:"cheerful-piano",outOfMyDreams:"out-of-my-dreams",theLameDuck:"the-lame-duck",files:{carousingEveryNight:"assets/audio/carousing-every-night.mp3",inTheBackPocket:"assets/audio/in-the-back-pocket.mp3",catchTheMystery:"assets/audio/catch-the-mystery.mp3",inEarlyTime:"assets/audio/in-early-time.mp3",zombieAssaultIntro:"assets/audio/zombie-assault-intro.mp3",zombieAssaultLoop:"assets/audio/zombie-assault-loop.mp3",zombieAssaultReviewIntro:"assets/audio/zombie-assault-review-intro.mp3",zombieAssaultReviewLoop:"assets/audio/zombie-assault-review-loop.mp3",cheerfulPiano:"assets/audio/cheerful-piano.mp3",outOfMyDreams:"assets/audio/out-of-my-dreams.mp3",theLameDuck:"assets/audio/the-lame-duck.mp3"}},P={win:"win",lose:"lose",winText:"You did it!",loseText:"Let's get out of here!",screenFadeTime:750,audio:{music:{winMusic:M.cheerfulPiano,loseMusic:M.theLameDuck},soundEffects:{menuMove:u,menuSelect:c},musicConfig:{winMusic:{rate:1.25},loseMusic:{detune:-300}}},fonts:{statusSize:32,statusTint:16776994,menuSize:22,menuTint:16777215},menu:{returnToMap:"Return to Map",tryAgain:"Try Again",targetPractice:"Target Practice",returnToTitle:"Return to Title"}},B={spawnRows:3,baseSpawnRate:3e3,spawnRange:1500,baseFrontRunSpeed:60,frontRunRange:4,baseBackRunSpeed:35,backRunRange:2,screenFadeTime:750,loginPointerRotation:.08*Math.PI,loginPointerExpansionFactor:1.5,loginPointerExpansionDuration:500,loginText:["Sign in or register","to play the full game!"],audio:{menuMove:u,menuSelect:c},menu:{newGame:"New Game",continueGame:"Continue Game",playDemo:"Play Demo",options:"Options"},fonts:{textSize:22,textTint:16777215,instructionsSize:12,instructionsTint:16777215,loginSize:12,loginTint:16776994},instructions:"Use arrow keys and Spacebar to choose"},W={zombieNormal1:"zombie-normal-1",zombieNormal2:"zombie-normal-2",zombieNormal3:"zombie-normal-3",zombieNormal4:"zombie-normal-4",zombieNormal5:"zombie-normal-5",zombieNormal6:"zombie-normal-6",zombieSpecial1:"zombie-special-1",zombieSpecial2:"zombie-special-2",zombieReview1:"zombie-review-1",zombieReview2:"zombie-review-2",grass:"grass",hudItemBorder:"hud-item-border",hudMessageBorder:"hud-message-border",hudMenuBorder:"hud-menu-border",heart:"heart",skull:"skull",goldCoin:"gold-coin",watch:"watch",health:"health",brick:"brick",shotBlast:"shot-blast",shotBlastGreen:"shot-blast-green",shotgunBlast:"shotgun-blast",shotgunBlastGreen:"shotgun-blast-green",shotBlastBottle:"shot-blast-bottle",shotBlastDirt:"shot-blast-dirt",bloodSplatter:"blood-splatter",bloodSplatter1:"blood-splatter-1",bloodSplatter2:"blood-splatter-2",bloodSplatter3:"blood-splatter-3",bloodSplatter4:"blood-splatter-4",bloodSplatter5:"blood-splatter-5",bloodSplatter6:"blood-splatter-6",bloodSplatterGreen:"blood-splatter-green",bloodSplatterGreen1:"blood-splatter-green-1",bloodSplatterGreen2:"blood-splatter-green-2",bloodSplatterGreen3:"blood-splatter-green-3",bloodSplatterGreen4:"blood-splatter-green-4",bloodSplatterGreen5:"blood-splatter-green-5",bloodSplatterGreen6:"blood-splatter-green-6",zombieFace:"zombie-face",titleScreenBackground:"title-screen-background",titleScreenBgFrontGrass:"title-screen-bg-front-grass",titleScreenBgTrees:"title-screen-bg-trees",titleScreenBgBackGrass:"title-screen-bg-back-grass",titleScreenBgSky:"title-screen-bg-sky",crate:"crate",bottle1:"bottle1",bottle1Base:"bottle1-base",bottle1Piece1:"bottle1-piece1",bottle1Piece2:"bottle1-piece2",bottle1Piece3:"bottle1-piece3",bottle1Explode:"bottle1-explode",shotgun:"shotgun",dirtPile:"dirt-pile",yellowBubble:"yellow-bubble",colorSquare:"color-square",mercenary:"mercenary",weapon:"weapon",cash:"cash",popWhite:"pop-white",foodTier1:"food-tier-1",storyScreenBackground:"story-screen-background",pointingHand:"pointing-hand",files:{zombieNormal1:"assets/images/zombie-normal-1.png",zombieNormal2:"assets/images/zombie-normal-2.png",zombieNormal3:"assets/images/zombie-normal-3.png",zombieNormal4:"assets/images/zombie-normal-4.png",zombieNormal5:"assets/images/zombie-normal-5.png",zombieNormal6:"assets/images/zombie-normal-6.png",zombieSpecial1:"assets/images/zombie-special-1.png",zombieSpecial2:"assets/images/zombie-special-2.png",zombieReview1:"assets/images/zombie-review-1.png",zombieReview2:"assets/images/zombie-review-2.png",grass:"assets/images/grass.png",hudItemBorder:"assets/images/hud-item-border.png",hudMessageBorder:"assets/images/hud-message-border.png",hudMenuBorder:"assets/images/hud-menu-border.png",heart:"assets/images/heart.png",skull:"assets/images/skull.png",goldCoin:"assets/images/gold-coin.png",watch:"assets/images/watch.png",health:"assets/images/health.png",brick:"assets/images/brick.png",shotBlast:"assets/images/shot-blast.png",shotBlastGreen:"assets/images/shot-blast-green.png",shotgunBlast:"assets/images/shotgun-blast.png",shotgunBlastGreen:"assets/images/shotgun-blast-green.png",shotBlastBottle:"assets/images/shot-blast-bottle.png",shotBlastDirt:"assets/images/shot-blast-dirt.png",bloodSplatter1:"assets/images/blood-splatter-1.png",bloodSplatter2:"assets/images/blood-splatter-2.png",bloodSplatter3:"assets/images/blood-splatter-3.png",bloodSplatter4:"assets/images/blood-splatter-4.png",bloodSplatter5:"assets/images/blood-splatter-5.png",bloodSplatter6:"assets/images/blood-splatter-6.png",bloodSplatterGreen1:"assets/images/blood-splatter-green-1.png",bloodSplatterGreen2:"assets/images/blood-splatter-green-2.png",bloodSplatterGreen3:"assets/images/blood-splatter-green-3.png",bloodSplatterGreen4:"assets/images/blood-splatter-green-4.png",bloodSplatterGreen5:"assets/images/blood-splatter-green-5.png",bloodSplatterGreen6:"assets/images/blood-splatter-green-6.png",zombieFace:"assets/images/zombie-face.png",titleScreenBackground:"assets/images/title-screen-background.png",titleScreenBgFrontGrass:"assets/images/title-screen-bg-front-grass.png",titleScreenBgTrees:"assets/images/title-screen-bg-trees.png",titleScreenBgBackGrass:"assets/images/title-screen-bg-back-grass.png",titleScreenBgSky:"assets/images/title-screen-bg-sky.png",crate:"assets/images/crate.png",bottle1:"assets/images/bottle1.png",bottle1Base:"assets/images/bottle1-base.png",bottle1Piece1:"assets/images/bottle1-piece1.png",bottle1Piece2:"assets/images/bottle1-piece2.png",bottle1Piece3:"assets/images/bottle1-piece3.png",bottle1Explode:"assets/images/bottle1-explode.png",shotgun:"assets/images/shotgun.png",dirtPile:"assets/images/dirt-pile.png",yellowBubble:"assets/images/yellow-bubble.png",colorSquare:"assets/images/color-square.png",mercenary:"assets/images/mercenary.png",weapon:"assets/images/weapon.png",cash:"assets/images/cash.png",popWhite:"assets/images/pop-white.png",foodTier1:"assets/images/food-tier-1.png",storyScreenBackground:"/assets/images/story-screen-background.png",pointingHand:"assets/images/pointing-hand.png"},frames:{healthFull:0,healthEmpty:1,shotgunNormal:0,shotgunFiring:1,hudMenuLight:0,hudMenuDark:1,hudItemLight:0,hudItemDark:1,hudMessageLight:0,hudMessageDark:1,yellowBubbleEmpty:0,yellowBubbleFull:1,colorSquareGreen:0,colorSquareYellow:1,colorSquareRed:2,zombieDead:21,mercenaryStatusShoot:0,mercenaryStatusRefuse:1,weaponPistol:0,weaponShotgun:1,weaponRifle:2,weaponRocketLauncher:3,foodApple:0,foodBeer:1,foodCake:2,foodGrapes:3,foodHamburger:4,foodHotDot:5,foodIceCream:6,foodMartini:7,foodMeat:8,foodSushi:9,foodWatermelon:10,foodWine:11},scales:{crate:1.5,bottle1:1.5,dirtPile:1.5},frameSizes:{zombie:{width:25,height:25},shotBlast:{width:32,height:32},shotgunBlast:{width:32,height:32},shotgun:{width:22,height:11},hudMenuBorder:{width:66,height:20},hudItemBorder:{width:20,height:20},hudMessageBorder:{width:80,height:40},bottle1Explode:{width:64,height:64},yellowBubble:{width:16,height:16},colorSquare:{width:16,height:16},mercenary:{width:32,height:32},weapon:{width:19,height:19},popWhite:{width:16,height:16},foodTier1:{width:16,height:16}}},C=4473924,z=3385890,L={loadingTextSize:22,loadingTextTint:16777215},E={zombieColumns:18,sidePaddingPercent:20,splatterRange:8,splatterVarieties:6,damageFlashDuration:100,damageFlashColor:{red:180,green:15,blue:15},damageShakeDuration:200,damageShakeIntensity:.005,statusTime:1500,itemFlashDelay:125,answerFlashDelay:75,answerDisplayTime:1250,bigZombieSizeModifier:1.25,audio:{music:{zombieAssaultBackgroundMusicIntro:M.zombieAssaultIntro,zombieAssaultBackgroundMusicLoop:M.zombieAssaultLoop,zombieAssaultReviewBackgroundMusicIntro:M.zombieAssaultReviewIntro,zombieAssaultReviewBackgroundMusicLoop:M.zombieAssaultReviewLoop},soundEffects:{shotMiss:I,pistolHit:y,shotgunHit:v,itemSpawn:k,itemGet:w,zombieAttack:S,mercenaryAttack:T,mercenaryRefuse:p,outOfAmmo:h,normalZombieSpawn:h,specialZombieSpawn:h},config:[{key:x,value:{detune:-1200,rate:2}}]},fonts:{zombieSize:10,zombieSizeLarge:14,zombieTint:16777215,zombieAnswerFlashTint:16733525,itemSize:10,itemSizeLarge:14,itemTint:16777215},ui:{zombieWordBgColor:0,itemWordBgColor:0,itemWordBgPadding:2,hudConfig:{weapon:!0,item:!0,health:!0,kills:!0,cash:!0,timer:!0,message:!0,textInput:!0,hudBuffer:!0,handleInput:!0}},statusMessages:{damage:["¡Cerebros","ricos!"],useMercenary:["Mi placer."],mercenaryUnavailable:["No trabajo","gratis,","muchachos."],cashReceived:["¡Mas dinero!"],foodTier1Received:["¡Delicioso!"]},modals:{quit:["Press ESC again to quit.","Press any other key to continue."]}},R={screenFadeTime:750,practiceWordBuffer:1250,fonts:{vocabSize:11,vocabSizeSmall:8,dotSize:9,vocabTint:16777215,menuOptionSize:11,menuOptionTint:16777215,practiceWordSize:10,practiceWordSizeLarge:14,practiceWordTint:16777215,practiceWordCorrectTint:2284834,practiceWordWrongTint:14492194},ui:{practiceWordBgColor:0,practiceWordBgPadding:2,hudConfig:{weapon:!1,item:!1,health:!1,kills:!1,cash:!1,timer:!1,message:!0,textInput:!1,hudBuffer:!0,handleInput:!1}},audio:{music:{backgroundMusic:M.inEarlyTime},soundEffects:{menuMove:u,menuSelect:d,practiceModalClear:f,guessCorrect:b,guessWrong:f,quitPractice:g}},statusMessages:{start:["Arrows to move","","Space/Enter","to choose"],practice:["Type the translation","","Enter to shoot","Esc to quit"],hit:"Nice shot!",miss:["Missed!","Try again!"]},modals:{practice:["I'll set up the bottles, then.","Take your time. And good luck."]}},Y={pistol:"pistol",shotgun:"shotgun",rifle:"rifle",rocketLauncher:"rocket-launcher",damage:{pistol:1,shotgun:3,rifle:3,rocketLauncher:10}};function X(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function H(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var G=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?X(i,!0).forEach((function(t){H(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):X(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},Y,{cash:"cash",foodTier1:"food-tier-1"}),F=[{id:"base",gameTime:180,waveId:"waves-base-180",waves:[],maxHealth:20,startHealth:20,startCash:200,baseFallSpeed:60,fallRange:8,mercenaryEnabled:!0,mercenaryCost:100,enemies:{problemVocabPercentage:.25,showAnswerOnAttack:!0,showAnswerOnMerc:!0,attackDamage:2,normalZombieHealth:1,sprinterZombieSpeedModifier:2,sprinterZombieHealth:1,bruiserZombieSpeedModifier:.66,bruiserZombieHealth:3},weapons:{default:"pistol",shotgunAmmo:5},items:{cashAmount:50,foodTier1HealAmount:1,baseSpawnRate:8e3,spawnRange:1500,lifeTime:8e3,warnTime:2500,probabilities:[{min:1,max:33,itemType:G.cash},{min:34,max:66,itemType:G.foodTier1},{min:67,max:100,itemType:G.shotgun}]}},{id:"base-review",waveId:"waves-base-210-review",gameTime:210},{id:"demo",waveId:"waves-demo",mercenaryEnabled:!1,items:{foodTier1HealAmount:1,baseSpawnRate:1e4,spawnRange:2e3,lifeTime:8e3,warnTime:2500,probabilities:[{min:1,max:100,itemType:G.foodTier1}]}},{id:"basic-vocab",waveId:"waves-basic-vocab",gameTime:120},{id:"basic-vocab-review",waveId:"waves-basic-vocab-review"},{id:"lesson-2",waveId:"waves-lesson-2"},{id:"lesson-2-review",waveId:"waves-lesson-2-review",gameTime:210}],A={boot:"Boot",loading:"Loading",titleMenu:"TitleMenu",minigame:"Minigame",endgame:"Endgame",vocabStudy:"VocabStudy",townMap:"TownMap",story:"Story",optionsMenu:"OptionsMenu",registration:"Registration"},D={padding:5,paddingBig:15,paddingSmall:2},q="blue-sky-white",_={blueSkyWhitePng:"assets/fonts/blue-sky-white.png",blueSkyWhiteFnt:"assets/fonts/blue-sky-white.fnt"},V={height:120,bufferHeight:70,maxTextEntry:18,fonts:{killSize:22,killTint:16777215,cashSize:22,cashTint:16777215,timerSize:22,timerTint:16777215,textEntrySize:18,textEntryTint:16777215,statusSize:14,statusSizeSmall:11,statusTint:16777215},ui:{textEntryBackgroundColor:0,itemBackgroundColor:1118481,ammoIconColor:16777215}},j="English",N="Spanish",Z=0,U=.85,K=0,J=16777215,Q=16776994,$=12,ee=500,te="PRESS ANY KEY TO CONTINUE",ie={fadeColor:0,fadeAlpha:.85,backgroundColor:0,borderColor:16777215,textColor:16777215,choiceColor:16776994,textFontSize:12,choiceFontSize:18,audio:{menuMove:u,menuSelect:c}},ae={mapTitleText:"Choose a Location",stageTitleText:"Choose a Stage",clearedText:"Cleared!",lockedText:"Locked!",screenFadeTime:750,selectorFlashDelay:350,showAllLessons:!1,ui:{borderColor:16777215,mapGridColor:2236962,borderDisableColor:2236962,mapPinCellRatio:.5,requirementLineColor:16777215},audio:{music:{backgroundMusic:M.inTheBackPocket},soundEffects:{mapGridMove:u,mapGridSelect:d,stageMove:u,stageSelect:d,stageSelectBackout:g,lessonSelectBackout:g,stageSelectedModalBackout:f,stageLockedModal:p,stageLockedModalBackout:f,lessonLockedModal:p,lessonLockedModalBackout:f}},choiceModals:{stageSelected:{text:["Are you ready to start?","","Or do you need some target practice first?"],choices:["Start Game","Target Practice"]},clearedStageSelected:{text:["You already cleared this stage!","","But there might still be some zombies","around if you want to check it out."],choices:["Start Game","Target Practice"]},reviewStageSelected:{text:["Alright, this is it. The final push to clear","out this location. You're going to see vocab","from every stage in this lesson.","I hope you're ready!"],choices:["Start Game"]},clearedReviewStageSelected:{text:["You already cleared this whole area,","but it's a good idea to check back in.","","I'm sure there's still some zombies around,","and more practice never hurt."],choices:["Start Game"]}},statusMessages:{instructions:["Arrows to move","","","Space/Enter to choose","","","Esc to go back"]},fonts:{instructionsSize:11,instructionsTint:16777215,mapTitleSize:14,mapTitleTint:16777215,mapLocationSize:12,mapLocationTint:16777215,lessonInfoTitleSize:16,lessonInfoTitleTint:16776994,lessonInfoTextSize:11,lessonInfoTextTint:16777215,stageTitleSize:14,stageTitleTint:16777215,stageInfoTitleSize:14,stageInfoTitleTint:16777215,stageInfoTypeSize:18,stageInfoTypeColor:16776994,stageInfoSubtitleSize:11,stageInfoSubtitleTint:16777215}},se={zombieAssault:"zombie-assault",zombieAssaultReview:"zombie-assault-review",names:{zombieAssault:"Zombie Assault",zombieAssaultReview:"Final Assault"},descriptions:{zombieAssault:"Vocab Mastery Mayhem",zombieAssaultReview:"Testing Turmoil"}},ne={name:"lesson-demo",stage1:"demo-1"},oe={name:"lesson-basic-vocab",stage1:"basic-vocab-1",stage2:"basic-vocab-2",stage3:"basic-vocab-3",stage4:"basic-vocab-4",review:"basic-vocab-review"},re={name:"lesson-numbers-1",stage1:"numbers-1-1",stage2:"numbers-1-2",stage3:"numbers-1-3",review:"numbers-1-review"},le={name:"lesson-nouns-1",stage1:"nouns-1-1",stage2:"nouns-1-2",stage3:"nouns-1-3",review:"nouns-1-review"},he={name:"lesson-food-1",stage1:"food-1-1",stage2:"food-1-2",stage3:"food-1-3",review:"food-1-review"},ue={name:"lesson-adjectives-1",stage1:"adjectives-1-1",stage2:"adjectives-1-2",stage3:"adjectives-1-3",review:"adjectives-1-review"},ce={name:"lesson-verbs-1",stage1:"verbs-1-1",stage2:"verbs-1-2",stage3:"verbs-1-3",review:"verbs-1-review"},de={name:"lesson-nouns-2",stage1:"nouns-2-1",stage2:"nouns-2-2",stage3:"nouns-2-3",stage4:"nouns-2-4",review:"nouns-2-review"},ge={name:"lesson-around-the-house-1",stage1:"around-the-house-1-1",stage2:"around-the-house-1-2",stage3:"around-the-house-1-3",review:"around-the-house-1-review"},me={name:"lesson-school-1",stage1:"school-1-1",stage2:"school-1-2",stage3:"school-1-3",review:"school-1-review"},pe={name:"lesson-office",stage1:"office-1",stage2:"office-2",stage3:"office-3",stage4:"office-4",review:"office-review"},fe={name:"lesson-when-and-where",stage1:"when-and-where-1",stage2:"when-and-where-2",stage3:"when-and-where-3",stage4:"when-and-where-4",review:"when-and-where-review"},be={name:"lesson-nature-1",stage1:"nature-1-1",stage2:"nature-1-2",stage3:"nature-1-3",review:"nature-1-review"},ye={name:"lesson-body-and-health-1",stage1:"body-and-health-1-1",stage2:"body-and-health-1-2",stage3:"body-and-health-1-3",review:"body-and-health-1-review"},ve={name:"lesson-animals-1",stage1:"animals-1-1",stage2:"animals-1-2",stage3:"animals-1-3",review:"animals-1-review"},we={name:"lesson-science-1",stage1:"science-1-1",stage2:"science-1-2",stage3:"science-1-3",review:"science-1-review"},ke={name:"lesson-fashion-1",stage1:"fashion-1-1",stage2:"fashion-1-2",stage3:"fashion-1-3",review:"fashion-1-review"},Se={name:"lesson-ordinal-numbers",stage1:"ordinal-numbers-1",stage2:"ordinal-numbers-2",stage3:"ordinal-numbers-3",review:"ordinal-numbers-review"},Te={name:"lesson-verbs-2",stage1:"verbs-2-1",stage2:"verbs-2-2",stage3:"verbs-2-3",stage4:"verbs-2-4",review:"verbs-2-review"},Ie={name:"lesson-food-2",stage1:"food-2-1",stage2:"food-2-2",stage3:"food-2-3",stage4:"food-2-4",review:"food-2-review"},xe={name:"lesson-around-the-house-2",stage1:"around-the-house-2-1",stage2:"around-the-house-2-2",stage3:"around-the-house-2-3",stage4:"around-the-house-2-4",review:"around-the-house-2-review"},Oe={name:"lesson-school-2",stage1:"school-2-1",stage2:"school-2-2",stage3:"school-2-3",review:"school-2-review"},Me={name:"lesson-nature-2",stage1:"nature-2-1",stage2:"nature-2-2",stage3:"nature-2-3",review:"nature-2-review"},Pe={name:"lesson-body-and-health-2",stage1:"body-and-health-2-1",stage2:"body-and-health-2-2",stage3:"body-and-health-2-3",review:"body-and-health-2-review"},Be={name:"lesson-animals-2",stage1:"animals-2-1",stage2:"animals-2-2",stage3:"animals-2-3",review:"animals-2-review"},We={name:"lesson-science-2",stage1:"science-2-1",stage2:"science-2-2",stage3:"science-2-3",review:"science-2-review"},Ce={name:"lesson-fashion-2",stage1:"fashion-2-1",stage2:"fashion-2-2",stage3:"fashion-2-3",stage4:"fashion-2-4",review:"fashion-2-review"},ze={name:"lesson-food-3",stage1:"food-3-1",stage2:"food-3-2",stage3:"food-3-3",stage4:"food-3-4",review:"food-3-review"},Le={name:"lesson-food-4",stage1:"food-4-1",stage2:"food-4-2",stage3:"food-4-3",stage4:"food-4-4",review:"food-4-review"},Ee={name:"lesson-adverbs-1",stage1:"adverbs-1-1",stage2:"adverbs-1-2",stage3:"adverbs-1-3",review:"adverbs-1-review"},Re={name:"lesson-adverbs-2",stage1:"adverbs-2-1",stage2:"adverbs-2-2",stage3:"adverbs-2-3",review:"adverbs-2-review"},Ye={name:"lesson-adjectives-2",stage1:"adjectives-2-1",stage2:"adjectives-2-2",stage3:"adjectives-2-3",stage4:"adjectives-2-4",review:"adjectives-2-review"},Xe={name:"lesson-adjectives-3",stage1:"adjectives-3-1",stage2:"adjectives-3-2",stage3:"adjectives-3-3",stage4:"adjectives-3-4",review:"adjectives-3-review"},He={name:"lesson-verbs-3",stage1:"verbs-3-1",stage2:"verbs-3-2",stage3:"verbs-3-3",stage4:"verbs-3-4",review:"verbs-3-review"},Ge={name:"lesson-verbs-4",stage1:"verbs-4-1",stage2:"verbs-4-2",stage3:"verbs-4-3",stage4:"verbs-4-4",review:"verbs-4-review"},Fe={name:"lesson-verbs-5",stage1:"verbs-5-1",stage2:"verbs-5-2",stage3:"verbs-5-3",stage4:"verbs-5-4",stage5:"verbs-5-5",review:"verbs-5-review"},Ae={name:"lesson-nouns-3",stage1:"nouns-3-1",stage2:"nouns-3-2",stage3:"nouns-3-3",stage4:"nouns-3-4",review:"nouns-3-review"},De={name:"lesson-nouns-4",stage1:"nouns-4-1",stage2:"nouns-4-2",stage3:"nouns-4-3",stage4:"nouns-4-4",review:"nouns-4-review"},qe={name:"lesson-nouns-5",stage1:"nouns-5-1",stage2:"nouns-5-2",stage3:"nouns-5-3",stage4:"nouns-5-4",stage5:"nouns-5-5",review:"nouns-5-review"},_e={name:"lesson-travel",stage1:"travel-1",stage2:"travel-2",stage3:"travel-3",review:"travel-review"},Ve={name:"lesson-sports",stage1:"sports-1",stage2:"sports-2",stage3:"sports-3",review:"sports-review"},je={name:"lesson-tools-and-hardware",stage1:"tools-and-hardware-1",stage2:"tools-and-hardware-2",stage3:"tools-and-hardware-3",review:"tools-and-hardware-review"},Ne={name:"lesson-nouns-6",stage1:"nouns-6-1",stage2:"nouns-6-2",stage3:"nouns-6-3",stage4:"nouns-6-4",stage5:"nouns-6-5",review:"nouns-6-review"},Ze={name:"lesson-nouns-7",stage1:"nouns-7-1",stage2:"nouns-7-2",stage3:"nouns-7-3",stage4:"nouns-7-4",stage5:"nouns-7-5",review:"nouns-7-review"},Ue={name:"lesson-nouns-8",stage1:"nouns-8-1",stage2:"nouns-8-2",stage3:"nouns-8-3",stage4:"nouns-8-4",stage5:"nouns-8-5",review:"nouns-8-review"},Ke={name:"lesson-nouns-9",stage1:"nouns-9-1",stage2:"nouns-9-2",stage3:"nouns-9-3",stage4:"nouns-9-4",stage5:"nouns-9-5",review:"nouns-9-review"},Je=[{id:oe.name,location:"The Front Gate",position:{x:0,y:2}},{id:re.name,location:"Administration Building",position:{x:1,y:1}},{id:Se.name,location:"Accounting Office",position:{x:0,y:0}},{id:he.name,location:"The Rusty Spoon Diner",position:{x:3,y:1}},{id:Ie.name,location:"Goat and Thistle Pub",position:{x:4,y:1}},{id:ze.name,location:"Luca's Pizzeria",position:{x:6,y:1}},{id:Le.name,location:"Le Gros Cochon Cafe",position:{x:8,y:1}},{id:ge.name,location:"Bayview Apartments",position:{x:2,y:3}},{id:xe.name,location:"Dictionary Bay Lofts",position:{x:2,y:4}},{id:me.name,location:"High School",position:{x:1,y:3}},{id:Oe.name,location:"Dictionary Bay College",position:{x:0,y:3}},{id:pe.name,location:"Business Center",position:{x:2,y:0}},{id:fe.name,location:"Antique Shop",position:{x:1,y:0}},{id:be.name,location:"Public Park",position:{x:3,y:4}},{id:Me.name,location:"Nature Reserve",position:{x:4,y:4}},{id:ye.name,location:"Medical Center",position:{x:5,y:2}},{id:Pe.name,location:"Emergency Room",position:{x:7,y:2}},{id:ve.name,location:"Pet Store",position:{x:4,y:3}},{id:Be.name,location:"Petting Zoo",position:{x:5,y:4}},{id:we.name,location:"Observatory",position:{x:1,y:4}},{id:We.name,location:"Research Facility",position:{x:0,y:4}},{id:ke.name,location:"Outlet Mall",position:{x:5,y:3}},{id:Ce.name,location:"Dictionary Bay Boutique",position:{x:6,y:4}},{id:Ve.name,location:"Fitness Center",position:{x:3,y:2}},{id:_e.name,location:"Bus Station",position:{x:0,y:1}},{id:le.name,location:"Storage Sheds",position:{x:1,y:2}},{id:de.name,location:"Student Housing",position:{x:3,y:3}},{id:Ae.name,location:"Condo Complex",position:{x:4,y:2}},{id:De.name,location:"Dollar Store",position:{x:6,y:3}},{id:qe.name,location:"Department Store",position:{x:7,y:3}},{id:Ne.name,location:"Office Park",position:{x:7,y:4}},{id:Ze.name,location:"Assisted Living Suites",position:{x:8,y:4}},{id:Ue.name,location:"Flea Market",position:{x:8,y:3}},{id:Ke.name,location:"Junkyard",position:{x:8,y:2}},{id:je.name,location:"Hardware Store",position:{x:6,y:2}},{id:Ee.name,location:"Library",position:{x:4,y:0}},{id:Re.name,location:"Courthouse",position:{x:7,y:0}},{id:ue.name,location:"Economy Apartments",position:{x:2,y:2}},{id:Ye.name,location:"Luxury Apartments",position:{x:5,y:0}},{id:Xe.name,location:"Police Station",position:{x:6,y:0}},{id:ce.name,location:"Neighborhood Gym",position:{x:2,y:1}},{id:Te.name,location:"Activity Center",position:{x:3,y:0}},{id:He.name,location:"Swimming Pool",position:{x:5,y:1}},{id:Ge.name,location:"Flight School",position:{x:7,y:1}},{id:Fe.name,location:"Boating Club",position:{x:8,y:0}}],Qe="on-stage",$e="completed-stage-count",et="stage-won",tt="stage-lost",it="stage-completed",at="lesson-completed",st="game-type",nt="item-unlocked",ot="logged-in",rt="logged-out",lt="default",ht="normal-zombie",ut="sprinter-zombie",ct="bruiser-zombie",dt="review-zombie",gt={shotgun:Y.shotgun,rifle:Y.rifle,rocketLauncher:Y.rocketLauncher,cash:G.cash,foodTier1:G.foodTier1,sprinterZombie:ut,bruiserZombie:ct,reviewZombie:dt,mercenary:"mercenary"},mt=[{id:"game-intro",text:[["¡Hola! ¿Estás despierto?"],["Oh! Sorry! I forgot that your Spanish","still needs some work. No te preocupes.","You'll get the hang of it."],["Anyway, how are you holding up?"],["Tired? Yo también. Everyone is tired.","Running from the zombies is hard work.","But it's better than the alternative!"],["I don't know how much longer we can","keep it up. Supplies are running out.","And there are more of those... THINGS out","there every day."],["But all that is about to change. I've got some","good news. The scouts came back and they found","something. Something big!"],["It's a town. Some kind of gated community.","They say it's got strong walls, food, housing","medical facilities... you name it. And they","say it's mostly intact. It could be a","great place to hole up and ride this","thing out."],["There's just one catch. The whole town is","still crawling with muertos. We'll have","to clear them out before we can make much","use of the place."],["But I think we can do it. We've got the people","and we've got the firepower."],["Anyway, it's the best hope we've got.","So, what do you say? Are you in? The others","are gearing up right now. Grab your pack,","get your gun, and let's go blast some muertos!","¡Vamos!"]]},{id:"map-intro",screen:A.townMap,checks:[{checkType:$e,checkValue:0}],repeat:!1,text:[["This is the town map. From here you can see","all the areas we've cleared out so far along","with the upcoming areas we've scouted."],["Each location has it's own set of vocabulary","words that you'll need to learn in order to","clear out the muertos."],["As you can see we've got our work cut out","for us. But I think we can do it."],["Now, we can't just go running into town","without a plan. We need to clear this place","out area by area. Let's start with the \"Front","Gate\". I've marked it in yellow on your map."],['Select the "Front Gate" on the map and',"let's get started."]]},{id:"stage-select-intro",text:[["Each area on the map contains one or more","stages. Now that you've selected an area","you need to pick a stage. Each one has","its own challenges and its own vocab."],["Go ahead and pick the first stage. You'll","have the opportunity to do some target","practice before you take on the zombies.","I recommend that you take advantage","of it."]]},{id:"first-stage-game-locked",text:[["It's a bad idea to go in unprepared.","Why don't you try some target practice first?"]]},{id:"minigame-intro",screen:A.minigame,checks:[{checkType:ot},{checkType:$e,checkValue:0}],repeat:!0,text:[["The muertos will be here any second!","I sure hope you got enough practice."],["They're vile creatures, but try to stay calm","when you see them."],["Remember your target practice. Shooting a","zombie is the same as shooting a bottle. Just","focus on the vocab next to each one,","type the translation, and press 'Enter'","to take 'em out."],["But don't take too long! If a zombie gets through","they'll attack. Take too many hits and you're","a goner."],["And keep an eye on that timer at the bottom","of the screen. You just need to blast muertos","until that reaches '0' to complete the stage."],["Okay! Here they come! ¡Ten cuidado!"]]},{id:"vocab-study-intro",screen:A.vocabStudy,checks:[{checkType:$e,checkValue:0}],repeat:!0,text:[["This is target practice. You're going to need","it. You won't stand a chance against those","zombies if you're not prepared."],["From this screen you can see all of the vocab","for the current stage. Some stages will have","more than others. It looks like we should have","it pretty easy for our first go."],["Before you start the stage you should memorize","all the translations on this screen. You can","use the controls at the bottom of the screen to","hide either language if it helps you study."],["When you think you know the words you can test","your knowledge by shooting at some bottles.",'Select "Practice" and I\'ll set them up for you.'],["Just type the translation for the word under",'the bottle and press "Enter". You don\'t have',"to worry about time and you don't have to","worry about missing."],["If you get tired of target practice you can stop",'at any time by pressing "Esc".'],["Okay, I'll leave you to it. Practice as much","as you need. When you're ready you can start","the game with the controls at the bottom."]]},{id:"first-win",screen:A.endgame,checks:[{checkType:$e,checkValue:1},{checkType:et}],repeat:!1,text:[["¡Felicidades! You did it!"],["We've got a long way to go, but this is a great","start. I really think we have a chance!"],["When you're ready to move on head back to the","map and let's see what's next."],["Oh, and just a heads up... I got some news","from the scouts. They've seen something in the","the next area. Something bad. I'll tell you","all about it when we get there."]]},{id:"first-loss",screen:A.endgame,checks:[{checkType:tt}],repeat:!1,text:[["Oh no! There's too many of them!"],["We've got to fall back, but don't give up.","This is just a minor setback."],["Maybe you should get in some more target","practice. Study that vocab a little longer","and then get back out there."],["I know you can do it, amigo."]]},{id:"stage-locked",text:[["Whoa, slow down! The enthusiasm is great,","but we should clear these stages out in","order. You've still got some work to","do before you head in there."]]},{id:"lesson-locked",text:[["Ten cuidado! That area's still too","dangerous. We'll never make it there!","I marked the spots we can get to in yellow on","the map. Stick to those!"]]},{id:"sprinter-unlocked",screen:A.minigame,checks:[{checkType:ot},{checkType:nt,checkValue:gt.sprinterZombie}],repeat:!1,text:[["Welcome back. I hope you got enough practice.","The scouts are reporting something new out there."],["The only good thing about fighting zombies is","that they're slow, right?"],["Well, not any more. We've received reports of","running muertos! You can't miss them. They're","bright red and they're a lot faster than anything","we've seen before."],["The scouts have been calling them sprinters.","If you spot a sprinter take it out immediately.","If you hesitate they'll be right on top of us."],["You'll need to think strategically from","now on. Sometimes you'll have to ignore a slow","zombie for a bit to focus on a bigger threat","in the back."],["Okay, get ready. Here they come. ¡Buena suerte!"]]},{id:"food-unlocked",screen:A.minigame,checks:[{checkType:ot},{checkType:nt,checkValue:gt.foodTier1}],repeat:!1,text:[["Keep up the good work. Just a few more stages","to clear."],["By the way, are you getting hungry yet? The","scouts have reported that there is still","quite a bit of food in town. Picking some up","should give you a health boost if those","zombies are getting to you."],["Keep an eye out for food while you're taking","care of business out there. Picking it up","should be familiar. Each food item will have","a word next to it. Type the translation to","grab it."],["Each piece of food will give you some health","back. But be quick about it, food won't last","long out there."]]},{id:"mercenary-unlocked",screen:A.minigame,checks:[{checkType:ot},{checkType:nt,checkValue:gt.mercenary}],repeat:!1,text:[["You're doing great. How are you feeling?","Is your head spinning yet?"],["I know it can be hard to remember every single","vocab word. And there are only going to more as","we make our way into town."],["But don't give up yet. Some help just arrived.","It seems a mysterious stranger has seen what","we're up to and has offered some assistance...","for a price."],["She's what you might call a mercenary. She's","willing to kill any zombies that are giving you","trouble, as long as you can afford her services."],["And what does she want? The same thing that all","mercenaries want... dinero! Cold, hard, cash."],["I don't know what she's planning to do with","all that money in this zombie-infested","wasteland, but that's not really any of our","business."],["Here's how it works. Before you can take","advantage of the mercenary's services you","need to find some money. It's bound to be","lying around out there. Pick it up just like","you would any other item. Type the","translation and it's yours."],["Once you have some cash calling her is easy","enough. Just type the English word under the","zombie you want her to take out and press","'Enter'. She'll take your cash and eliminate","the muerto."],["It's a good idea to keep some money on hand","in case you need to call on her. Here, I'll","give you some to get started. And remember","to keep an eye out for any more lying around."],["Alright, that's enough chit-chat. Time to get","back out there."]]},{id:"review-intro",screen:A.townMap,checks:[{checkType:it,checkValue:oe.stage4}],repeat:!1,text:[["The front gate is almost clear. You're doing","a great job out there."],["The last stage won't be easy, though.","It's packed with zombies and it covers","vocab from the entire lesson."],["That means you'll have to know all the","vocab from the previous stages if you want","to stand a chance."],["You can go back to target practice for any","stage, or just replay the stages if you need","more practice."],["We're all rooting for you, amigo. Now get","out there and do your best."]]},{id:"lesson-unlocked-intro",screen:A.townMap,checks:[{checkType:at,checkValue:oe.name}],repeat:!1,text:[["You did it! The front gate is clear."],["But we can't stop now. There's still a lot","of work to do."],["I've marked the areas on your map that we","should check out next. Whenever you're","ready head to one of the locations in yellow."],["Oh, and you're welcome to go back and check","out a location that we've already cleared","if you want to review old vocab. I'm sure","there are still a few zombies prowling","around back there."]]},{id:"review-zombie-unlocked",screen:A.minigame,checks:[{checkType:ot},{checkType:nt,checkValue:gt.reviewZombie}],repeat:!1,text:[["Are you ready to clear out the next area?","I hope you studied the new vocab."],["And I hope you haven't forgotten all the","vocab from the last lesson. You've got to","keep that fresh in your mind, too, because","you will see it again."],["The scouts are reporting that there are pale","zombies in this area that have review vocab","from the last area."],["You will continue to see vocab from all cleared","areas show up as review vocab later in the game.","So don't forget it!"]]},{id:"bruiser-unlocked",screen:A.minigame,checks:[{checkType:ot},{checkType:nt,checkValue:gt.bruiserZombie}],repeat:!1,text:[["Heads up. I've got the latest from the","scouts and it's not good."],["There's a new type of zombie out there that's","even worse than the Sprinters. Those muertos","throw something new at us at every turn. "],["They say these new zombies are big. Real big.","They're slower than the other zombies, but a","lot tougher to kill. The scouts have been","calling them Bruisers. You can't bring down","a Bruiser with just one shot like the other","zombies."],["In fact, it takes three shots to kill each one","of these monsters. And three shots means three","vocab words. I hope you got enough practice!"],["Thankfully there's not a lot of them... yet.","But if you see one take it out quickly. It","will take some time to bring down one of","those bestias, so don't wait too long."],["Alright, that's all the news for now."]]},{id:"shotgun-unlocked",screen:A.minigame,checks:[{checkType:ot},{checkType:nt,checkValue:gt.shotgun}],repeat:!1,text:[["Wow, those bruisers are pretty tough."],["I think it's time for us to level the","playing field. And the latest intel is that","this town might have exactly what we need."],["That pistol is great for your average muerto,","but when it comes to Bruisers what we really","need are shotguns! And it just so happens","that this town is full of them!"],["Huh? What do you mean where did they come","from? We're living in a zombie hellscape","and you're worried about where the guns","are coming from? Come on!"],["Anyway, you know the drill. When you see","a shotgun you can pick it up just like","other items. And with a shotgun you can","kill Bruisers with a single blast."],["But unlike your pistol the shotgun has limited","ammo. There's no sense wasting good shotgun","ammo on a regular zombie when your pistol works","just as well. So try to save the big guns for","the Bruisers."],["Alright, that's enough for now. Happy","hunting out there."]]},{id:"demo-minigame",screen:A.minigame,checks:[{checkType:rt}],repeat:!0,text:[["Dead Language is a fast-paced zombie","shoot-em-up and language study game. The","undead hordes are on the march and it's up to","you to keep them at bay."],["In this game you don't aim and shoot","directly. Instead, you blast the zombies by","translating ".concat(N," vocabulary."),"Under each zombie is a word written out in","".concat(j,". Type out the ").concat(N),"translation and hit 'Enter' to take 'em out."],["This demo contains 20 basic vocabulary words","for you to practice. The full game contains","thousands more for you to learn and master,","stage by stage."],["The full game also includes a helpful study","mode so you can learn and practice before","taking on the zombies. There are tons","of items and weapons to collect throughout","the game as well as different types of","enemies to discover."],["If you like the demo you can unlock the full","game by creating an account. It's completely","free! Just click the Sign In button to get","started."],["Okay, that's enough talking.","Bring on the zombies!"]]},{id:"demo-win",screen:A.endgame,checks:[{checkType:rt},{checkType:et}],repeat:!0,text:[["Congratulations! You did it! you stopped","the zombie horde... for now!"],["But this is just the beginning. There's a","whole town of zombies waiting just ahead.","And more zombies means more vocab to master.","Not to mention additional items, weapons, and","enemies to discover."],["So what are you waiting for? Log in and let's","get started!"]]},{id:"demo-loss",screen:A.endgame,checks:[{checkType:rt},{checkType:tt}],repeat:!0,text:[["Oh no! There's too many of them! We'll have","to retreat... for now!"],["But this is just the beginning. There's a","whole town of zombies waiting just ahead.","And more zombies means more vocab to master.","Not to mention additional items, weapons, and","enemies to discover."],["So what are you waiting for? Log in and let's","get started!"]]}],pt={audio:{backgroundMusic:M.carousingEveryNight},screenFadeTime:750},ft=[{id:"waves-base-180",waves:[{baseSpawnRate:2500,spawnRange:500,start:0,maxStart:15,maxEnd:45,end:60,probabilities:[{min:1,max:45,enemyType:ht},{min:46,max:70,enemyType:dt},{min:71,max:85,enemyType:ut},{min:86,max:100,enemyType:ct}]},{baseSpawnRate:2200,spawnRange:500,start:60,maxStart:75,maxEnd:95,end:120,probabilities:[{min:1,max:45,enemyType:ht},{min:46,max:70,enemyType:dt},{min:71,max:85,enemyType:ut},{min:86,max:100,enemyType:ct}]},{baseSpawnRate:1800,spawnRange:500,start:120,maxStart:135,maxEnd:165,end:180,probabilities:[{min:1,max:45,enemyType:ht},{min:46,max:70,enemyType:dt},{min:71,max:85,enemyType:ut},{min:86,max:100,enemyType:ct}]}]},{id:"waves-base-210-review",waves:[{baseSpawnRate:2500,spawnRange:500,start:0,maxStart:10,maxEnd:50,end:60,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]},{baseSpawnRate:2200,spawnRange:500,start:60,maxStart:70,maxEnd:110,end:120,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]},{baseSpawnRate:1800,spawnRange:500,start:120,maxStart:130,maxEnd:190,end:210,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]}]},{id:"waves-demo",waves:[{baseSpawnRate:3e3,spawnRange:500,start:0,maxStart:0,maxEnd:55,end:60,probabilities:[{min:1,max:85,enemyType:ht},{min:86,max:100,enemyType:ut}]},{baseSpawnRate:2400,spawnRange:500,start:60,maxStart:65,maxEnd:115,end:120,probabilities:[{min:1,max:80,enemyType:ht},{min:81,max:100,enemyType:ut}]},{baseSpawnRate:1700,spawnRange:500,start:120,maxStart:125,maxEnd:175,end:180,probabilities:[{min:1,max:75,enemyType:ht},{min:76,max:100,enemyType:ut}]}]},{id:"waves-basic-vocab",waves:[{baseSpawnRate:3e3,spawnRange:500,start:0,maxStart:20,maxEnd:40,end:60,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]},{baseSpawnRate:2500,spawnRange:500,start:60,maxStart:80,maxEnd:100,end:120,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]}]},{id:"waves-basic-vocab-review",waves:[{baseSpawnRate:3e3,spawnRange:500,start:0,maxStart:20,maxEnd:40,end:60,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]},{baseSpawnRate:2500,spawnRange:500,start:60,maxStart:80,maxEnd:100,end:120,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]},{baseSpawnRate:2500,spawnRange:500,start:120,maxStart:140,maxEnd:160,end:180,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]}]},{id:"waves-lesson-2",waves:[{baseSpawnRate:2800,spawnRange:500,start:0,maxStart:20,maxEnd:40,end:60,probabilities:[{min:1,max:45,enemyType:ht},{min:46,max:70,enemyType:dt},{min:71,max:85,enemyType:ut},{min:86,max:100,enemyType:ct}]},{baseSpawnRate:2400,spawnRange:500,start:60,maxStart:80,maxEnd:100,end:120,probabilities:[{min:1,max:45,enemyType:ht},{min:46,max:70,enemyType:dt},{min:71,max:85,enemyType:ut},{min:86,max:100,enemyType:ct}]},{baseSpawnRate:2e3,spawnRange:500,start:120,maxStart:140,maxEnd:160,end:180,probabilities:[{min:1,max:45,enemyType:ht},{min:46,max:70,enemyType:dt},{min:71,max:85,enemyType:ut},{min:86,max:100,enemyType:ct}]}]},{id:"waves-lesson-2-review",waves:[{baseSpawnRate:2800,spawnRange:500,start:0,maxStart:20,maxEnd:40,end:60,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]},{baseSpawnRate:2400,spawnRange:500,start:60,maxStart:80,maxEnd:100,end:120,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]},{baseSpawnRate:2e3,spawnRange:500,start:120,maxStart:150,maxEnd:190,end:210,probabilities:[{min:1,max:60,enemyType:ht},{min:61,max:80,enemyType:ut},{min:81,max:100,enemyType:ct}]}]}],bt=[{stage:ne.stage1,availableParameters:["demo"]},{stage:oe.stage1,availableParameters:["basic-vocab"]},{stage:oe.stage2,availableParameters:["basic-vocab"]},{stage:oe.stage3,availableParameters:["basic-vocab"]},{stage:oe.stage4,availableParameters:["basic-vocab"]},{stage:oe.review,availableParameters:["basic-vocab-review"]},{stage:le.stage1,availableParameters:["lesson-2"]},{stage:le.stage2,availableParameters:["lesson-2"]},{stage:le.stage3,availableParameters:["lesson-2"]},{stage:le.review,availableParameters:["lesson-2-review"]},{stage:re.stage1,availableParameters:["lesson-2"]},{stage:re.stage2,availableParameters:["lesson-2"]},{stage:re.stage3,availableParameters:["lesson-2"]},{stage:re.review,availableParameters:["lesson-2-review"]},{stage:he.stage1,availableParameters:["base"]},{stage:he.stage2,availableParameters:["base"]},{stage:he.stage3,availableParameters:["base"]},{stage:he.review,availableParameters:["base-review"]},{stage:ue.stage1,availableParameters:["base"]},{stage:ue.stage2,availableParameters:["base"]},{stage:ue.stage3,availableParameters:["base"]},{stage:ue.review,availableParameters:["base-review"]},{stage:ce.stage1,availableParameters:["base"]},{stage:ce.stage2,availableParameters:["base"]},{stage:ce.stage3,availableParameters:["base"]},{stage:ce.review,availableParameters:["base-review"]},{stage:de.stage1,availableParameters:["base"]},{stage:de.stage2,availableParameters:["base"]},{stage:de.stage3,availableParameters:["base"]},{stage:de.stage4,availableParameters:["base"]},{stage:de.review,availableParameters:["base-review"]},{stage:ge.stage1,availableParameters:["base"]},{stage:ge.stage2,availableParameters:["base"]},{stage:ge.stage3,availableParameters:["base"]},{stage:ge.review,availableParameters:["base-review"]},{stage:me.stage1,availableParameters:["base"]},{stage:me.stage2,availableParameters:["base"]},{stage:me.stage3,availableParameters:["base"]},{stage:me.review,availableParameters:["base-review"]},{stage:pe.stage1,availableParameters:["base"]},{stage:pe.stage2,availableParameters:["base"]},{stage:pe.stage3,availableParameters:["base"]},{stage:pe.stage4,availableParameters:["base"]},{stage:pe.review,availableParameters:["base-review"]},{stage:fe.stage1,availableParameters:["base"]},{stage:fe.stage2,availableParameters:["base"]},{stage:fe.stage3,availableParameters:["base"]},{stage:fe.stage4,availableParameters:["base"]},{stage:fe.review,availableParameters:["base-review"]},{stage:be.stage1,availableParameters:["base"]},{stage:be.stage2,availableParameters:["base"]},{stage:be.stage3,availableParameters:["base"]},{stage:be.review,availableParameters:["base-review"]},{stage:ye.stage1,availableParameters:["base"]},{stage:ye.stage2,availableParameters:["base"]},{stage:ye.stage3,availableParameters:["base"]},{stage:ye.review,availableParameters:["base-review"]},{stage:ve.stage1,availableParameters:["base"]},{stage:ve.stage2,availableParameters:["base"]},{stage:ve.stage3,availableParameters:["base"]},{stage:ve.review,availableParameters:["base-review"]},{stage:we.stage1,availableParameters:["base"]},{stage:we.stage2,availableParameters:["base"]},{stage:we.stage3,availableParameters:["base"]},{stage:we.review,availableParameters:["base-review"]},{stage:ke.stage1,availableParameters:["base"]},{stage:ke.stage2,availableParameters:["base"]},{stage:ke.stage3,availableParameters:["base"]},{stage:ke.review,availableParameters:["base-review"]},{stage:Se.stage1,availableParameters:["base"]},{stage:Se.stage2,availableParameters:["base"]},{stage:Se.stage3,availableParameters:["base"]},{stage:Se.review,availableParameters:["base-review"]},{stage:Te.stage1,availableParameters:["base"]},{stage:Te.stage2,availableParameters:["base"]},{stage:Te.stage3,availableParameters:["base"]},{stage:Te.stage4,availableParameters:["base"]},{stage:Te.review,availableParameters:["base-review"]},{stage:Ie.stage1,availableParameters:["base"]},{stage:Ie.stage2,availableParameters:["base"]},{stage:Ie.stage3,availableParameters:["base"]},{stage:Ie.stage4,availableParameters:["base"]},{stage:Ie.review,availableParameters:["base-review"]},{stage:xe.stage1,availableParameters:["base"]},{stage:xe.stage2,availableParameters:["base"]},{stage:xe.stage3,availableParameters:["base"]},{stage:xe.stage4,availableParameters:["base"]},{stage:xe.review,availableParameters:["base-review"]},{stage:Oe.stage1,availableParameters:["base"]},{stage:Oe.stage2,availableParameters:["base"]},{stage:Oe.stage3,availableParameters:["base"]},{stage:Oe.review,availableParameters:["base-review"]},{stage:Me.stage1,availableParameters:["base"]},{stage:Me.stage2,availableParameters:["base"]},{stage:Me.stage3,availableParameters:["base"]},{stage:Me.review,availableParameters:["base-review"]},{stage:Pe.stage1,availableParameters:["base"]},{stage:Pe.stage2,availableParameters:["base"]},{stage:Pe.stage3,availableParameters:["base"]},{stage:Pe.review,availableParameters:["base-review"]},{stage:Be.stage1,availableParameters:["base"]},{stage:Be.stage2,availableParameters:["base"]},{stage:Be.stage3,availableParameters:["base"]},{stage:Be.review,availableParameters:["base-review"]},{stage:We.stage1,availableParameters:["base"]},{stage:We.stage2,availableParameters:["base"]},{stage:We.stage3,availableParameters:["base"]},{stage:We.review,availableParameters:["base-review"]},{stage:Ce.stage1,availableParameters:["base"]},{stage:Ce.stage2,availableParameters:["base"]},{stage:Ce.stage3,availableParameters:["base"]},{stage:Ce.stage4,availableParameters:["base"]},{stage:Ce.review,availableParameters:["base-review"]},{stage:ze.stage1,availableParameters:["base"]},{stage:ze.stage2,availableParameters:["base"]},{stage:ze.stage3,availableParameters:["base"]},{stage:ze.stage4,availableParameters:["base"]},{stage:ze.review,availableParameters:["base-review"]},{stage:Le.stage1,availableParameters:["base"]},{stage:Le.stage2,availableParameters:["base"]},{stage:Le.stage3,availableParameters:["base"]},{stage:Le.stage4,availableParameters:["base"]},{stage:Le.review,availableParameters:["base-review"]},{stage:Ee.stage1,availableParameters:["base"]},{stage:Ee.stage2,availableParameters:["base"]},{stage:Ee.stage3,availableParameters:["base"]},{stage:Ee.review,availableParameters:["base-review"]},{stage:Re.stage1,availableParameters:["base"]},{stage:Re.stage2,availableParameters:["base"]},{stage:Re.stage3,availableParameters:["base"]},{stage:Re.review,availableParameters:["base-review"]},{stage:Ye.stage1,availableParameters:["base"]},{stage:Ye.stage2,availableParameters:["base"]},{stage:Ye.stage3,availableParameters:["base"]},{stage:Ye.stage4,availableParameters:["base"]},{stage:Ye.review,availableParameters:["base-review"]},{stage:Xe.stage1,availableParameters:["base"]},{stage:Xe.stage2,availableParameters:["base"]},{stage:Xe.stage3,availableParameters:["base"]},{stage:Xe.stage4,availableParameters:["base"]},{stage:Xe.review,availableParameters:["base-review"]},{stage:He.stage1,availableParameters:["base"]},{stage:He.stage2,availableParameters:["base"]},{stage:He.stage3,availableParameters:["base"]},{stage:He.stage4,availableParameters:["base"]},{stage:He.review,availableParameters:["base-review"]},{stage:Ge.stage1,availableParameters:["base"]},{stage:Ge.stage2,availableParameters:["base"]},{stage:Ge.stage3,availableParameters:["base"]},{stage:Ge.stage4,availableParameters:["base"]},{stage:Ge.review,availableParameters:["base-review"]},{stage:Fe.stage1,availableParameters:["base"]},{stage:Fe.stage2,availableParameters:["base"]},{stage:Fe.stage3,availableParameters:["base"]},{stage:Fe.stage4,availableParameters:["base"]},{stage:Fe.stage5,availableParameters:["base"]},{stage:Fe.review,availableParameters:["base-review"]},{stage:Ae.stage1,availableParameters:["base"]},{stage:Ae.stage2,availableParameters:["base"]},{stage:Ae.stage3,availableParameters:["base"]},{stage:Ae.stage4,availableParameters:["base"]},{stage:Ae.review,availableParameters:["base-review"]},{stage:De.stage1,availableParameters:["base"]},{stage:De.stage2,availableParameters:["base"]},{stage:De.stage3,availableParameters:["base"]},{stage:De.stage4,availableParameters:["base"]},{stage:De.review,availableParameters:["base-review"]},{stage:qe.stage1,availableParameters:["base"]},{stage:qe.stage2,availableParameters:["base"]},{stage:qe.stage3,availableParameters:["base"]},{stage:qe.stage4,availableParameters:["base"]},{stage:qe.stage5,availableParameters:["base"]},{stage:qe.review,availableParameters:["base-review"]},{stage:_e.stage1,availableParameters:["base"]},{stage:_e.stage2,availableParameters:["base"]},{stage:_e.stage3,availableParameters:["base"]},{stage:_e.review,availableParameters:["base-review"]},{stage:Ve.stage1,availableParameters:["base"]},{stage:Ve.stage2,availableParameters:["base"]},{stage:Ve.stage3,availableParameters:["base"]},{stage:Ve.review,availableParameters:["base-review"]},{stage:je.stage1,availableParameters:["base"]},{stage:je.stage2,availableParameters:["base"]},{stage:je.stage3,availableParameters:["base"]},{stage:je.review,availableParameters:["base-review"]},{stage:Ne.stage1,availableParameters:["base"]},{stage:Ne.stage2,availableParameters:["base"]},{stage:Ne.stage3,availableParameters:["base"]},{stage:Ne.stage4,availableParameters:["base"]},{stage:Ne.stage5,availableParameters:["base"]},{stage:Ne.review,availableParameters:["base-review"]},{stage:Ze.stage1,availableParameters:["base"]},{stage:Ze.stage2,availableParameters:["base"]},{stage:Ze.stage3,availableParameters:["base"]},{stage:Ze.stage4,availableParameters:["base"]},{stage:Ze.stage5,availableParameters:["base"]},{stage:Ze.review,availableParameters:["base-review"]},{stage:Ue.stage1,availableParameters:["base"]},{stage:Ue.stage2,availableParameters:["base"]},{stage:Ue.stage3,availableParameters:["base"]},{stage:Ue.stage4,availableParameters:["base"]},{stage:Ue.stage5,availableParameters:["base"]},{stage:Ue.review,availableParameters:["base-review"]},{stage:Ke.stage1,availableParameters:["base"]},{stage:Ke.stage2,availableParameters:["base"]},{stage:Ke.stage3,availableParameters:["base"]},{stage:Ke.stage4,availableParameters:["base"]},{stage:Ke.stage5,availableParameters:["base"]},{stage:Ke.review,availableParameters:["base-review"]}],yt={screenFadeTime:750,labels:{music:"Music",soundEffects:"Sound Effects",textSize:"Text Size",blood:"Blood",return:"Save and Exit"},audio:{backgroundMusic:M.catchTheMystery,menuMove:u},ui:{optionSelectorColor:16776994,valueSelectorColor:16776994},fonts:{labelSize:22,labelTint:16777215,optionSize:22,optionTint:16777215}},vt={music:"music",soundEffects:"soundEffects",textSize:"textSize",blood:"blood",values:{on:"On",off:"Off",normal:"Normal",large:"Large",red:"Red",green:"Green"},defaults:{music:"On",soundEffects:"On",textSize:"Normal",blood:"Red"}},wt=2e3,kt="Creating Your Account",St=250,Tt={loadingSize:22,loadingTint:16777215};function It(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function xt(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ot=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.content=t,this.availableContent=It(this.content),this.returnedContent=[],this.reservedContent=[]}var t,i,a;return t=e,(i=[{key:"getRandomWord",value:function(){if(0===this.availableContent.length){if(0===this.returnedContent.length)return null;this.refreshContent()}var e=s.a.Math.RND.between(0,this.availableContent.length-1),t=this.availableContent.splice(e,1)[0];return t.review=!1,this.reservedContent.push(t),t}},{key:"getRandomWords",value:function(e){for(var t=this,i=[],a=0;a<e;a+=1){var s=this.getRandomWord();if(null==s)return i.forEach((function(e){return t.releaseWord(e)})),null;i.push(s)}return i}},{key:"releaseWord",value:function(e){var t=this.reservedContent.findIndex((function(t){return t.id===e.id})),i=this.reservedContent.splice(t,1)[0];this.returnedContent.push(i)}},{key:"resetContent",value:function(){this.availableContent=this.availableContent.concat(this.returnedContent),this.availableContent=this.availableContent.concat(this.reservedContent),this.returnedContent=[],this.reservedContent=[],this.availableContent.sort((function(e,t){return e.id-t.id}))}},{key:"l2WithGender",value:function(e){return null!=e.gender?"".concat(e.language2,"(").concat(e.gender,")"):e.language2}},{key:"refreshContent",value:function(){this.availableContent=this.availableContent.concat(this.returnedContent),this.availableContent.sort((function(e,t){return e.id-t.id})),this.returnedContent=[]}}])&&xt(t.prototype,i),a&&xt(t,a),e}(),Mt=function(e,t){return"".concat(e,"-").concat(t)},Pt=function(e){return e>=65&&e<=90};function Bt(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Wt=function(e){for(var t=e.length-1;t>0;t-=1){var i=Math.floor(Math.random()*(t+1)),a=[e[i],e[t]];e[t]=a[0],e[i]=a[1]}return e},Ct=function(e){return Bt(new Set(e))},zt=function(e){return se.names[Object.keys(se).find((function(t){return se[t]===e}))]},Lt=function(e){return se.descriptions[Object.keys(se).find((function(t){return se[t]===e}))]},Et=function(e){switch(e){case Y.pistol:return W.frames.weaponPistol;case Y.shotgun:return W.frames.weaponShotgun;case Y.rifle:return W.frames.weaponRifle;case Y.rocketLauncher:return W.frames.weaponRocketLauncher;default:throw Error("Invalid weapon value")}},Rt={MINIGAME_ITEM_SLOTS:8},Yt=function(e){var t=e.toLowerCase();return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/á/g,"a")).replace(/é/g,"e")).replace(/í/g,"i")).replace(/ó/g,"o")).replace(/[úü]/g,"u")).replace(/ñ/g,"n")).replace(/\s/g,"")).replace(/[^a-zA-Z]+/g,"")};i(256);function Xt(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ht=[vt.music,vt.soundEffects,vt.textSize,vt.blood],Gt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.db=t.db}var t,i,a;return t=e,(i=[{key:"musicEnabled",value:function(){return this.getOptionValue(vt.music)===vt.values.on}},{key:"soundEffectsEnabled",value:function(){return this.getOptionValue(vt.soundEffects)===vt.values.on}},{key:"getOptionValue",value:function(e){if(!Ht.includes(e))throw Error("Invalid option key: ".concat(e));var t=vt.defaults[e],i=null;return null!=(i=this.db.isUserLoggedIn()&&this.db.userProfileLoaded?this.db.userProfile.options:this.getLocalUserOptions())&&(t=i[e]),t}},{key:"setOptions",value:function(e,t){e.forEach((function(e){if(!Ht.includes(e.key))throw Error("Invalid option key: ".concat(e.key))})),Ht.forEach((function(t){if(null==e.find((function(e){return e.key===t})))throw Error("Missing option key: ".concat(t))})),this.db.isUserLoggedIn()&&this.db.userProfileLoaded?this.savePersistedUserOptions(e,t):this.saveLocalUserOptions(e,t)}},{key:"getLocalUserOptions",value:function(){return null==this.game.localUserOptions&&this.createLocalUserOptions(),this.game.localUserOptions}},{key:"createLocalUserOptions",value:function(){this.game.localUserOptions={music:vt.defaults[vt.music],soundEffects:vt.defaults[vt.soundEffects],textSize:vt.defaults[vt.textSize],blood:vt.defaults[vt.blood]}}},{key:"saveLocalUserOptions",value:function(e,t){this.game.localUserOptions={music:e.find((function(e){return e.key===vt.music})).value,soundEffects:e.find((function(e){return e.key===vt.soundEffects})).value,textSize:e.find((function(e){return e.key===vt.textSize})).value,blood:e.find((function(e){return e.key===vt.blood})).value},t()}},{key:"savePersistedUserOptions",value:function(e,t){var i={options:{music:e.find((function(e){return e.key===vt.music})).value,soundEffects:e.find((function(e){return e.key===vt.soundEffects})).value,textSize:e.find((function(e){return e.key===vt.textSize})).value,blood:e.find((function(e){return e.key===vt.blood})).value}};this.updateUserProfile(i,t)}},{key:"updateUserProfile",value:function(e,t){var i=this,a=this.db.getCurrentUserProfile();null!=a?a.update(e).then((function(){i.db.loadUserProfile((function(){null!=t&&t(!0)}),i)})):null!=t&&t(!1)}}])&&Xt(t.prototype,i),a&&Xt(t,a),e}();function Ft(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var At=[W.zombieNormal1,W.zombieNormal2,W.zombieNormal3,W.zombieNormal4,W.zombieNormal5,W.zombieNormal6],Dt=[W.zombieSpecial1,W.zombieSpecial2],qt=[W.zombieReview1,W.zombieReview2],_t=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.stageParameters=i,this.userOptionsManager=new Gt(this.scene.sys.game),this.totalDistance=t.sys.game.config.height-V.height,this.zombies=[],this.damage=0}var t,i,a;return t=e,(i=[{key:"setHitArea",value:function(e){this.hitArea=e}},{key:"moveZombies",value:function(e){var t=this;this.zombies.forEach((function(i){if(i.moving){var a=t.getMovement(i.speed,e);i.y+=a,i.text.y+=a,i.setDepth(r.minigame.zombie+i.y),i.text.setDepth(r.minigame.zombieText+i.text.y-t.scene.ui.padding),t.setZombieWordBg(i),s.a.Geom.Intersects.RectangleToRectangle(i.getBounds(),t.hitArea)&&(i.moving=!1,i.attacking=!0,i.play(Mt(i.image,n.zombieAttack)))}}))}},{key:"applyZombieDamage",value:function(e){this.scene.audioManager.playSound(E.audio.soundEffects.zombieAttack),this.damage+=this.stageParameters.enemies.attackDamage,e.alive=!1,e.words[e.hits].missed=!0,this.stageParameters.enemies.showAnswerOnAttack&&(e.answer=e.words[e.hits].language2,e.showAnswer=!0)}},{key:"checkZombieAttack",value:function(){var e=this.damage;return this.damage=0,-e}},{key:"destroyDeadZombies",value:function(){var e=this,t=[];return this.zombies.filter((function(e){return!e.alive})).forEach((function(i){t=t.concat(i.words),i.text.destroy(),i.showAnswer?(i.visible=!1,e.showZombieAnswerWord(i)):(i.wordBgGraphics.destroy(),i.destroy())})),this.zombies=this.zombies.filter((function(e){return e.alive})),t}},{key:"spawnZombie",value:function(e){var t=this.getZombieImage(e.enemyType),i=this.scene.add.sprite(e.xPosition,-35,t,0);i.setDepth(r.minigame.zombie),i.setOrigin(this.scene.ui.zombieOriginX,this.scene.ui.zombieOriginY),i.displayWidth=this.getZombieImageSize(e.enemyType),i.displayHeight=this.getZombieImageSize(e.enemyType),i.image=t,i.type=e.enemyType,i.speed=e.speed,i.health=this.getZombieHealth(e.enemyType),i.wordBgGraphics=this.scene.add.graphics(),i.wordBgGraphics.fillStyle(E.ui.zombieWordBgColor),i.wordBgGraphics.setDepth(r.minigame.zombieTextBackground),i.words=e.words,i.alive=!0,i.moving=!0,i.attacking=!1,i.showAnswer=!1,i.hits=0,this.setZombieWord(i);var a=this.getZombieMoveAnimation(e.enemyType);i.play(Mt(t,a)),i.on("animationcomplete",this.zombieAnimationComplete,this),this.zombies.push(i),this.playZombieSpawnSound(e.enemyType)}},{key:"playZombieSpawnSound",value:function(e){switch(e){case ht:case dt:this.scene.audioManager.playSound(E.audio.soundEffects.normalZombieSpawn);break;case ut:case ct:this.scene.audioManager.playSound(E.audio.soundEffects.specialZombieSpawn)}}},{key:"checkGuess",value:function(e,t){var i=this,a=Yt(e),s=!1;return this.zombies.some((function(e){var n=i.getCurrentZombieWord(e);return a===Yt(n.language2)&&(e.words[e.hits].missed=!1,i.shootZombie(e,t),s=!0),s})),s||this.zombies.some((function(e){var n=i.getCurrentZombieWord(e),o=null!=n.alternatives?n.alternatives.map((function(e){return Yt(e)})):null;return null!=o&&o.includes(a)&&(e.words[e.hits].missed=!1,i.shootZombie(e,t),s=!0),s})),s}},{key:"checkMercenary",value:function(e,t){var i=this,a=Yt(e);return this.zombies.some((function(e){var s=i.getCurrentZombieWord(e);return a===Yt(s.language1)&&(t&&(e.words[e.hits].missed=!0,i.stageParameters.enemies.showAnswerOnMerc&&(e.answer=s.language2,e.showAnswer=!0),i.shootZombie(e,Y.pistol)),!0)}))}},{key:"destroyAllZombies",value:function(){var e=[];return this.zombies.forEach((function(t){e=e.concat(t.words),t.text.destroy(),t.wordBgGraphics.destroy(),t.destroy()})),this.zombies=[],e}},{key:"shootZombie",value:function(e,t){var i=this.getShotImageConfig(t),a=this.scene.add.sprite(e.x,e.y-this.getZombieImageSize(e.type)/2,i.image);a.setDepth(r.minigame.shotBlast),a.on("animationcomplete",(function(e,t,i){return i.destroy()}),this),a.play(i.animation),e.moving=!1,e.hits+=1,e.health-=Y.damage[t],this.playShootZombieSound(t),e.health<=0?this.killShotZombie(e):this.injuryShotZombie(e)}},{key:"playShootZombieSound",value:function(e){switch(e){case Y.pistol:this.scene.audioManager.playSound(E.audio.soundEffects.pistolHit);break;case Y.shotgun:this.scene.audioManager.playSound(E.audio.soundEffects.shotgunHit)}}},{key:"injuryShotZombie",value:function(e){e.play(Mt(e.image,n.zombieDamage)),this.setZombieWord(e)}},{key:"killShotZombie",value:function(e){e.play(Mt(e.image,n.zombieDie));var t=this.getSplatterImage();null!=t&&this.scene.add.sprite(this.getSplatterLocation(e.x),e.y,t).setDepth(r.minigame.splatter).setScale(2)}},{key:"getMovement",value:function(e,t){return e*t*this.totalDistance/1e6}},{key:"getSplatterImage",value:function(){var e=s.a.Math.RND.between(1,E.splatterVarieties),t=this.userOptionsManager.getOptionValue(vt.blood),i=null;return t===vt.values.red?i=W.bloodSplatter:t===vt.values.green&&(i=W.bloodSplatterGreen),null!=i?"".concat(i,"-").concat(e):null}},{key:"getSplatterLocation",value:function(e){var t=e+-5;return s.a.Math.RND.between(t-E.splatterRange,t+E.splatterRange)}},{key:"getZombieImageSize",value:function(e){var t=this.scene.ui.zombieWidth;return e===ct&&(t*=E.bigZombieSizeModifier),t}},{key:"getZombieHealth",value:function(e){return e===ct?this.stageParameters.enemies.bruiserZombieHealth:e===ut?this.stageParameters.enemies.sprinterZombieHealth:this.stageParameters.enemies.normalZombieHealth}},{key:"getZombieImage",value:function(e){return e===ut||e===ct?s.a.Math.RND.pick(Dt):e===dt?s.a.Math.RND.pick(qt):s.a.Math.RND.pick(At)}},{key:"getShotImageConfig",value:function(e){var t=this.userOptionsManager.getOptionValue(vt.blood);return e===Y.shotgun?t===vt.values.green?{image:W.shotgunBlastGreen,animation:n.shotgunBlastGreenExplode}:{image:W.shotgunBlast,animation:n.shotgunBlastExplode}:t===vt.values.green?{image:W.shotBlastGreen,animation:n.shotBlastGreenExplode}:{image:W.shotBlast,animation:n.shotBlastExplode}}},{key:"getZombieMoveAnimation",value:function(e){return e===ut?n.zombieRun:n.zombieWalk}},{key:"zombieAnimationComplete",value:function(e,t,i){var a=Mt(i.image,n.zombieAttack),s=Mt(i.image,n.zombieDie),o=Mt(i.image,n.zombieDamage);e.key===a&&t.isLast?this.applyZombieDamage(i):e.key===s?i.alive=!1:e.key===o&&(i.moving=!0,i.play(Mt(i.image,this.getZombieMoveAnimation(i.type))))}},{key:"showZombieAnswerWord",value:function(e){e.text.destroy(),e.text=this.scene.add.bitmapText(0,e.y+this.scene.ui.zombieWordMargin,q,e.answer,this.getFontSize()),e.text.x=e.x-e.text.width/2,e.text.setDepth(r.minigame.zombieText+e.text.y-this.scene.ui.padding),e.text.setTintFill(E.fonts.zombieTint),this.setZombieWordBg(e),this.setZombieAnswerTimers(e)}},{key:"setZombieAnswerTimers",value:function(e){e.answerFlashOn=!1,e.answerFlashTimer=this.scene.time.addEvent({delay:E.answerFlashDelay,callback:function(e){e.answerFlashOn=!e.answerFlashOn,e.answerFlashOn?e.text.setTintFill(E.fonts.zombieAnswerFlashTint):e.text.setTintFill(E.fonts.zombieTint)},args:[e],callbackScope:this,repeat:-1}),e.answerDisplayTimer=this.scene.time.addEvent({delay:E.answerDisplayTime,callback:function(e){e.answerFlashTimer.destroy(),e.text.destroy(),e.wordBgGraphics.destroy(),e.destroy()},args:[e],callbackScope:this,repeat:0})}},{key:"setZombieWord",value:function(e){null!=e.text&&e.text.destroy(),e.text=this.scene.add.bitmapText(0,e.y+this.scene.ui.zombieWordMargin,q,e.words[e.hits].language1,this.getFontSize()),e.text.x=e.x-e.text.width/2,e.text.setDepth(r.minigame.zombieText+e.text.y-this.scene.ui.padding),e.text.setTintFill(E.fonts.zombieTint),this.setZombieWordBg(e)}},{key:"setZombieWordBg",value:function(e){e.wordBgGraphics.clear(),e.wordBgGraphics.fillStyle(E.ui.zombieWordBgColor),e.wordBgGraphics.fillRect(e.text.x-this.scene.ui.padding,e.text.y-this.scene.ui.padding,e.text.width+2*this.scene.ui.padding,e.text.height+2*this.scene.ui.padding),e.wordBgGraphics.setDepth(r.minigame.zombieTextBackground+e.text.y-this.scene.ui.padding)}},{key:"getCurrentZombieWord",value:function(e){return e.words[e.hits]}},{key:"getFontSize",value:function(){return this.userOptionsManager.getOptionValue(vt.textSize)===vt.values.normal?E.fonts.zombieSize:E.fonts.zombieSizeLarge}}])&&Ft(t.prototype,i),a&&Ft(t,a),e}(),Vt=[{item:gt.sprinterZombie,stage:oe.stage1},{item:gt.foodTier1,stage:oe.stage2},{item:gt.cash,stage:oe.stage3},{item:gt.mercenary,stage:oe.stage3},{item:gt.reviewZombie,stage:oe.review},{item:gt.bruiserZombie,stage:le.stage1},{item:gt.bruiserZombie,stage:re.stage1},{item:gt.shotgun,stage:le.stage2},{item:gt.shotgun,stage:re.stage2}];function jt(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Nt=[gt.normalZombie],Zt=[gt.sprinterZombie,gt.foodTier1],Ut=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=t}var t,i,a;return t=e,(i=[{key:"isUnlocked",value:function(e){if(!this.db.isUserLoggedIn())return Nt.includes(e)||Zt.includes(e);if(this.db.userProfileLoaded){var t=this.db.userProfile.unlockedItems;return Nt.includes(e)||null!=t&&t.includes(e)}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"getUnlockedItems",value:function(){if(!this.db.isUserLoggedIn())return Nt.concat(Zt);if(this.db.userProfileLoaded){var e=this.db.userProfile.unlockedItems;return null!=e?e:[]}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"getUnlockedItemsForStage",value:function(e){return Vt.filter((function(t){return t.stage===e})).map((function(e){return e.item}))}}])&&jt(t.prototype,i),a&&jt(t,a),e}();function Kt(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Jt=function(){function e(t,i,a,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.stageParams=i,this.vocab=a,this.reviewVocabManager=s,this.currentTime=n,this.nextSpawnTime=this.getSpawnDelay(n),this.prevSpawnColumn=0,this.spawnPadding=this.scene.sys.game.config.width*E.sidePaddingPercent/100,this.unlockableManager=new Ut(this.scene.game.db)}var t,i,a;return t=e,(i=[{key:"getSpawn",value:function(e){var t={canSpawn:!1};if(e>=this.nextSpawnTime){var i=this.getRandomEnemyType(e),a=this.getWords(i);null!=a&&(t.canSpawn=!0,t.enemyType=i,t.xPosition=this.getSpawnLocation(),t.speed=this.getFallSpeed(t.enemyType),t.words=a),this.nextSpawnTime=e+this.getSpawnDelay(e)}return t}},{key:"getSpawnLocation",value:function(){for(var e=this.prevSpawnColumn;Math.abs(e-this.prevSpawnColumn)<=2;)e=s.a.Math.RND.between(0,E.zombieColumns-1);return this.prevSpawnColumn=e,this.spawnPadding+(this.scene.sys.game.config.width-2*this.spawnPadding)*e/E.zombieColumns}},{key:"getSpawnDelay",value:function(e){var t=0,i=this.getCurrentWave(e);if(null!=i){var a=1,n=1;e<i.maxStart?(a=(e-i.start)/(i.maxStart-i.start),n=s.a.Math.Easing.Cubic.InOut(a)):e>i.maxEnd&&(a=(e-i.maxEnd)/(i.end-i.maxEnd),n=1-s.a.Math.Easing.Cubic.InOut(a)),t=(i.baseSpawnRate*(1-n)+i.baseSpawnRate+s.a.Math.RND.between(-i.spawnRange,i.spawnRange))/1e3}else{var o=this.getNextWave(e);t=null!=o?o.start-e:99999}return t}},{key:"getCurrentWave",value:function(e){return this.stageParams.waves.find((function(t){return t.start<=e&&t.end>e}))}},{key:"getNextWave",value:function(e){return this.stageParams.waves.find((function(t){return t.start>e}))}},{key:"getFallSpeed",value:function(e){var t=this.scene.stageParameters.baseFallSpeed+s.a.Math.RND.between(-this.scene.stageParameters.fallRange,this.scene.stageParameters.fallRange);return e===ut?t*=this.stageParams.enemies.sprinterZombieSpeedModifier:e===ct&&(t*=this.stageParams.enemies.bruiserZombieSpeedModifier),t}},{key:"getWordCount",value:function(e){return e===ct?this.stageParams.enemies.bruiserZombieHealth:e===ut?this.stageParams.enemies.sprinterZombieHealth:this.stageParams.enemies.normalZombieHealth}},{key:"getRandomEnemyType",value:function(e){var t=this.getCurrentWave(e),i=s.a.Math.RND.between(1,100),a=t.probabilities.find((function(e){return e.min<=i&&e.max>=i})),n=null!=a?a.enemyType:ht;return this.unlockableManager.isUnlocked(n)||(n=ht),n}},{key:"getWords",value:function(e){var t=this.getWordCount(e);if(e===dt){var i=this.reviewVocabManager.getRandomReviewWord();return null!=i?[i]:null}return this.vocab.getRandomWords(t)}}])&&Kt(t.prototype,i),a&&Kt(t,a),e}(),Qt=function(e){var t={};return t.textPadding=D.textPadding,t.padding=D.padding,t.paddingBig=D.paddingBig,t.paddingSmall=D.paddingSmall,t.w=e.width,t.h=e.height,t.left=0,t.top=0,t.center=.5,t.right=1,t.bottom=1,t.w_2=t.w/2,t.w_3=t.w/3,t.w_4=t.w/4,t.w_5=t.w/5,t.w_6=t.w/6,t.w_7=t.w/7,t.w_8=t.w/8,t.w_9=t.w/9,t.w_10=t.w/10,t.w_1p=.01*t.w,t.w_5p=.05*t.w,t.w_10p=.1*t.w,t.w_125p=.125*t.w,t.w_15p=.15*t.w,t.w_20p=.2*t.w,t.w_25p=.25*t.w,t.w_30p=.3*t.w,t.w_33p=.33*t.w,t.w_35p=.35*t.w,t.w_40p=.4*t.w,t.w_45p=.45*t.w,t.w_50p=.5*t.w,t.w_55p=.55*t.w,t.w_60p=.6*t.w,t.w_65p=.65*t.w,t.w_66p=.66*t.w,t.w_70p=.7*t.w,t.w_75p=.75*t.w,t.w_80p=.8*t.w,t.w_85p=.85*t.w,t.w_875p=.875*t.w,t.w_90p=.9*t.w,t.w_95p=.95*t.w,t.h_2=t.h/2,t.h_3=t.h/3,t.h_4=t.h/4,t.h_5=t.h/5,t.h_6=t.h/6,t.h_7=t.h/7,t.h_8=t.h/8,t.h_9=t.h/9,t.h_10=t.h/10,t.h_1p=.01*t.h,t.h_5p=.05*t.h,t.h_10p=.1*t.h,t.h_15p=.15*t.h,t.h_20p=.2*t.h,t.h_25p=.25*t.h,t.h_30p=.3*t.h,t.h_33p=.33*t.h,t.h_35p=.35*t.h,t.h_40p=.4*t.h,t.h_45p=.45*t.h,t.h_50p=.5*t.h,t.h_55p=.55*t.h,t.h_60p=.6*t.h,t.h_65p=.65*t.h,t.h_66p=.66*t.h,t.h_70p=.7*t.h,t.h_75p=.75*t.h,t.h_80p=.8*t.h,t.h_85p=.85*t.h,t.h_90p=.9*t.h,t.h_95p=.95*t.h,t},$t=function(e){var t=Qt(e);return{hudHeight:V.height,hudBufferHeight:V.bufferHeight,weaponBorderX:t.padding,get weaponBorderY(){return t.h-this.hudHeight+t.padding},get weaponBorderWidth(){return this.hudHeight/2-2*t.padding},weaponBorderOriginX:t.left,weaponBorderOriginY:t.Top,get weaponX(){return this.weaponBorderX+this.weaponBorderWidth/2},get weaponY(){return this.weaponBorderY+this.weaponBorderWidth/2},get weaponWidth(){return this.weaponBorderWidth},get weaponHeight(){return this.weaponBorderWidth},weaponOrigin:t.center,get ammoIconWidth(){return.1*this.weaponBorderWidth},get ammoIconPadding(){return.04*this.weaponBorderWidth},get ammoIconY(){return this.weaponBorderY+.7*this.weaponHeight},itemBorderX:t.padding,get itemBorderWidth(){return this.hudHeight/2-2*t.padding},get itemBorderY(){return this.weaponBorderY+this.itemBorderWidth+2*t.padding},itemBorderOriginX:t.left,itemBorderOriginY:t.top,get healthIconX(){return this.weaponBorderX+this.weaponBorderWidth+t.paddingBig},get healthIconY(){return t.h-this.hudHeight+t.padding+this.weaponBorderWidth/2},healthIconWidth:t.w_5p,healthIconOriginX:t.left,healthIconOriginY:t.center,healthValueX:function(e){return e.x+e.displayWidth+t.w_1p/2},get healthValueY(){return t.h-this.hudHeight+t.padding+this.weaponBorderWidth/2},healthValueWidth:1.5*t.w_1p,healthValuePadding:t.w_1p/2,healthValueHeight:t.w_5p,healthValueOriginX:t.left,healthValueOriginY:t.center,get killIconX(){return this.weaponBorderX+this.weaponBorderWidth+t.paddingBig},get killIconY(){return t.h-this.hudHeight+3*t.padding+this.weaponBorderWidth+this.itemBorderWidth/2},killIconWidth:t.w_5p,killIconOriginX:t.left,killIconOriginY:t.center,get killValueX(){return this.killIconX+this.killIconWidth+t.padding},get killValueY(){return this.killIconY},killValueOriginX:t.left,killValueOriginY:t.center,get cashIconX(){return this.killValueX+t.w_10p},get cashIconY(){return t.h-this.hudHeight+3*t.padding+this.weaponBorderWidth+this.itemBorderWidth/2},cashIconWidth:t.w_5p,cashIconOriginX:t.left,cashIconOriginY:t.center,get cashValueX(){return this.cashIconX+this.cashIconWidth+t.padding},get cashValueY(){return this.cashIconY},cashValueOriginX:t.left,cashValueOriginY:t.center,get timerIconX(){return this.cashValueX+t.w_15p},get timerIconY(){return t.h-this.hudHeight+3*t.padding+this.weaponBorderWidth+this.itemBorderWidth/2},timerIconWidth:t.w_5p,timerIconOriginX:t.left,timerIconOriginY:t.center,get timerValueX(){return this.timerIconX+this.timerIconWidth+t.padding},get timerValueY(){return this.timerIconY},timerValueOriginX:t.left,timerValueOriginY:t.center,get messageBorderX(){return this.timerValueX+t.h_20p},get messageBorderY(){return t.h-this.hudHeight+t.padding},get messageBorderWidth(){return t.w-this.messageBorderX-t.padding},get messageBorderHeight(){return this.hudHeight-2*t.padding},messageBorderOriginX:t.left,messageBorderOriginY:t.Top,textEntryAreaX:t.w_25p-t.padding,get textEntryAreaY(){return t.h-this.hudHeight-t.h_5p-3*t.padding},textEntryAreaWidth:t.w_50p+2*t.padding,textEntryAreaHeight:t.h_5p+2*t.padding,textEntryX:t.w_25p,get textEntryY(){return t.h-this.hudHeight-t.h_5p-t.padding},textEntryWidth:t.w_50p,textEntryHeight:t.h_5p,textEntryOriginX:t.left,textEntryOriginY:t.top,brickX:0,get brickY(){return t.h-this.hudHeight-this.hudBufferHeight},brickWidth:t.w,get brickHeight(){return this.hudBufferHeight},get statusImageX(){return this.timerValueX+t.h_20p+this.statusImageWidth/2+t.paddingBig},get statusImageY(){return t.h-this.hudHeight/2},statusImageWidth:t.w_10p,statusImageHeight:t.w_10p,statusImageOriginX:t.center,statusImageOriginY:t.center,get statusMessageX(){var e=this.statusImageX+this.statusImageWidth/2;return e+(t.w-e)/2},get statusMessageY(){return t.h-this.hudHeight/2},get statusMessageMaxWidth(){return this.messageBorderWidth-this.statusImageWidth-6*t.padding},statusMessageHeight:t.hudHeight,statusMessageOriginX:t.center,statusMessageOriginY:t.center,get statusMessageNoImageX(){return this.messageBorderX+this.messageBorderWidth/2},get statusMessageNoImageY(){return this.messageBorderY+this.messageBorderHeight/2},get statusMessageNoImageMaxWidth(){return this.messageBorderWidth-2*t.padding}}};function ei(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ti=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.ui=$t(this.scene.sys.game.config)}var t,i,a;return t=e,(i=[{key:"setStatus",value:function(e){if(this.clearCurrentStatus(),this.scene.hudManager.messageBorder.setFrame(W.frames.hudMessageLight),null!=e.image){var t=0;null!=e.frame&&(t=e.frame),this.statusImage=this.scene.add.sprite(this.ui.statusImageX,this.ui.statusImageY,e.image,t),this.statusImage.displayWidth=this.ui.statusImageWidth,this.statusImage.displayHeight=this.ui.statusImageHeight,this.statusImage.setOrigin(this.ui.statusImageOriginX,this.ui.statusImageOriginY),this.statusImage.setDepth(r.hud.ui)}if(null!=e.message){var i=null!=e.image?this.ui.statusMessageX:this.ui.statusMessageNoImageX,a=null!=e.image?this.ui.statusMessageY:this.ui.statusMessageNoImageY,s=null!=e.image?this.ui.statusMessageMaxWidth:this.ui.statusMessageNoImageMaxWidth;this.statusText=this.scene.add.bitmapText(i,a,q,e.message,V.fonts.statusSize),this.statusText.width>s&&(this.statusText.destroy(),this.statusText=this.scene.add.bitmapText(i,a,q,e.message,V.fonts.statusSizeSmall)),this.statusText.setOrigin(this.ui.statusMessageOriginX,this.ui.statusMessageOriginY),this.statusText.setCenterAlign(),this.statusText.setDepth(r.hud.ui),this.statusText.setTintFill(V.fonts.statusTint)}null!=e.displayTime&&e.displayTime>0&&(this.statusTimer=this.scene.time.addEvent({delay:e.displayTime,callback:this.clearCurrentStatus,callbackScope:this}))}},{key:"clearCurrentStatus",value:function(){this.scene.hudManager.messageBorder.setFrame(W.frames.hudMessageDark),null!=this.statusImage&&(this.statusImage.destroy(),this.statusImage=null),null!=this.statusText&&(this.statusText.destroy(),this.statusText=null),null!=this.statusTimer&&(this.statusTimer.remove(),this.statusTimer=null)}}])&&ei(t.prototype,i),a&&ei(t,a),e}();function ii(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ai=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.ui=$t(this.scene.sys.game.config),this.textInputShown=!1,this.inputHandled=!1,this.itemBgGraphics=this.scene.add.graphics(),this.itemBgGraphics.fillStyle(V.ui.itemBackgroundColor),this.itemBgGraphics.setDepth(r.hud.uiBackground)}var t,i,a;return t=e,(i=[{key:"createHud",value:function(e){if(this.hudHeight=this.ui.hudHeight,this.hudBufferHeight=this.ui.hudBufferHeight,this.maxHealth=e.maxHealth,e.weapon&&(this.itemBgGraphics.fillRect(this.ui.weaponBorderX,this.ui.weaponBorderY,this.ui.weaponBorderWidth,this.ui.weaponBorderWidth),this.weaponBorder=this.scene.add.sprite(this.ui.weaponBorderX,this.ui.weaponBorderY,W.hudItemBorder,W.frames.hudItemDark),this.weaponBorder.displayWidth=this.ui.weaponBorderWidth,this.weaponBorder.displayHeight=this.ui.weaponBorderWidth,this.weaponBorder.setOrigin(this.ui.weaponBorderOriginX,this.ui.weaponBorderOriginY),this.weaponBorder.setDepth(r.hud.ui),this.weapon=this.scene.add.sprite(this.ui.weaponX,this.ui.weaponY,W.weapon,W.frames.weaponShotgun),this.weapon.displayWidth=this.ui.weaponWidth,this.weapon.displayHeight=this.ui.weaponHeight,this.weapon.setOrigin(this.ui.weaponOrigin),this.weapon.setDepth(r.hud.ui),this.weapon.visible=!1),e.item&&(this.itemBgGraphics.fillRect(this.ui.itemBorderX,this.ui.itemBorderY,this.ui.itemBorderWidth,this.ui.itemBorderWidth),this.itemBorder=this.scene.add.sprite(this.ui.itemBorderX,this.ui.itemBorderY,W.hudItemBorder,W.frames.hudItemDark),this.itemBorder.displayWidth=this.ui.itemBorderWidth,this.itemBorder.displayHeight=this.ui.itemBorderWidth,this.itemBorder.setOrigin(this.ui.itemBorderOriginX,this.ui.itemBorderOriginY),this.itemBorder.setDepth(r.hud.ui)),e.health){this.healthIcon=this.scene.add.sprite(this.ui.healthIconX,this.ui.healthIconY,W.heart),this.healthIcon.displayWidth=this.ui.healthIconWidth,this.healthIcon.displayHeight=this.ui.healthIconWidth,this.healthIcon.setOrigin(this.ui.healthIconOriginX,this.ui.healthIconOriginY),this.healthIcon.setDepth(r.hud.ui),this.healthBars=[];for(var t=0;t<e.maxHealth;t+=1){var i=0!==t?this.healthBars[t-1]:this.healthIcon,a=this.scene.add.sprite(this.ui.healthValueX(i),this.ui.healthValueY,W.health,0);a.displayWidth=this.ui.healthValueWidth,a.displayHeight=this.ui.healthValueHeight,a.setOrigin(this.ui.healthValueOriginX,this.ui.healthValueOriginY),a.setDepth(r.hud.ui),this.healthBars.push(a)}}e.kills&&(this.killIcon=this.scene.add.sprite(this.ui.killIconX,this.ui.killIconY,W.skull),this.killIcon.displayWidth=this.ui.killIconWidth,this.killIcon.displayHeight=this.ui.killIconWidth,this.killIcon.setOrigin(this.ui.killIconOriginX,this.ui.killIconOriginY),this.killIcon.setDepth(r.hud.ui),this.killValue=this.scene.add.bitmapText(this.ui.killValueX,this.ui.killValueY,q,"000",V.fonts.killSize),this.killValue.setOrigin(this.ui.killValueOriginX,this.ui.killValueOriginY),this.killValue.setDepth(r.hud.ui),this.killValue.setTintFill(V.fonts.killTint)),e.cash&&(this.cashIcon=this.scene.add.sprite(this.ui.cashIconX,this.ui.cashIconY,W.goldCoin),this.cashIcon.displayWidth=this.ui.cashIconWidth,this.cashIcon.displayHeight=this.ui.cashIconWidth,this.cashIcon.setOrigin(this.ui.cashIconOriginX,this.ui.cashIconOriginY),this.cashIcon.setDepth(r.hud.ui),this.cashValue=this.scene.add.bitmapText(this.ui.cashValueX,this.ui.cashValueY,q,"$".concat(e.startCash),V.fonts.cashSize),this.cashValue.setOrigin(this.ui.cashValueOriginX,this.ui.cashValueOriginY),this.cashValue.setDepth(r.hud.ui),this.cashValue.setTintFill(V.fonts.cashTint)),e.timer&&(this.timerIcon=this.scene.add.sprite(this.ui.timerIconX,this.ui.timerIconY,W.watch),this.timerIcon.displayWidth=this.ui.timerIconWidth,this.timerIcon.displayHeight=this.ui.timerIconWidth,this.timerIcon.setOrigin(this.ui.timerIconOriginX,this.ui.timerIconOriginY),this.timerIcon.setDepth(r.hud.ui),this.timerValue=this.scene.add.bitmapText(this.ui.timerValueX,this.ui.timerValueY,q,"",V.fonts.timerSize),this.timerValue.setOrigin(this.ui.timerValueOriginX,this.ui.timerValueOriginY),this.timerValue.setDepth(r.hud.ui),this.timerValue.setTintFill(V.fonts.timerTint)),e.message&&(this.itemBgGraphics.fillRect(this.ui.messageBorderX,this.ui.messageBorderY,this.ui.messageBorderWidth,this.ui.messageBorderWidth),this.messageBorder=this.scene.add.sprite(this.ui.messageBorderX,this.ui.messageBorderY,W.hudMessageBorder,W.frames.hudMessageDark),this.messageBorder.displayWidth=this.ui.messageBorderWidth,this.messageBorder.displayHeight=this.ui.messageBorderHeight,this.messageBorder.setOrigin(this.ui.messageBorderOriginX,this.ui.messageBorderOriginY),this.messageBorder.setDepth(r.hud.ui)),e.hudBuffer&&(this.brick=this.scene.add.tileSprite(this.ui.brickX,this.ui.brickY,this.ui.brickWidth,this.ui.brickHeight,W.brick),this.brick.setOrigin(0,0),this.brick.setDepth(r.hud.buffer)),e.textInput&&this.showTextInput(),e.handleInput?(this.inputHandled=!0,this.createInput()):this.inputHandled=!1}},{key:"getHudHeight",value:function(){return this.hudHeight}},{key:"getHudBufferHeight",value:function(){return this.hudBufferHeight}},{key:"setSubmitCallback",value:function(e){this.submitCallback=e.bind(this.scene)}},{key:"getTextEntry",value:function(){return this.textEntry.text}},{key:"clearTextEntry",value:function(){this.textEntry.text=""}},{key:"setKillValue",value:function(e){this.killValue.text=String(e).padStart(3,"0")}},{key:"setGameTime",value:function(e){this.timerValue.text=e.toFixed(1)}},{key:"setHealth",value:function(e){for(var t=0;t<this.maxHealth;t+=1)t<e?this.healthBars[t].setFrame(W.frames.healthFull):this.healthBars[t].setFrame(W.frames.healthEmpty)}},{key:"setCash",value:function(e){this.cashValue.text="$".concat(e)}},{key:"enableInputHandling",value:function(){this.inputHandled||(this.inputHandled=!0,this.createInput())}},{key:"disableInputHandling",value:function(){this.inputHandled&&(this.inputHandled=!1,this.keys=null,this.scene.input.keyboard.off("keydown",this.handleKeyDown))}},{key:"showTextInput",value:function(){this.textInputShown||(this.textInputShown=!0,this.textEntryGraphics=this.scene.add.graphics(),this.textEntryGraphics.fillStyle(V.ui.textEntryBackgroundColor),this.textEntryArea=new s.a.Geom.Rectangle(this.ui.textEntryAreaX,this.ui.textEntryAreaY,this.ui.textEntryAreaWidth,this.ui.textEntryAreaHeight),this.textEntryGraphics.fillRectShape(this.textEntryArea),this.textEntryGraphics.setDepth(r.hud.ui),this.textEntry=this.scene.add.bitmapText(this.ui.textEntryX,this.ui.textEntryY,q,"",V.fonts.textEntrySize),this.textEntry.setOrigin(this.ui.textEntryOriginX,this.ui.textEntryOriginY),this.textEntry.setDepth(r.hud.entryText),this.textEntry.setTintFill(V.fonts.textEntryTint))}},{key:"hideTextInput",value:function(){this.textInputShown&&(this.textInputShown=!1,this.textEntryGraphics.destroy(),this.textEntryGraphics=null,this.textEntryArea=null,this.textEntry.destroy(),this.textEntry=null)}},{key:"setWeapon",value:function(e,t){this.weapon.visible=!0,this.weapon.setFrame(Et(e)),this.createAmmoIcons(t,t)}},{key:"updateAmmo",value:function(e,t){this.createAmmoIcons(e,t)}},{key:"createInput",value:function(){this.keys=this.scene.input.keyboard.addKeys("SPACE,BACKSPACE, ENTER, A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z"),this.scene.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){e.keyCode===this.keys.BACKSPACE.keyCode&&this.textEntry.text.length>0?this.textEntry.text=this.textEntry.text.substr(0,this.textEntry.text.length-1):(Pt(e.keyCode)||e.keyCode===this.keys.SPACE.keyCode)&&this.textEntry.text.length<=V.maxTextEntry?this.textEntry.text+=e.key:e.keyCode===this.keys.ENTER.keyCode&&this.submitCallback()}},{key:"createAmmoIcons",value:function(e,t){this.clearAmmoIcons(),this.ammoGraphics=this.scene.add.graphics(),this.ammoGraphics.fillStyle(V.ui.ammoIconColor),this.ammoGraphics.setDepth(r.hud.ui);for(var i=0;i<t;i+=1){var a=this.getAmmoIconXPosition(i,t),s=this.ui.ammoIconY;i<e&&this.ammoGraphics.fillRect(a,s,this.ui.ammoIconWidth,this.ui.ammoIconWidth)}}},{key:"clearAmmoIcons",value:function(){null!=this.ammoGraphics&&(this.ammoGraphics.clear(),this.ammoGraphics=null)}},{key:"getAmmoIconXPosition",value:function(e,t){var i=t*this.ui.ammoIconWidth+(t-1)*this.ui.ammoIconPadding;return this.ui.weaponBorderX+this.ui.weaponBorderWidth/2-i/2+(this.ui.ammoIconWidth+this.ui.ammoIconPadding)*e}}])&&ii(t.prototype,i),a&&ii(t,a),e}(),si=function(e){var t=Qt(e);return{w:t.w,h:t.h,modalWidth:t.w_85p,get modalX(){return this.w/2-this.modalWidth/2},padding:t.padding,paddingBig:t.paddingBig,textMargin:.07*t.w,bottomBuffer:.075*t.h,cornerSquareWidth:.04*t.w,borderWidth:.015*t.w,textOrigin:t.center,anyKeyTextOriginX:t.center,anyKeyTextOriginY:t.bottom}};function ni(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var oi=function(){function e(t,i){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.textContent=i,this.fadeEnabled=a,this.ui=si(this.scene.sys.game.config)}var t,i,a;return t=e,(i=[{key:"draw",value:function(){this.createText(),this.createFade(),this.createBackground(),this.createBorder()}},{key:"close",value:function(e){null!=this.fade&&(this.fade.destroy(),this.fade=null),null!=this.backgroundGraphics&&(this.backgroundGraphics.destroy(),this.backgroundGraphics=null),null!=this.borderGraphics&&(this.borderGraphics.destroy(),this.borderGraphics=null),null!=this.text&&(this.text.destroy(),this.text=null),null!=this.flashTimer&&(this.flashTimer.destroy(),this.flashTimer=null),null!=this.anyKeyText&&(this.anyKeyText.destroy(),this.anyKeyText=null),this.closeCallback(e.keyCode)}},{key:"enableInputClose",value:function(){this.createPressAnyKey(),this.scene.input.keyboard.on("keydown",this.close,this)}},{key:"disableInputHandling",value:function(){this.scene.input.keyboard.off("keydown",this.close)}},{key:"setCloseCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scene;this.closeCallback=e.bind(t)}},{key:"createPressAnyKey",value:function(){var e=this;this.anyKeyText=this.scene.add.bitmapText(this.ui.w/2,this.bgRect.y+this.bgRect.height-this.ui.cornerSquareWidth-this.ui.padding,q,te,$),this.anyKeyText.setOrigin(this.ui.anyKeyTextOriginX,this.ui.anyKeyTextOriginY),this.anyKeyText.setDepth(r.modal.text),this.anyKeyText.setTintFill(Q),this.pressAnyKeyShown=!0,this.flashTimer=this.scene.time.addEvent({delay:ee,callback:function(){e.pressAnyKeyShown=!e.pressAnyKeyShown,e.anyKeyText.visible=e.pressAnyKeyShown},callbackScope:this,repeat:-1})}},{key:"createFade",value:function(){this.fadeEnabled&&(this.fade=this.scene.add.graphics(),this.fade.fillStyle(Z,U),this.fade.fillRect(0,0,this.ui.w,this.ui.h),this.fade.setDepth(r.modal.fade))}},{key:"createBackground",value:function(){this.backgroundGraphics=this.scene.add.graphics(),this.backgroundGraphics.fillStyle(K);var e=this.text.getTextBounds().global;this.bgRect=new s.a.Geom.Rectangle(this.ui.modalX,e.y-this.ui.textMargin,this.ui.modalWidth,e.height+2*this.ui.textMargin+this.ui.bottomBuffer),this.backgroundGraphics.fillRectShape(this.bgRect),this.backgroundGraphics.setDepth(r.modal.bg)}},{key:"createBorder",value:function(){this.borderGraphics=this.scene.add.graphics(),this.borderGraphics.fillStyle(J),this.borderGraphics.setDepth(r.modal.border),this.borderGraphics.fillRect(this.bgRect.x+this.ui.padding,this.bgRect.y+this.ui.padding,this.ui.cornerSquareWidth,this.ui.cornerSquareWidth),this.borderGraphics.fillRect(this.bgRect.x+this.bgRect.width-this.ui.cornerSquareWidth-this.ui.padding,this.bgRect.y+this.ui.padding,this.ui.cornerSquareWidth,this.ui.cornerSquareWidth),this.borderGraphics.fillRect(this.bgRect.x+this.ui.padding,this.bgRect.y+this.bgRect.height-this.ui.cornerSquareWidth-this.ui.padding,this.ui.cornerSquareWidth,this.ui.cornerSquareWidth),this.borderGraphics.fillRect(this.bgRect.x+this.bgRect.width-this.ui.cornerSquareWidth-this.ui.padding,this.bgRect.y+this.bgRect.height-this.ui.cornerSquareWidth-this.ui.padding,this.ui.cornerSquareWidth,this.ui.cornerSquareWidth),this.borderGraphics.fillRect(this.bgRect.x+this.ui.cornerSquareWidth+2*this.ui.padding,this.bgRect.y+this.ui.padding+this.ui.cornerSquareWidth/2-this.ui.borderWidth/2,this.bgRect.width-2*this.ui.cornerSquareWidth-4*this.ui.padding,this.ui.borderWidth),this.borderGraphics.fillRect(this.bgRect.x+this.ui.cornerSquareWidth+2*this.ui.padding,this.bgRect.y+this.bgRect.height-this.ui.padding-this.ui.cornerSquareWidth/2-this.ui.borderWidth/2,this.bgRect.width-2*this.ui.cornerSquareWidth-4*this.ui.padding,this.ui.borderWidth),this.borderGraphics.fillRect(this.bgRect.x+this.ui.padding+this.ui.cornerSquareWidth/2-this.ui.borderWidth/2,this.bgRect.y+this.ui.cornerSquareWidth+2*this.ui.padding,this.ui.borderWidth,this.bgRect.height-2*this.ui.cornerSquareWidth-4*this.ui.padding),this.borderGraphics.fillRect(this.bgRect.x+this.bgRect.width-this.ui.padding-this.ui.cornerSquareWidth/2-this.ui.borderWidth/2,this.bgRect.y+this.ui.cornerSquareWidth+2*this.ui.padding,this.ui.borderWidth,this.bgRect.height-2*this.ui.cornerSquareWidth-4*this.ui.padding)}},{key:"createText",value:function(){this.text=this.scene.add.bitmapText(this.ui.w/2,this.ui.h/2,q,this.textContent,$),this.text.setOrigin(this.ui.textOrigin),this.text.setCenterAlign(),this.text.setDepth(r.modal.text),this.text.setTintFill(Q)}}])&&ni(t.prototype,i),a&&ni(t,a),e}(),ri=i(4);function li(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function hi(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ui=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=t,this.unlockableManager=new Ut(t)}var t,i,a;return t=e,(i=[{key:"isNewGame",value:function(){if(!this.db.isUserLoggedIn())return!0;if(this.db.userProfileLoaded){var e=this.db.userProfile.stagesCompleted;return null==e||0===e.length}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"isStageCompleted",value:function(e){if(!this.db.isUserLoggedIn())return!1;if(this.db.userProfileLoaded){var t=this.db.userProfile.stagesCompleted;return null!=t&&t.includes(e)}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"isStageUnlocked",value:function(e){for(var t=this.db.getLessonForStage(e),i=0;i<t.stages.length;i+=1){var a=t.stages[i];if(a===e)return!0;if(!this.isStageCompleted(a))return!1}return!1}},{key:"isLessonCompleted",value:function(e){if(!this.db.isUserLoggedIn())return!1;if(this.db.userProfileLoaded){var t=this.db.userProfile.lessonsCompleted;return null!=t&&t.includes(e)}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"isLessonLocked",value:function(e){if(!this.db.isUserLoggedIn())return!0;if(this.db.userProfileLoaded){var t=this.db.userProfile.lessonsCompleted;return this.db.getLesson(e).requirements.some((function(e){return null==t||!t.includes(e)}))}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"isLessonUpcoming",value:function(e){var t=this;if(!this.db.isUserLoggedIn())return!1;if(this.db.userProfileLoaded){var i=this.db.getLesson(e);return!!this.isLessonLocked(e)&&i.requirements.some((function(e){return!t.isLessonLocked(e)}))}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"isModalSeen",value:function(e){if(!this.db.isUserLoggedIn())return!1;if(this.db.userProfileLoaded){var t=this.db.userProfile.modalsSeen;return null!=t&&t.includes(e)}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"isWordInProblemVocab",value:function(e){var t=this.getProblemEntry(e);return this.getProblemVocab().some((function(e){return e.stage===t.stage&&e.id===t.id}))}},{key:"getStageType",value:function(e){return this.db.getStage(e).type}},{key:"getMapPosition",value:function(){if(!this.db.isUserLoggedIn())return null;if(this.db.userProfileLoaded)return this.db.userProfile.mapState;throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"getModalsSeen",value:function(){if(!this.db.isUserLoggedIn())return[];if(this.db.userProfileLoaded){var e=this.db.userProfile.modalsSeen;return null!=e?e:[]}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"getCompletedStages",value:function(){if(!this.db.isUserLoggedIn())return[];if(this.db.userProfileLoaded){var e=this.db.userProfile.stagesCompleted;return null!=e?e:[]}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"getCompletedNonReviewStages",value:function(){var e=this;return this.getCompletedStages().filter((function(t){return e.getStageType(t)!==se.zombieAssaultReview}))}},{key:"getCompletedLessons",value:function(){if(!this.db.isUserLoggedIn())return[];if(this.db.userProfileLoaded){var e=this.db.userProfile.lessonsCompleted;return null!=e?e:[]}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"getProblemVocab",value:function(){if(!this.db.isUserLoggedIn())return[];if(this.db.userProfileLoaded){var e=this.db.userProfile.problemVocab;return null!=e?e:[]}throw Error("user profile has not been loaded. Call loadUserProfile() first")}},{key:"getVocabWord",value:function(e,t){return this.db.getStage(e).vocab.find((function(e){return e.id===t}))}},{key:"saveMapPosition",value:function(e,t,i){var a={mapState:{lesson:e,stage:t}};this.updateUserProfile(a,i)}},{key:"saveStageCompleted",value:function(e,t){var i,a=this,s=this.db.getLessonForStage(e),n=s.stages.every((function(t){return t===e||a.isStageCompleted(t)})),o=this.getAllUnlockedItems(e),r={stagesCompleted:ri.firestore.FieldValue.arrayUnion(e)};n&&(r.lessonsCompleted=ri.firestore.FieldValue.arrayUnion(s.id),r.mapState={lesson:s.id,stage:null}),o.length>0&&(r.unlockedItems=(i=ri.firestore.FieldValue).arrayUnion.apply(i,li(o))),this.updateUserProfile(r,t)}},{key:"saveModalSeen",value:function(e,t){var i={modalsSeen:ri.firestore.FieldValue.arrayUnion(e)};this.updateUserProfile(i,t)}},{key:"addProblemVocab",value:function(e,t){var i=this.getProblemEntry(e),a={problemVocab:ri.firestore.FieldValue.arrayUnion(i)};this.updateUserProfile(a,t)}},{key:"removeProblemVocab",value:function(e,t){var i=this.getProblemEntry(e),a={problemVocab:ri.firestore.FieldValue.arrayRemove(i)};this.updateUserProfile(a,t)}},{key:"updateUserProfile",value:function(e,t){var i=this,a=this.db.getCurrentUserProfile();null!=a?a.update(e).then((function(){i.db.loadUserProfile((function(){null!=t&&t(!0)}),i)})):null!=t&&t(!1)}},{key:"getProblemEntry",value:function(e){return{stage:e.stage,id:e.id}}},{key:"getAllUnlockedItems",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=this.getCompletedStages(),a=i.reduce((function(t,i){var a=t.concat(e.unlockableManager.getUnlockedItemsForStage(i));return Ct(a)}),[]);return null!=t&&(a=a.concat(this.unlockableManager.getUnlockedItemsForStage(t))),a}}])&&hi(t.prototype,i),a&&hi(t,a),e}();function ci(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var di=function(){function e(t,i,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.config=i,this.vocab=a,this.nextSpawnTime=s+this.getSpawnDelay(),this.itemSlots=new Array(Rt.MINIGAME_ITEM_SLOTS).fill(!1),this.unlockableManager=new Ut(this.scene.game.db)}var t,i,a;return t=e,(i=[{key:"getItemSpawn",value:function(e){var t={canSpawn:!1};if(this.nextSpawnTime<=e){var i=this.getSlotNumber(),a=this.getRandomItemType();if(i>=0&&null!=a){var s=this.vocab.getRandomWord();null!=s&&(t.canSpawn=!0,t.word=s,t.slotNumber=i,t.lifeTime=this.config.lifeTime,t.warnTime=this.config.warnTime,t.itemType=a)}this.nextSpawnTime=e+this.getSpawnDelay()}return t}},{key:"releaseSlot",value:function(e){this.itemSlots[e]=!1}},{key:"getSpawnDelay",value:function(){return(this.config.baseSpawnRate+s.a.Math.RND.between(-this.config.spawnRange,this.config.spawnRange))/1e3}},{key:"getSlotNumber",value:function(){if(this.itemSlots.every((function(e){return e})))return-1;var e=0;do{e=s.a.Math.RND.between(0,Rt.MINIGAME_ITEM_SLOTS-1)}while(this.itemSlots[e]);return this.itemSlots[e]=!0,e}},{key:"getRandomItemType",value:function(){var e=s.a.Math.RND.between(1,100),t=this.config.probabilities.find((function(t){return t.min<=e&&t.max>=e}));return null!=t&&this.unlockableManager.isUnlocked(t.itemType)?t.itemType:this.unlockableManager.isUnlocked(G.foodTier1)?G.foodTier1:null}}])&&ci(t.prototype,i),a&&ci(t,a),e}();function gi(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var mi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.userOptionsManager=new Gt(this.scene.sys.game),this.items=[],this.destroyedItems=[]}var t,i,a;return t=e,(i=[{key:"spawnItem",value:function(e){var t=this.getSpawnPosition(e.slotNumber),i=this.getItemImageConfig(e.itemType),a=this.scene.add.sprite(t.x,t.y,i.image,i.frame);a.config=e,a.itemType=e.itemType,a.slotNumber=e.slotNumber,a.word=e.word,a.lifeTime=e.lifeTime,a.warnTime=e.warnTime,a.displayWidth=i.width,a.displayHeight=i.height,a.setOrigin(this.scene.ui.itemOriginX,this.scene.ui.itemOriginY),a.setDepth(r.minigame.item),a.text=this.scene.add.bitmapText(a.x,a.y+a.height/2+this.scene.ui.itemWordBuffer,q,a.word.language1,this.getFontSize()),a.text.setOrigin(this.scene.ui.itemWordOriginX,this.scene.ui.itemWordOriginY),a.text.setTintFill(E.fonts.itemTint),a.text.setDepth(r.minigame.itemText),a.textBgGraphics=this.scene.add.graphics(),a.textBgGraphics.fillStyle(E.ui.itemWordBgColor),a.textBgGraphics.setDepth(r.minigame.itemTextBackground),a.textBgGraphics.fillRect(a.text.x-a.text.width/2-E.ui.itemWordBgPadding,a.text.y-E.ui.itemWordBgPadding,a.text.width+2*E.ui.itemWordBgPadding,a.text.height+2*E.ui.itemWordBgPadding),a.killTimer=this.scene.time.addEvent({delay:a.lifeTime,callback:this.destroyItem,args:[a],callbackScope:this}),a.warnTimer=this.scene.time.addEvent({delay:a.lifeTime-a.warnTime,callback:this.startWarningFlash,args:[a],callbackScope:this}),this.items.push(a),this.scene.audioManager.playSound(E.audio.soundEffects.itemSpawn)}},{key:"checkGuess",value:function(e){var t=Yt(e),i=-1,a=null;return(i=this.items.findIndex((function(e){return t===Yt(e.word.language2)})))<0&&(i=this.items.findIndex((function(e){var i=null!=e.word.alternatives?e.word.alternatives.map((function(e){return Yt(e)})):null;return null!=i&&i.includes(t)}))),i>=0&&(a=this.items[i].config,this.destroyItem(this.items[i]),this.showItemPop(a)),a}},{key:"clearDestroyedItems",value:function(){var e=this.destroyedItems;return this.destroyedItems=[],e}},{key:"showItemPop",value:function(e){var t=this.getSpawnPosition(e.slotNumber),i=this.scene.add.sprite(t.x,t.y,W.popWhite);i.setDepth(r.minigame.itemPop),i.setOrigin(this.scene.ui.itemPopOrigin),i.displayWidth=this.scene.ui.itemPopWidth,i.displayHeight=this.scene.ui.itemPopWidth,i.on("animationcomplete",(function(e,t,i){return i.destroy()}),this),i.play(n.popWhitePop)}},{key:"getSpawnPosition",value:function(e){switch(e){case 0:return{x:this.scene.ui.itemLeftX,y:this.scene.ui.itemRow1Y};case 1:return{x:this.scene.ui.itemLeftX,y:this.scene.ui.itemRow2Y};case 2:return{x:this.scene.ui.itemLeftX,y:this.scene.ui.itemRow3Y};case 3:return{x:this.scene.ui.itemLeftX,y:this.scene.ui.itemRow4Y};case 4:return{x:this.scene.ui.itemRightX,y:this.scene.ui.itemRow1Y};case 5:return{x:this.scene.ui.itemRightX,y:this.scene.ui.itemRow2Y};case 6:return{x:this.scene.ui.itemRightX,y:this.scene.ui.itemRow3Y};case 7:return{x:this.scene.ui.itemRightX,y:this.scene.ui.itemRow4Y};default:throw Error("invalid slot number")}}},{key:"getItemImageConfig",value:function(e){switch(e){case G.cash:return{image:W.cash,frame:0,width:this.scene.ui.itemWidth,height:this.scene.ui.itemHeight};case G.foodTier1:return{image:W.foodTier1,frame:s.a.Math.RND.between(0,11),width:this.scene.ui.itemWidth,height:this.scene.ui.itemHeight};case G.shotgun:return{image:W.shotgun,frame:W.frames.shotgunNormal,width:this.scene.ui.shotgunWidth,height:this.scene.ui.shotgunHeight};default:throw Error("invalid minigameItem")}}},{key:"startWarningFlash",value:function(e){e.flashTimer=this.scene.time.addEvent({delay:E.itemFlashDelay,callback:function(e){e.visible=!e.visible},args:[e],callbackScope:this,repeat:-1})}},{key:"destroyItem",value:function(e){this.destroyedItems.push(e.config);var t=this.items.findIndex((function(t){return t===e}));this.items.splice(t,1),e.text.destroy(),e.textBgGraphics.destroy(),e.killTimer.destroy(),e.warnTimer.destroy(),null!=e.flashTimer&&e.flashTimer.destroy(),e.destroy()}},{key:"getFontSize",value:function(){return this.userOptionsManager.getOptionValue(vt.textSize)===vt.values.normal?E.fonts.itemSize:E.fonts.itemSizeLarge}}])&&gi(t.prototype,i),a&&gi(t,a),e}();function pi(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var fi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t}var t,i,a;return t=e,(i=[{key:"applyItem",value:function(e){switch(e){case G.cash:this.scene.cash+=this.scene.stageParameters.items.cashAmount,this.scene.hudManager.setCash(this.scene.cash),this.scene.statusManager.setStatus({message:E.statusMessages.cashReceived,displayTime:E.statusTime});break;case G.foodTier1:this.scene.changeHealth(this.scene.stageParameters.items.foodTier1HealAmount),this.scene.statusManager.setStatus({message:E.statusMessages.foodTier1Received,displayTime:E.statusTime});break;case G.shotgun:this.scene.weapon=Y.shotgun,this.scene.ammo=this.scene.stageParameters.weapons.shotgunAmmo,this.scene.maxAmmo=this.scene.stageParameters.weapons.shotgunAmmo,this.scene.hudManager.setWeapon(Y.shotgun,this.scene.ammo);break;default:throw Error("invalid itemType")}}}])&&pi(t.prototype,i),a&&pi(t,a),e}();function bi(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var yi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t}var t,i,a;return t=e,(i=[{key:"checkGuess",value:function(e,t){var i=this.scene.zombieManager.checkMercenary(e,t);return i&&(this.setStatus(t),t&&(this.scene.cash-=this.scene.stageParameters.mercenaryCost,this.scene.hudManager.setCash(this.scene.cash))),i}},{key:"setStatus",value:function(e){e?this.scene.statusManager.setStatus({image:W.mercenary,frame:W.frames.mercenaryStatusShoot,message:E.statusMessages.useMercenary,displayTime:E.statusTime}):this.scene.statusManager.setStatus({image:W.mercenary,frame:W.frames.mercenaryStatusRefuse,message:E.statusMessages.mercenaryUnavailable,displayTime:E.statusTime})}}])&&bi(t.prototype,i),a&&bi(t,a),e}();function vi(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var wi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.progressManager=new ui(this.scene.sys.game.db),this.unlockableManager=new Ut(this.scene.sys.game.db)}var t,i,a;return t=e,(i=[{key:"getModalConfig",value:function(e){return mt.find((function(t){return t.id===e}))}},{key:"getModalConfigByConditions",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.getPotentialModals(e),n=s.find((function(e){return e.checks.every((function(e){return t.passesCheck(e,i,a,!1)}))}));return null==n&&(n=s.find((function(e){return e.checks.every((function(e){return t.passesCheck(e,i,a,!0)}))}))),n}},{key:"getPotentialModals",value:function(e){var t=this.progressManager.getModalsSeen();return mt.filter((function(i){return i.screen===e&&(i.repeat||!t.includes(i.id))}))}},{key:"passesCheck",value:function(e,t,i,a){if(e.checkType===Qe)return e.checkValue===t;if(e.checkType===$e){var s=this.progressManager.getCompletedStages();return e.checkValue===s.length}if(e.checkType===et)return i;if(e.checkType===tt)return!i;if(e.checkType===it)return this.progressManager.getCompletedStages().includes(e.checkValue);if(e.checkType===at)return this.progressManager.getCompletedLessons().includes(e.checkValue);if(e.checkType===st)return null!=t&&this.progressManager.getStageType(t)===e.checkValue;if(e.checkType===nt)return this.unlockableManager.isUnlocked(e.checkValue);if(e.checkType===ot)return this.scene.sys.game.db.isUserLoggedIn();if(e.checkType===rt)return!this.scene.sys.game.db.isUserLoggedIn();if(e.checkType===lt)return a;throw Error("Unsupported check type: ".concat(e.checkType))}},{key:"getDefaultModal",value:function(e){return mt.find((function(t){return t.screen===e&&t.checks.some((function(e){return e.checkType===lt}))}))}}])&&vi(t.prototype,i),a&&vi(t,a),e}();function ki(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Si=function(){function e(t,i){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.textContent=i,this.fadeEnabled=a,this.modalCount=this.textContent.length,this.modalIndex=0}var t,i,a;return t=e,(i=[{key:"draw",value:function(){var e=this;this.modal=new oi(this.scene,this.textContent[this.modalIndex],this.fadeEnabled),this.modal.draw(),this.modal.enableInputClose(),this.modal.setCloseCallback((function(t){e.modal.disableInputHandling(),e.modalIndex<e.modalCount-1?(e.modalIndex+=1,e.draw()):e.closeCallback(t)}),this)}},{key:"setCloseCallback",value:function(e){this.closeCallback=e.bind(this.scene)}}])&&ki(t.prototype,i),a&&ki(t,a),e}();function Ti(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ii=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.stageId=i,this.won=a,this.completedCallback=null,this.modalHelper=new wi(this.scene),this.progressManager=new ui(this.scene.sys.game.db)}var t,i,a;return t=e,(i=[{key:"setBeforeStartCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scene;this.beforeStartCallback=e.bind(t)}},{key:"setCompletedCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scene;this.completedCallback=e.bind(t)}},{key:"checkModal",value:function(){var e=this.getStartModal();null!=e?this.createStartModal(e):this.complete()}},{key:"getStartModal",value:function(){return this.modalHelper.getModalConfigByConditions(this.scene.scene.key,this.stageId,this.won)}},{key:"createStartModal",value:function(e){var t=this;this.beforeStart(),this.startModalConfig=e,this.startModal=new Si(this.scene,e.text),this.startModal.draw(),this.startModal.setCloseCallback((function(){t.progressManager.saveModalSeen(t.startModalConfig.id),t.complete()}))}},{key:"beforeStart",value:function(){null!=this.beforeStartCallback&&this.beforeStartCallback()}},{key:"complete",value:function(){null!=this.completedCallback&&this.completedCallback()}}])&&Ti(t.prototype,i),a&&Ti(t,a),e}();function xi(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Oi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Mi(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Pi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,a;return t=e,(i=[{key:"getParameters",value:function(e){var t=this.getStageParams(e);return this.buildParameters(t)}},{key:"buildParameters",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?xi(i,!0).forEach((function(t){Oi(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xi(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},F.find((function(e){return"base"===e.id})),{},e),i=this.getWaves(t.waveId);return t.waves=i.waves,t}},{key:"getStageParams",value:function(e){var t=bt.find((function(t){return t.stage===e}));if(null==t)throw Error("No stage parameters available for stageId: ".concat(e));var i=this.getRandomParameterId(t.availableParameters),a=F.find((function(e){return e.id===i}));if(null==a)throw Error("No stage parameters found with id: ".concat(i));return a}},{key:"getWaves",value:function(e){var t=ft.find((function(t){return t.id===e}));if(null==t)throw Error("Invalid waveId: ".concat(e));return t}},{key:"getRandomParameterId",value:function(e){return s.a.Math.RND.pick(e)}}])&&Mi(t.prototype,i),a&&Mi(t,a),e}();function Bi(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Wi=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=t,this.stageParameters=i,this.gameProgressManager=new ui(t),this.reservedWordIds=[]}var t,i,a;return t=e,(i=[{key:"getRandomReviewWord",value:function(){var e=null;return this.shouldGetProblemVocab()&&(e=this.getProblemVocab()),(null==e||this.reservedWordIds.includes(e.id))&&(e=this.getReviewVocab()),this.reservedWordIds.includes(e.id)?null:(e.review=!0,this.reservedWordIds.push(e.id),e)}},{key:"releaseWord",value:function(e){if(null!=e){e.missed?this.addProblemWord(e):this.removeProblemWord(e);var t=this.reservedWordIds.findIndex((function(t){return t===e.id}));t>-1&&this.reservedWordIds.splice(t,1)}}},{key:"addProblemWord",value:function(e){this.gameProgressManager.isWordInProblemVocab(e)||this.gameProgressManager.addProblemVocab(e)}},{key:"removeProblemWord",value:function(e){this.gameProgressManager.isWordInProblemVocab(e)&&this.gameProgressManager.removeProblemVocab(e)}},{key:"shouldGetProblemVocab",value:function(){var e=100*this.stageParameters.enemies.problemVocabPercentage,t=s.a.Math.RND.between(0,99)<e;return 0===this.gameProgressManager.getProblemVocab().length&&(t=!1),t}},{key:"getProblemVocab",value:function(){var e=null,t=this.gameProgressManager.getProblemVocab();if(t.length>0){var i=s.a.Math.RND.pick(t);e=this.gameProgressManager.getVocabWord(i.stage,i.id)}return e}},{key:"getReviewVocab",value:function(){var e=this.gameProgressManager.getCompletedNonReviewStages();if(null==e||0===e.length)return null;var t=s.a.Math.RND.pick(e),i=this.db.getStage(t).vocab;return s.a.Math.RND.pick(i)}}])&&Bi(t.prototype,i),a&&Bi(t,a),e}();function Ci(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var zi="stopped",Li=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.optionsManager=new Gt(this.scene.sys.game),this.musicIntro=null,this.music=null,this.sounds={},this.musicState=zi}var t,i,a;return t=e,(i=[{key:"setMusicIntro",value:function(e,t){e!==h&&(this.musicIntro=this.scene.sound.add(e,t))}},{key:"setMusic",value:function(e,t){e!==h&&(this.music=this.scene.sound.add(e,t))}},{key:"addSound",value:function(e,t){e!==h&&(this.sounds[e]=this.scene.sound.add(e,t))}},{key:"addAllSounds",value:function(e,t){var i=this;Ct(Object.values(e)).forEach((function(e){var a=null!=t?t.find((function(t){return t.key===e})):null,s=null!=a?a.value:null;i.addSound(e,s)}))}},{key:"playMusic",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.optionsManager.musicEnabled()||e)&&(this.musicState===zi?null!=this.musicIntro?this.playMusicIntro():this.playMainMusicLoop():"intro-paused"===this.musicState?this.resumeMusicIntro():"paused"===this.musicState&&this.resumeMainMusicLoop())}},{key:"setMusicVolume",value:function(e){null!=this.musicIntro&&this.musicIntro.setVolume(e),this.music.setVolume(e)}},{key:"stopMusic",value:function(){this.musicState=zi,null!=this.musicIntro&&this.musicIntro.stop(),this.music.stop()}},{key:"pauseMusic",value:function(){"intro-playing"===this.musicState?this.pauseMusicIntro():"playing"===this.musicState&&this.pauseMainMusicLoop()}},{key:"playSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e!==h&&(this.optionsManager.soundEffectsEnabled()||t)&&this.sounds[e].play()}},{key:"playMusicIntro",value:function(){var e=this;this.musicIntro.on("complete",(function(){return e.playMainMusicLoop()})),this.musicState="intro-playing",this.musicIntro.play({delay:l})}},{key:"resumeMusicIntro",value:function(){this.musicState="intro-playing",this.musicIntro.resume()}},{key:"pauseMusicIntro",value:function(){this.musicState="intro-paused",this.musicIntro.pause()}},{key:"playMainMusicLoop",value:function(){this.musicState="playing";var e=null!=this.musicIntro?0:l;this.music.play({loop:!0,delay:e})}},{key:"resumeMainMusicLoop",value:function(){this.musicState="playing",this.music.resume()}},{key:"pauseMainMusicLoop",value:function(){this.musicState="paused",this.music.pause()}}])&&Ci(t.prototype,i),a&&Ci(t,a),e}();function Ei(e){return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ri(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Yi(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ri(i,!0).forEach((function(t){Xi(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ri(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Xi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Hi(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Gi(e,t){return!t||"object"!==Ei(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fi(e){return(Fi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ai(e,t){return(Ai=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Di=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Gi(this,Fi(t).call(this,{key:A.minigame}))}var i,a,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ai(e,t)}(t,e),i=t,(a=[{key:"init",value:function(e){var t,i;this.stageId=e,this.statusManager=new ti(this),this.hudManager=new ai(this),this.progressManager=new ui(this.sys.game.db),this.vocab=new Ot(this.getVocab()),this.itemManager=new mi(this),this.itemEffectManager=new fi(this),this.mercenaryManager=new yi(this),this.modalChecker=new Ii(this,e),this.unlockableManager=new Ut(this.sys.game.db),this.stageParameterManager=new Pi,this.audioManager=new Li(this),this.stageParameters=this.stageParameterManager.getParameters(this.stageId),this.reviewVocabManager=new Wi(this.sys.game.db,this.stageParameters),this.zombieManager=new _t(this,this.stageParameters),this.spawnManager=new Jt(this,this.stageParameters,this.vocab,this.reviewVocabManager),this.itemSpawnManager=new di(this,this.stageParameters.items,this.vocab),this.ui=(t=this.sys.game.config,{padding:(i=Qt(t)).padding,zombieWidth:.075*i.w,zombieOriginX:i.center,zombieOriginY:i.bottom,zombieWordMargin:.02*i.h,itemWidth:i.h_5p,itemHeight:i.h_5p,shotgunWidth:i.h_10p,shotgunHeight:i.h_5p,itemOriginX:i.center,itemOriginY:i.bottom,itemWordBuffer:i.padding,itemWordOriginX:i.center,itemWordOriginY:i.top,itemLeftX:i.w_10p,itemRightX:i.w_90p,itemRow1Y:i.h_15p,itemRow2Y:i.h_30p,itemRow3Y:i.h_45p,itemRow4Y:i.h_60p,itemPopOrigin:i.center,get itemPopWidth(){return 1.25*this.itemWidth}}),this.score=0,this.cash=this.stageParameters.startCash,this.health=this.stageParameters.startHealth,this.weapon=this.stageParameters.weapons.default,this.ammo=0,this.maxAmmo=0,this.mercenaryEnabled=this.unlockableManager.isUnlocked(gt.mercenary)&&this.stageParameters.mercenaryEnabled,this.inputHandled=!1}},{key:"create",value:function(){this.createHud(),this.createBackground(),this.createCollisions(),this.createTimers(),this.createAudio(),this.audioManager.playMusic(),this.checkStartModal()}},{key:"update",value:function(e,t){var i=this;if(!this.gameTimer.paused){this.updateGameTime();var a=this.spawnManager.getSpawn(this.gameTimer.getElapsedSeconds());a.canSpawn&&this.zombieManager.spawnZombie(a);var s=this.itemSpawnManager.getItemSpawn(this.gameTimer.getElapsedSeconds());s.canSpawn&&this.itemManager.spawnItem(s),this.zombieManager.moveZombies(t),this.zombieManager.destroyDeadZombies().forEach((function(e){e.review?i.reviewVocabManager.releaseWord(e):i.vocab.releaseWord(e)})),this.changeHealth(this.zombieManager.checkZombieAttack()),this.health<=0&&this.loseGame(),this.itemManager.clearDestroyedItems().forEach((function(e){i.vocab.releaseWord(e.word),i.itemSpawnManager.releaseSlot(e.slotNumber)}))}}},{key:"createAudio",value:function(){this.isReviewStage()?(this.audioManager.setMusicIntro(E.audio.music.zombieAssaultReviewBackgroundMusicIntro),this.audioManager.setMusic(E.audio.music.zombieAssaultReviewBackgroundMusicLoop)):(this.audioManager.setMusicIntro(E.audio.music.zombieAssaultBackgroundMusicIntro),this.audioManager.setMusic(E.audio.music.zombieAssaultBackgroundMusicLoop)),this.audioManager.addAllSounds(E.audio.soundEffects,E.audio.config)}},{key:"createHud",value:function(){var e=Yi({},E.ui.hudConfig);this.unlockableManager.isUnlocked(gt.cash)||(e.cash=!1),this.hudManager.createHud(Yi({},e,{startHealth:this.stageParameters.startHealth,maxHealth:this.stageParameters.maxHealth,startCash:this.stageParameters.startCash})),this.hudManager.setSubmitCallback(this.submitAnswer),this.hudManager.setWeapon(this.stageParameters.weapons.default,0)}},{key:"createBackground",value:function(){this.background=this.add.tileSprite(0,0,this.sys.game.config.width,this.sys.game.config.height-this.hudManager.getHudHeight(),W.grass),this.background.setOrigin(0,0),this.background.setDepth(r.minigame.background)}},{key:"createCollisions",value:function(){this.zombieManager.setHitArea(new s.a.Geom.Rectangle(0,this.sys.game.config.height-this.hudManager.getHudHeight()-this.hudManager.getHudBufferHeight(),this.sys.game.config.width,this.hudManager.getHudHeight()))}},{key:"createTimers",value:function(){this.gameTimer=this.time.addEvent({delay:1e3*this.stageParameters.gameTime,callback:this.gameTimerFinish,callbackScope:this,paused:!0})}},{key:"checkStartModal",value:function(){var e=this;this.modalChecker.setBeforeStartCallback((function(){e.disableInputHandling(),e.hudManager.disableInputHandling()})),this.modalChecker.setCompletedCallback((function(){e.hudManager.enableInputHandling(),e.enableInputHandling(),e.startGame()})),this.modalChecker.checkModal()}},{key:"startGame",value:function(){this.gameTimer.paused=!1}},{key:"gameTimerFinish",value:function(){var e=this;this.zombieManager.destroyAllZombies().forEach((function(t){return e.vocab.releaseWord(t)})),this.progressManager.saveStageCompleted(this.stageId,(function(){e.audioManager.stopMusic(),e.scene.start(A.endgame,{status:P.win,stageId:e.stageId})}))}},{key:"changeHealth",value:function(e){e<0&&(this.cameraDamageEffect(),this.statusManager.setStatus({image:W.zombieFace,message:E.statusMessages.damage,displayTime:E.statusTime})),this.health+=e,this.health=Math.min(this.health,this.stageParameters.maxHealth),this.hudManager.setHealth(this.health)}},{key:"cameraDamageEffect",value:function(){this.cameras.main.flash(E.damageFlashDuration,E.damageFlashColor.red,E.damageFlashColor.green,E.damageFlashColor.blue,!0),this.cameras.main.shake(E.damageShakeDuration,E.damageShakeIntensity)}},{key:"loseGame",value:function(){this.audioManager.stopMusic(),this.scene.start(A.endgame,{status:P.lose,stageId:this.stageId})}},{key:"updateGameTime",value:function(){var e=this.stageParameters.gameTime-this.gameTimer.getElapsedSeconds();this.hudManager.setGameTime(e)}},{key:"submitAnswer",value:function(){var e=this.hudManager.getTextEntry(),t=this.zombieManager.checkGuess(e,this.weapon),i=!0,a=!1;if(!t&&this.mercenaryEnabled){var s=this.cash>=this.stageParameters.mercenaryCost;this.mercenaryManager.checkGuess(e,s)&&(i=!1,s?(a=!0,this.audioManager.playSound(E.audio.soundEffects.mercenaryAttack)):this.audioManager.playSound(E.audio.soundEffects.mercenaryRefuse))}if(!t&&!a){var n=this.itemManager.checkGuess(e);null!=n?(this.audioManager.playSound(E.audio.soundEffects.itemGet),this.itemEffectManager.applyItem(n.itemType),i=!1):this.audioManager.playSound(E.audio.soundEffects.shotMiss)}t&&(this.score+=1),this.hudManager.setKillValue(this.score),this.hudManager.clearTextEntry(),i&&this.ammo>0&&this.updateAmmo(this.ammo-1)}},{key:"getVocab",value:function(){var e=this;return this.isReviewStage()?this.sys.game.db.getLessonForStage(this.stageId).stages.reduce((function(t,i){return t.concat(e.sys.game.db.getStage(i).vocab)}),[]).filter((function(e){return null!=e})):this.sys.game.db.getStage(this.stageId).vocab}},{key:"enableInputHandling",value:function(){this.inputHandled||(this.inputHandled=!0,this.createInput())}},{key:"disableInputHandling",value:function(){this.inputHandled&&(this.inputHandled=!1,this.keys=null,this.input.keyboard.off("keydown",this.handleKeyDown))}},{key:"createInput",value:function(){this.keys=this.input.keyboard.addKeys("ESC"),this.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){e.keyCode===this.keys.ESC.keyCode&&this.createQuitModal()}},{key:"createQuitModal",value:function(){var e=this;this.disableInputHandling(),this.hudManager.disableInputHandling(),this.quitModal=new oi(this,E.modals.quit),this.quitModal.draw(),this.quitModal.enableInputClose(),this.quitModal.setCloseCallback((function(t){e.quitModal.disableInputHandling(),e.hudManager.enableInputHandling(),e.enableInputHandling(),t===e.keys.ESC.keyCode&&(e.audioManager.stopMusic(),e.scene.start(A.endgame,{status:P.lose,stageId:e.stageId}))}))}},{key:"updateAmmo",value:function(e){this.ammo=e,this.hudManager.updateAmmo(this.ammo,this.maxAmmo),this.ammo<=0&&(this.audioManager.playSound(E.audio.soundEffects.outOfAmmo),this.maxAmmo=0,this.weapon=this.stageParameters.weapons.default,this.hudManager.setWeapon(this.weapon,0))}},{key:"isReviewStage",value:function(){return this.progressManager.getStageType(this.stageId)===se.zombieAssaultReview}}])&&Hi(i.prototype,a),n&&Hi(i,n),t}(s.a.Scene),qi="logged-out",_i="logged-in",Vi="registering";function ji(e){return(ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ni(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Zi(e,t){return!t||"object"!==ji(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ui(e){return(Ui=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ki(e,t){return(Ki=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ji=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Zi(this,Ui(t).call(this,{key:A.boot}))}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ki(e,t)}(t,e),i=t,(a=[{key:"preload",value:function(){this.startOnLoadComplete=!1,this.load.bitmapFont(q,_.blueSkyWhitePng,_.blueSkyWhiteFnt),this.load.image(W.titleScreenBackground,W.files.titleScreenBackground),this.sys.game.db.loadUserProfile(this.onProfileLoad,this)}},{key:"create",value:function(){null!=this.nextScene?this.startNextScene():this.startOnLoadComplete=!0}},{key:"onProfileLoad",value:function(e){this.nextScene=e===Vi?A.registration:A.loading,this.startOnLoadComplete&&this.startNextScene()}},{key:"startNextScene",value:function(){this.scene.start(this.nextScene)}}])&&Ni(i.prototype,a),s&&Ni(i,s),t}(s.a.Scene);function Qi(e){return(Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $i(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ea(e,t){return!t||"object"!==Qi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ta(e){return(ta=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ia(e,t){return(ia=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var aa=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ea(this,ta(t).call(this,{key:A.loading}))}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ia(e,t)}(t,e),i=t,(a=[{key:"preload",value:function(){var e,t;this.sys.game.db.loadLessons(this.tryStart,this),this.sys.game.db.loadStages(this.tryStart,this),this.ui=(e=this.sys.game.config,{backgroundImageX:0,backgroundImageY:0,backgroundImageWidth:(t=Qt(e)).w,backgroundImageHeight:t.h,backgroundImageOriginX:t.left,backgroundImageOriginY:t.top,loadingTextX:t.w_2,loadingTextY:t.h_40p,loadingTextOrigin:t.center,barBackgroundW:t.w_25p+t.padding,barBackgroundH:t.w_5p+t.padding,get barBackgroundX(){return t.w_2-this.barBackgroundW/2},get barBackgroundY(){return t.h_2-this.barBackgroundH/2},barW:t.w_25p,barH:t.w_5p,get barX(){return t.w_2-this.barW/2},get barY(){return t.h_2-this.barH/2}}),this.showBackground(),this.showProgressBar(),this.loadAssets(),o&&this.loadDummyAssets()}},{key:"create",value:function(){this.createAnimations(),this.sys.game.fullyLoaded=!0,this.tryStart()}},{key:"tryStart",value:function(){this.sys.game.fullyLoaded&&this.sys.game.db.isFullyLoaded()&&this.scene.start(A.titleMenu)}},{key:"showBackground",value:function(){this.background=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.titleScreenBackground),this.background.displayWidth=this.ui.backgroundImageWidth,this.background.displayHeight=this.ui.backgroundImageHeight,this.background.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY)}},{key:"showProgressBar",value:function(){var e=this,t=this.add.bitmapText(this.ui.loadingTextX,this.ui.loadingTextY,q,"LOADING",L.loadingTextSize);t.setOrigin(this.ui.loadingTextOrigin),t.setTintFill(L.loadingTextTint);var i=this.add.graphics();i.setPosition(this.ui.barBackgroundX,this.ui.barBackgroundY),i.fillStyle(C),i.fillRect(0,0,this.ui.barBackgroundW,this.ui.barBackgroundH);var a=this.add.graphics();a.setPosition(this.ui.barX,this.ui.barY),this.load.on("progress",(function(t){a.clear(),a.fillStyle(z),a.fillRect(0,0,e.ui.barW*t,e.ui.barH)}))}},{key:"loadAssets",value:function(){this.load.spritesheet(W.health,W.files.health,{frameWidth:5,frameHeight:20,margin:0,spacing:0}),this.load.audio(M.carousingEveryNight,M.files.carousingEveryNight),this.load.audio(M.inTheBackPocket,M.files.inTheBackPocket),this.load.audio(M.catchTheMystery,M.files.catchTheMystery),this.load.audio(M.inEarlyTime,M.files.inEarlyTime),this.load.audio(M.zombieAssaultIntro,M.files.zombieAssaultIntro),this.load.audio(M.zombieAssaultLoop,M.files.zombieAssaultLoop),this.load.audio(M.zombieAssaultReviewIntro,M.files.zombieAssaultReviewIntro),this.load.audio(M.zombieAssaultReviewLoop,M.files.zombieAssaultReviewLoop),this.load.audio(M.cheerfulPiano,M.files.cheerfulPiano),this.load.audio(M.outOfMyDreams,M.files.outOfMyDreams),this.load.audio(M.theLameDuck,M.files.theLameDuck),this.load.audio(u,O.menuMove),this.load.audio(c,O.menuSelectShoot),this.load.audio(d,O.menuSelectWave),this.load.audio(g,O.menuBackout),this.load.audio(p,O.buzz),this.load.audio(m,O.click),this.load.audio(f,O.thud),this.load.audio(b,O.glassBreak),this.load.audio(y,O.hitPistol),this.load.audio(v,O.hitShotgun),this.load.audio(w,O.itemGet),this.load.audio(k,O.itemSpawn),this.load.audio(S,O.zombieAttack),this.load.audio(T,O.mercHit),this.load.audio(I,O.shotMiss),this.load.audio(x,O.outOfAmmo),this.load.image(W.watch,W.files.watch),this.load.image(W.goldCoin,W.files.goldCoin),this.load.image(W.skull,W.files.skull),this.load.image(W.heart,W.files.heart),this.load.image(W.grass,W.files.grass),this.load.image(W.brick,W.files.brick),this.load.image(W.bloodSplatter1,W.files.bloodSplatter1),this.load.image(W.bloodSplatter2,W.files.bloodSplatter2),this.load.image(W.bloodSplatter3,W.files.bloodSplatter3),this.load.image(W.bloodSplatter4,W.files.bloodSplatter4),this.load.image(W.bloodSplatter5,W.files.bloodSplatter5),this.load.image(W.bloodSplatter6,W.files.bloodSplatter6),this.load.image(W.bloodSplatterGreen1,W.files.bloodSplatterGreen1),this.load.image(W.bloodSplatterGreen2,W.files.bloodSplatterGreen2),this.load.image(W.bloodSplatterGreen3,W.files.bloodSplatterGreen3),this.load.image(W.bloodSplatterGreen4,W.files.bloodSplatterGreen4),this.load.image(W.bloodSplatterGreen5,W.files.bloodSplatterGreen5),this.load.image(W.bloodSplatterGreen6,W.files.bloodSplatterGreen6),this.load.image(W.zombieFace,W.files.zombieFace),this.load.image(W.titleScreenBgFrontGrass,W.files.titleScreenBgFrontGrass),this.load.image(W.titleScreenBgTrees,W.files.titleScreenBgTrees),this.load.image(W.titleScreenBgBackGrass,W.files.titleScreenBgBackGrass),this.load.image(W.titleScreenBgSky,W.files.titleScreenBgSky),this.load.image(W.crate,W.files.crate),this.load.image(W.bottle1,W.files.bottle1),this.load.image(W.dirtPile,W.files.dirtPile),this.load.image(W.cash,W.files.cash),this.load.image(W.storyScreenBackground,W.files.storyScreenBackground),this.load.image(W.pointingHand,W.files.pointingHand),this.load.spritesheet(W.zombieNormal1,W.files.zombieNormal1,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieNormal2,W.files.zombieNormal2,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieNormal3,W.files.zombieNormal3,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieNormal4,W.files.zombieNormal4,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieNormal5,W.files.zombieNormal5,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieNormal6,W.files.zombieNormal6,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieSpecial1,W.files.zombieSpecial1,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieSpecial2,W.files.zombieSpecial2,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieReview1,W.files.zombieReview1,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.zombieReview2,W.files.zombieReview2,{frameWidth:W.frameSizes.zombie.width,frameHeight:W.frameSizes.zombie.height,margin:0,spacing:0}),this.load.spritesheet(W.shotBlast,W.files.shotBlast,{frameWidth:W.frameSizes.shotBlast.width,frameHeight:W.frameSizes.shotBlast.height,margin:0,spacing:0}),this.load.spritesheet(W.shotgunBlast,W.files.shotgunBlast,{frameWidth:W.frameSizes.shotgunBlast.width,frameHeight:W.frameSizes.shotgunBlast.height,margin:0,spacing:0}),this.load.spritesheet(W.shotBlastGreen,W.files.shotBlastGreen,{frameWidth:W.frameSizes.shotBlast.width,frameHeight:W.frameSizes.shotBlast.height,margin:0,spacing:0}),this.load.spritesheet(W.shotgunBlastGreen,W.files.shotgunBlastGreen,{frameWidth:W.frameSizes.shotgunBlast.width,frameHeight:W.frameSizes.shotgunBlast.height,margin:0,spacing:0}),this.load.spritesheet(W.shotBlastBottle,W.files.shotBlastBottle,{frameWidth:W.frameSizes.shotBlast.width,frameHeight:W.frameSizes.shotBlast.height,margin:0,spacing:0}),this.load.spritesheet(W.shotBlastDirt,W.files.shotBlastDirt,{frameWidth:W.frameSizes.shotBlast.width,frameHeight:W.frameSizes.shotBlast.height,margin:0,spacing:0}),this.load.spritesheet(W.shotgun,W.files.shotgun,{frameWidth:W.frameSizes.shotgun.width,frameHeight:W.frameSizes.shotgun.height,margin:0,spacing:0}),this.load.spritesheet(W.hudMenuBorder,W.files.hudMenuBorder,{frameWidth:W.frameSizes.hudMenuBorder.width,frameHeight:W.frameSizes.hudMenuBorder.height,margin:0,spacing:0}),this.load.spritesheet(W.hudItemBorder,W.files.hudItemBorder,{frameWidth:W.frameSizes.hudItemBorder.width,frameHeight:W.frameSizes.hudItemBorder.height,margin:0,spacing:0}),this.load.spritesheet(W.hudMessageBorder,W.files.hudMessageBorder,{frameWidth:W.frameSizes.hudMessageBorder.width,frameHeight:W.frameSizes.hudMessageBorder.height,margin:0,spacing:0}),this.load.spritesheet(W.bottle1Explode,W.files.bottle1Explode,{frameWidth:W.frameSizes.bottle1Explode.width,frameHeight:W.frameSizes.bottle1Explode.height,margin:0,spacing:0}),this.load.spritesheet(W.yellowBubble,W.files.yellowBubble,{frameWidth:W.frameSizes.yellowBubble.width,frameHeight:W.frameSizes.yellowBubble.height,margin:0,spacing:0}),this.load.spritesheet(W.colorSquare,W.files.colorSquare,{frameWidth:W.frameSizes.colorSquare.width,frameHeight:W.frameSizes.colorSquare.height,margin:0,spacing:0}),this.load.spritesheet(W.mercenary,W.files.mercenary,{frameWidth:W.frameSizes.mercenary.width,frameHeight:W.frameSizes.mercenary.height,margin:0,spacing:0}),this.load.spritesheet(W.weapon,W.files.weapon,{frameWidth:W.frameSizes.weapon.width,frameHeight:W.frameSizes.weapon.height,margin:0,spacing:0}),this.load.spritesheet(W.popWhite,W.files.popWhite,{frameWidth:W.frameSizes.popWhite.width,frameHeight:W.frameSizes.popWhite.height,margin:0,spacing:0}),this.load.spritesheet(W.foodTier1,W.files.foodTier1,{frameWidth:W.frameSizes.foodTier1.width,frameHeight:W.frameSizes.foodTier1.height,margin:0,spacing:0})}},{key:"createAnimations",value:function(){var e=this,t=n,i=n.frames,a=n.frameRates,s=Mt;[W.zombieNormal1,W.zombieNormal2,W.zombieNormal3,W.zombieNormal4,W.zombieNormal5,W.zombieNormal6,W.zombieSpecial1,W.zombieSpecial2,W.zombieReview1,W.zombieReview2].forEach((function(n){e.zombieAnimation(s(n,t.zombieBounce),n,i.zombieBounce,a.zombieBounce,!0),e.zombieAnimation(s(n,t.zombieWalk),n,i.zombieWalk,a.zombieWalk,!0),e.zombieAnimation(s(n,t.zombieRun),n,i.zombieRun,a.zombieRun,!0),e.zombieAnimation(s(n,t.zombieFall),n,i.zombieFall,a.zombieFall,!1),e.zombieAnimation(s(n,t.zombieDamage),n,i.zombieDamage,a.zombieDamage,!1),e.zombieAnimation(s(n,t.zombieDie),n,i.zombieDie,a.zombieDie,!1),e.zombieAnimation(s(n,t.zombieStun),n,i.zombieStun,a.zombieStun,!0),e.zombieAnimation(s(n,t.zombieAttack),n,i.zombieAttack,a.zombieAttack,!1)})),this.anims.create({key:n.shotBlastExplode,frames:this.anims.generateFrameNames(W.shotBlast,{frames:n.frames.shotBlastExplode}),frameRate:n.frameRates.shotBlastExplode,repeat:0}),this.anims.create({key:n.shotgunBlastExplode,frames:this.anims.generateFrameNames(W.shotgunBlast,{frames:n.frames.shotgunBlastExplode}),frameRate:n.frameRates.shotBlastExplode,repeat:0}),this.anims.create({key:n.shotBlastGreenExplode,frames:this.anims.generateFrameNames(W.shotBlastGreen,{frames:n.frames.shotBlastGreenExplode}),frameRate:n.frameRates.shotBlastGreenExplode,repeat:0}),this.anims.create({key:n.shotgunBlastGreenExplode,frames:this.anims.generateFrameNames(W.shotgunBlastGreen,{frames:n.frames.shotgunBlastGreenExplode}),frameRate:n.frameRates.shotBlastExplode,repeat:0}),this.anims.create({key:n.shotBlastBottleExplode,frames:this.anims.generateFrameNames(W.shotBlastBottle,{frames:n.frames.shotBlastBottleExplode}),frameRate:n.frameRates.shotBlastBottleExplode,repeat:0}),this.anims.create({key:n.shotBlastDirtExplode,frames:this.anims.generateFrameNames(W.shotBlastDirt,{frames:n.frames.shotBlastDirtExplode}),frameRate:n.frameRates.shotBlastDirtExplode,repeat:0}),this.anims.create({key:n.bottle1Explode,frames:this.anims.generateFrameNames(W.bottle1Explode,{frames:n.frames.bottle1Explode}),frameRate:n.frameRates.bottle1Explode,repeat:0}),this.anims.create({key:n.popWhitePop,frames:this.anims.generateFrameNames(W.popWhite,{frames:n.frames.popWhitePop}),frameRate:n.frameRates.popWhitePop,repeat:0})}},{key:"zombieAnimation",value:function(e,t,i,a,s){this.anims.create({key:e,frames:this.anims.generateFrameNames(t,{frames:i}),frameRate:a,repeat:s?-1:0})}},{key:"loadDummyAssets",value:function(){for(var e=0;e<250;e+=1)this.load.image("test".concat(e),W.files.loading)}}])&&$i(i.prototype,a),s&&$i(i,s),t}(s.a.Scene),sa=function(e){var t=Qt(e);return{backgroundImageX:0,backgroundImageY:0,backgroundImageWidth:t.w,backgroundImageHeight:t.h,backgroundImageOriginX:t.left,backgroundImageOriginY:t.top,textX:t.w_40p,textY:t.h_40p,textOriginX:t.left,textOriginY:t.top,textVerticalPadding:t.h_10p,instructionsX:t.w_2,instructionsY:t.h_95p,instructionsOrigin:t.center,selectX:t.w_40p,get selectY(){return this.textY+this.textVerticalPadding/3},selectWidth:t.w_10p,selectHeight:t.w_5p,selectOriginX:t.right,selectOriginY:t.center,get selectVerticalPadding(){return this.textVerticalPadding},minBackSpawnY:.75*t.h,maxBackSpawnY:.84*t.h,minFrontSpawnY:.88*t.h,maxFrontSpawnY:.95*t.h,zombieFrontWidth:.09*t.w,zombieBackWidth:.05*t.w,zombieOrigin:t.center,get loginPointerX(){return t.w-.02*t.w-this.loginPointerWidth/2},get loginPointerY(){return.02*t.w+this.loginPointerWidth/2},loginPointerWidth:.06*t.w,loginPointerOriginX:t.center,loginPointerOriginY:t.center,get loginTextX(){return this.loginPointerX-this.loginPointerWidth*B.loginPointerExpansionFactor/2-.02*t.w},get loginTextY(){return.03*t.w},loginTextOriginX:t.right,loginTextOriginY:t.top}};function na(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var oa=[W.zombieNormal1,W.zombieNormal2,W.zombieNormal3,W.zombieNormal4,W.zombieNormal5,W.zombieNormal6],ra=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.totalDistance=this.scene.sys.game.config.width,this.zombies=[]}var t,i,a;return t=e,(i=[{key:"moveZombies",value:function(e){var t=this;this.zombies.forEach((function(i){var a=t.getMovement(i.speed,e);i.x+=a,i.x>t.scene.sys.game.config.width&&(i.alive=!1)}))}},{key:"destroyDeadZombies",value:function(){this.zombies.filter((function(e){return!e.alive})).forEach((function(e){e.destroy()})),this.zombies=this.zombies.filter((function(e){return e.alive}))}},{key:"spawnZombie",value:function(e){var t=s.a.Math.RND.pick(oa),i=this.scene.add.sprite(-200,e.yPosition,t,0);e.isFront?(i.displayWidth=this.scene.ui.zombieFrontWidth,i.displayHeight=this.scene.ui.zombieFrontWidth):(i.displayWidth=this.scene.ui.zombieBackWidth,i.displayHeight=this.scene.ui.zombieBackWidth);var a=e.isFront?r.titleMenu.frontZombies:r.titleMenu.backZombies;i.setDepth(a+e.row),i.image=t,i.speed=e.speed,i.alive=!0,i.play(Mt(t,n.zombieWalk)),this.zombies.push(i)}},{key:"getMovement",value:function(e,t){return e*t*this.totalDistance/1e6}}])&&na(t.prototype,i),a&&na(t,a),e}();function la(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ha=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.nextSpawnTime=this.getSpawnDelay(0),this.prevSpawnRow=0,this.ui=sa(this.scene.sys.game.config)}var t,i,a;return t=e,(i=[{key:"getSpawn",value:function(e){var t={canSpawn:!1};if(e>=this.nextSpawnTime){t.canSpawn=!0,t.isFront=s.a.Math.RND.pick([!0,!1]);var i=this.getSpawnLocation(t.isFront);t.row=i.row,t.yPosition=i.yPosition,t.speed=this.getRunSpeed(t.isFront),this.nextSpawnTime=e+this.getSpawnDelay(e)}return t}},{key:"getSpawnLocation",value:function(e){var t=s.a.Math.RND.between(0,B.spawnRows-1),i=e?this.ui.minFrontSpawnY:this.ui.minBackSpawnY;return{row:t,yPosition:i+((e?this.ui.maxFrontSpawnY:this.ui.maxBackSpawnY)-i)*t/B.spawnRows}}},{key:"getSpawnDelay",value:function(){return B.baseSpawnRate+s.a.Math.RND.between(-B.spawnRange,B.spawnRange)}},{key:"getRunSpeed",value:function(e){var t=e?B.frontRunRange:B.backRunRange;return(e?B.baseFrontRunSpeed:B.baseBackRunSpeed)+s.a.Math.RND.between(-t,t)}}])&&la(t.prototype,i),a&&la(t,a),e}();function ua(e){return(ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ca(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function da(e,t){return!t||"object"!==ua(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ga(e){return(ga=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ma(e,t){return(ma=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pa=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),da(this,ga(t).call(this,{key:A.titleMenu}))}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ma(e,t)}(t,e),i=t,(a=[{key:"init",value:function(){this.zombieManager=new ra(this),this.spawnManager=new ha(this),this.progressManager=new ui(this.sys.game.db),this.modalHelper=new wi(this),this.audioManager=new Li(this),this.menuOptions=[],this.currentSelection=0,this.selectedOption="",this.sys.game.db.isUserLoggedIn()?this.progressManager.isNewGame()?this.menuOptions.push({text:B.menu.newGame,key:"start"}):this.menuOptions.push({text:B.menu.continueGame,key:"start"}):this.menuOptions.push({text:B.menu.playDemo,key:"start"}),this.menuOptions.push({text:B.menu.options,key:"options"})}},{key:"create",value:function(){this.ui=sa(this.sys.game.config),this.createBackground(),this.createMenu(),this.createInstructions(),this.createInput(),this.createAudio(),this.createLoginPrompt(),this.updateMenuSelection()}},{key:"update",value:function(e,t){var i=this.spawnManager.getSpawn(e);i.canSpawn&&this.zombieManager.spawnZombie(i),this.zombieManager.moveZombies(t),this.zombieManager.destroyDeadZombies()}},{key:"createLoginPrompt",value:function(){this.sys.game.db.isUserLoggedIn()||(this.loginPointer=this.add.sprite(this.ui.loginPointerX,this.ui.loginPointerY,W.pointingHand),this.loginPointer.setOrigin(this.ui.loginPointerOriginX,this.ui.loginPointerOriginY),this.loginPointer.setDisplaySize(this.ui.loginPointerWidth,this.ui.loginPointerWidth),this.loginPointer.setRotation(B.loginPointerRotation),this.tweens.add({targets:this.loginPointer,yoyo:!0,repeat:-1,ease:"Power1",duration:B.loginPointerExpansionDuration,displayWidth:this.ui.loginPointerWidth*B.loginPointerExpansionFactor,displayHeight:this.ui.loginPointerWidth*B.loginPointerExpansionFactor}),this.loginText=this.add.bitmapText(this.ui.loginTextX,this.ui.loginTextY,q,B.loginText,B.fonts.loginSize),this.loginText.setOrigin(this.ui.loginTextOriginX,this.ui.loginTextOriginY),this.loginText.setDepth(r.titleMenu.text),this.loginText.setTintFill(B.fonts.loginTint),this.loginText.setRightAlign())}},{key:"createInput",value:function(){this.keys=this.input.keyboard.addKeys("SPACE,ENTER,UP,DOWN,TAB"),this.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"createAudio",value:function(){this.audioManager.addSound(B.audio.menuMove),this.audioManager.addSound(B.audio.menuSelect)}},{key:"handleKeyDown",value:function(e){e.keyCode===this.keys.UP.keyCode?this.decrementMenuSelection():e.keyCode===this.keys.DOWN.keyCode?this.incrementMenuSelection():e.keyCode!==this.keys.SPACE.keyCode&&e.keyCode!==this.keys.ENTER.keyCode||(this.selectedOption=this.menuOptions[this.currentSelection].key,this.audioManager.playSound(B.audio.menuSelect),this.selector.setFrame(1),this.cameras.main.fade(B.screenFadeTime,0,0,0,!1,this.fadeCallback))}},{key:"decrementMenuSelection",value:function(){this.currentSelection=Math.max(this.currentSelection-1,0),this.audioManager.playSound(B.audio.menuMove),this.updateMenuSelection()}},{key:"incrementMenuSelection",value:function(){this.currentSelection=Math.min(this.currentSelection+1,this.menuOptions.length-1),this.audioManager.playSound(B.audio.menuMove),this.updateMenuSelection()}},{key:"updateMenuSelection",value:function(){this.selector.y=this.ui.selectY+this.ui.selectVerticalPadding*this.currentSelection}},{key:"fadeCallback",value:function(e,t){1===t&&("start"===this.selectedOption?this.startGame():"options"===this.selectedOption&&this.scene.start(A.optionsMenu))}},{key:"createInstructions",value:function(){this.instructionText=this.add.bitmapText(this.ui.instructionsX,this.ui.instructionsY,q,B.instructions,B.fonts.instructionsSize),this.instructionText.setOrigin(this.ui.instructionsOrigin),this.instructionText.setDepth(r.titleMenu.text),this.instructionText.setTintFill(B.fonts.instructionsTint)}},{key:"createMenu",value:function(){var e=this;this.menuOptions.forEach((function(t,i){var a=e.add.bitmapText(e.ui.textX,e.ui.textY+e.ui.textVerticalPadding*i,q,t.text,B.fonts.textSize);a.setOrigin(e.ui.textOriginX,e.ui.textOriginY),a.setDepth(r.titleMenu.text),a.setTintFill(B.fonts.textTint)})),this.selector=this.add.sprite(this.ui.selectX,this.ui.selectY,W.shotgun,W.frames.shotgunNormal),this.selector.displayWidth=this.ui.selectWidth,this.selector.displayHeight=this.ui.selectHeight,this.selector.flipX=!0,this.selector.setOrigin(this.ui.selectOriginX,this.ui.selectOriginY)}},{key:"startGame",value:function(){this.sys.game.db.isUserLoggedIn()?this.progressManager.isNewGame()?this.scene.start(A.story,{modalConfig:this.modalHelper.getModalConfig("game-intro"),nextScreen:A.townMap}):this.scene.start(A.townMap):this.scene.start(A.minigame,ne.stage1)}},{key:"createBackground",value:function(){this.bgFrontGrass=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.titleScreenBgFrontGrass),this.bgFrontGrass.displayWidth=this.ui.backgroundImageWidth,this.bgFrontGrass.displayHeight=this.ui.backgroundImageHeight,this.bgFrontGrass.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY),this.bgFrontGrass.setDepth(r.titleMenu.frontGrass),this.bgTrees=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.titleScreenBgTrees),this.bgTrees.displayWidth=this.ui.backgroundImageWidth,this.bgTrees.displayHeight=this.ui.backgroundImageHeight,this.bgTrees.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY),this.bgTrees.setDepth(r.titleMenu.trees),this.bgBackGrass=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.titleScreenBgBackGrass),this.bgBackGrass.displayWidth=this.ui.backgroundImageWidth,this.bgBackGrass.displayHeight=this.ui.backgroundImageHeight,this.bgBackGrass.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY),this.bgBackGrass.setDepth(r.titleMenu.backGrass),this.bgSky=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.titleScreenBgSky),this.bgSky.displayWidth=this.ui.backgroundImageWidth,this.bgSky.displayHeight=this.ui.backgroundImageHeight,this.bgSky.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY),this.bgSky.setDepth(r.titleMenu.sky)}}])&&ca(i.prototype,a),s&&ca(i,s),t}(s.a.Scene);function fa(e){return(fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ba(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ya(e,t){return!t||"object"!==fa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function va(e){return(va=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wa(e,t){return(wa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ka=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ya(this,va(t).call(this,{key:A.endgame}))}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wa(e,t)}(t,e),i=t,(a=[{key:"init",value:function(e){this.progressManager=new ui(this.sys.game.db),this.params=e,this.currentSelection=0,this.inputHandled=!1,this.won=this.params.status===P.win,this.stageId=this.params.stageId,this.sys.game.db.isUserLoggedIn()?(this.winOptions=[{text:P.menu.returnToMap,key:"map"}],this.loseOptions=[{text:P.menu.tryAgain,key:"redo"},{text:P.menu.returnToMap,key:"map"}],this.allowTargetPractice()&&this.loseOptions.push({text:P.menu.targetPractice,key:"practice"})):(this.winOptions=[{text:P.menu.returnToTitle,key:"title"}],this.loseOptions=[{text:P.menu.returnToTitle,key:"title"}]),this.ModalChecker=new Ii(this,this.stageId,this.won),this.audioManager=new Li(this)}},{key:"create",value:function(){var e,t;this.ui=(e=this.sys.game.config,{backgroundImageX:0,backgroundImageY:0,backgroundImageWidth:(t=Qt(e)).w,backgroundImageHeight:t.h,backgroundImageOriginX:t.left,backgroundImageOriginY:t.top,statusLabelX:t.w_2,statusLabelY:t.h_40p,statusLabelOrigin:t.center,menuTextX:t.w_40p,get menuTextY(){return this.statusLabelY+t.h_10p},menuTextOriginX:t.left,menuTextOriginY:t.top,menuTextVerticalPadding:.075*t.h,selectX:t.w_40p,get selectY(){return this.menuTextY-.01*t.h},selectOriginX:t.right,selectOriginY:t.top,selectWidth:t.w_10p,selectHeight:t.w_5p,get selectVerticalPadding(){return this.menuTextVerticalPadding}}),this.showBackground(),this.showStatus(),this.createMenu(),this.createAudio(),this.enableInputHandling(),this.updateMenuSelection(),this.audioManager.playMusic(),this.checkStartModal()}},{key:"showBackground",value:function(){this.background=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.storyScreenBackground),this.background.displayWidth=this.ui.backgroundImageWidth,this.background.displayHeight=this.ui.backgroundImageHeight,this.background.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY),this.background.setDepth(r.endgame.background)}},{key:"showStatus",value:function(){var e=this.params.status===P.win?P.winText:P.loseText,t=this.add.bitmapText(this.ui.statusLabelX,this.ui.statusLabelY,q,e,P.fonts.statusSize);t.setOrigin(this.ui.statusLabelOrigin),t.setDepth(r.endgame.text),t.setTintFill(P.fonts.statusTint)}},{key:"createAudio",value:function(){this.won?this.audioManager.setMusic(P.audio.music.winMusic,P.audio.musicConfig.winMusic):this.audioManager.setMusic(P.audio.music.loseMusic,P.audio.musicConfig.loseMusic),this.audioManager.addAllSounds(P.audio.soundEffects)}},{key:"createMenu",value:function(){var e=this;this.options=this.params.status===P.win?this.winOptions:this.loseOptions,this.options.forEach((function(t,i){var a=e.add.bitmapText(e.ui.menuTextX,e.ui.menuTextY+e.ui.menuTextVerticalPadding*i,q,t.text,P.fonts.menuSize);a.setOrigin(e.ui.menuTextOriginX,e.ui.menuTextOriginY),a.setDepth(r.endgame.text),a.setTintFill(P.fonts.menuTint)})),this.selector=this.add.sprite(this.ui.selectX,this.ui.selectY,W.shotgun,W.frames.shotgunNormal),this.selector.displayWidth=this.ui.selectWidth,this.selector.displayHeight=this.ui.selectHeight,this.selector.flipX=!0,this.selector.setOrigin(this.ui.selectOriginX,this.ui.selectOriginY)}},{key:"checkStartModal",value:function(){var e=this;this.ModalChecker.setBeforeStartCallback((function(){e.disableInputHandling()})),this.ModalChecker.setCompletedCallback((function(){e.enableInputHandling()})),this.ModalChecker.checkModal()}},{key:"enableInputHandling",value:function(){this.inputHandled||(this.inputHandled=!0,this.createInput())}},{key:"disableInputHandling",value:function(){this.inputHandled&&(this.inputHandled=!1,this.keys=null,this.input.keyboard.off("keydown",this.handleKeyDown))}},{key:"createInput",value:function(){this.keys=this.input.keyboard.addKeys("SPACE,ENTER,UP,DOWN"),this.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){e.keyCode===this.keys.UP.keyCode?this.decrementMenuSelection():e.keyCode===this.keys.DOWN.keyCode?this.incrementMenuSelection():e.keyCode!==this.keys.SPACE.keyCode&&e.keyCode!==this.keys.ENTER.keyCode||(this.audioManager.playSound(P.audio.soundEffects.menuSelect),this.selectedOption=this.options[this.currentSelection].key,this.selector.setFrame(1),this.cameras.main.fade(P.screenFadeTime,0,0,0,!1,this.fadeCallback))}},{key:"decrementMenuSelection",value:function(){this.audioManager.playSound(P.audio.soundEffects.menuMove),this.currentSelection=Math.max(this.currentSelection-1,0),this.updateMenuSelection()}},{key:"incrementMenuSelection",value:function(){this.audioManager.playSound(P.audio.soundEffects.menuMove),this.currentSelection=Math.min(this.currentSelection+1,this.options.length-1),this.updateMenuSelection()}},{key:"updateMenuSelection",value:function(){this.selector.y=this.ui.selectY+this.ui.selectVerticalPadding*this.currentSelection}},{key:"fadeCallback",value:function(e,t){this.audioManager.setMusicVolume(1-t),1===t&&(this.audioManager.stopMusic(),"map"===this.selectedOption?this.scene.start(A.townMap):"practice"===this.selectedOption?this.scene.start(A.vocabStudy,this.params.stageId):"redo"===this.selectedOption?this.scene.start(A.minigame,this.params.stageId):"title"===this.selectedOption&&this.scene.start(A.titleMenu))}},{key:"allowTargetPractice",value:function(){return this.progressManager.getStageType(this.stageId)===se.zombieAssault}}])&&ba(i.prototype,a),s&&ba(i,s),t}(s.a.Scene),Sa=function(e){var t=Qt(e),i=$t(e);return{vocabLeft1X:t.padding,vocabLeft2X:t.w_33p-t.padding,vocabRight1X:t.w_66p+t.padding,vocabRight2X:t.w-t.padding,vocab1OriginX:t.left,vocab1OriginY:t.top,vocab2OriginX:t.right,vocab2OriginY:t.top,vocabY:t.padding,get vocabVerticalPadding(){return(t.h-V.height-V.bufferHeight)/10},dotsOriginX:t.center,dotsOriginY:t.top,grassX:t.w_33p+t.padding,grassY:0,grassWidth:t.w_33p-2*t.padding,get grassHeight(){return t.h-V.height-V.bufferHeight},grassOriginX:t.left,grassOriginY:t.top,crateX:t.w_2,crateY:t.h_15p,crateWidth:t.w_5p,crateHeight:t.w_5p,crateOriginX:t.center,crateOriginY:t.center,bottleX:t.w_2,get bottleY(){return this.crateY-.01*t.h},bottleOriginX:t.center,bottleOriginY:t.bottom,menuOption1X:t.padding,menuOption1Y:t.h-V.height+t.padding,get menuOption2X(){return this.menuOption1X+this.menuOptionWidth+t.padding},menuOption2Y:t.h-V.height+t.padding,get menuOption3X(){return this.menuOption2X+this.menuOptionWidth+t.padding},menuOption3Y:t.h-V.height+t.padding,menuOption4X:t.padding,get menuOption4Y(){return this.menuOption1Y+this.menuOptionHeight+2*t.padding},get menuOption5X(){return this.menuOption1X+this.menuOptionWidth+t.padding},get menuOption5Y(){return this.menuOption1Y+this.menuOptionHeight+2*t.padding},get menuOption6X(){return this.menuOption5X+this.menuOptionWidth+t.padding},get menuOption6Y(){return this.menuOption1Y+this.menuOptionHeight+2*t.padding},menuOptionWidth:i.messageBorderX/3-2*t.padding,menuOptionHeight:V.height/2-2*t.padding,menuOptionOriginX:t.top,menuOptionOriginY:t.left,get menuOption1TextX(){return this.menuOption1X+this.menuOptionWidth/2},get menuOption1TextY(){return this.menuOption1Y+this.menuOptionHeight/2},get menuOption2TextX(){return this.menuOption2X+this.menuOptionWidth/2},get menuOption2TextY(){return this.menuOption2Y+this.menuOptionHeight/2},get menuOption3TextX(){return this.menuOption3X+this.menuOptionWidth/2},get menuOption3TextY(){return this.menuOption3Y+this.menuOptionHeight/2},get menuOption4TextX(){return this.menuOption4X+this.menuOptionWidth/2},get menuOption4TextY(){return this.menuOption4Y+this.menuOptionHeight/2},get menuOption5TextX(){return this.menuOption5X+this.menuOptionWidth/2},get menuOption5TextY(){return this.menuOption5Y+this.menuOptionHeight/2},get menuOption6TextX(){return this.menuOption6X+this.menuOptionWidth/2},get menuOption6TextY(){return this.menuOption6Y+this.menuOptionHeight/2},menuOptionTextOrigin:t.center,get practiceVocabX(){return this.crateX},get practiceVocabY(){return this.crateY+this.crateHeight/2+t.padding},practiceVocabOriginX:t.center,practiceVocabOriginY:t.top,shotBlastBottleOriginX:t.center,shotBlastBottleOriginY:t.bottom,missBlastLeftMinX:t.w_35p,missBlastLeftMinY:t.padding,missBlastLeftMaxX:t.w_2-t.w_5p,missBlastLeftMaxY:t.h_25p,missBlastRightMinX:t.w_2+t.w_5p,missBlastRightMinY:t.padding,missBlastRightMaxX:.64*t.w,missBlastRightMaxY:t.h_25p,missBlastOrigin:t.center}};function Ta(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ia(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var xa=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.vocab=new Ot(i),this.ui=Sa(this.scene.sys.game.config)}var t,i,a;return t=e,(i=[{key:"createVocab",value:function(){var e=this;this.language1Group=this.scene.add.group(),this.language2Group=this.scene.add.group(),this.dotsGroup=this.scene.add.group(),this.entries=[];var t=Ta(this.vocab.content);Wt(t),t.forEach((function(t,i){var a=t.language1.length+e.vocab.l2WithGender(t).length,s=a<=22?R.fonts.vocabSize:R.fonts.vocabSizeSmall,n=Math.ceil(Math.max((26-a)/4,0)),o=0,r=0,l=0;i<10?(o=e.ui.vocabLeft1X,r=e.ui.vocabLeft2X,l=i):(o=e.ui.vocabRight1X,r=e.ui.vocabRight2X,l=i-10);var h=e.scene.add.bitmapText(o,e.ui.vocabY+e.ui.vocabVerticalPadding*l,q,t.language1,s);h.setOrigin(e.ui.vocab1OriginX,e.ui.vocab1OriginY),h.setTintFill(R.fonts.vocabTint);var u=e.scene.add.bitmapText(r,e.ui.vocabY+e.ui.vocabVerticalPadding*l,q,e.vocab.l2WithGender(t),s);u.setOrigin(e.ui.vocab2OriginX,e.ui.vocab2OriginY),u.setTintFill(R.fonts.vocabTint);var c=e.scene.add.bitmapText((o+h.width+r-u.width)/2,e.ui.vocabY+e.ui.vocabVerticalPadding*l,q," . ".repeat(n),R.fonts.dotSize);c.setOrigin(e.ui.dotsOriginX,e.ui.dotsOriginY),c.setTintFill(R.fonts.vocabTint);var d={word:t,language1:h,language2:u,dots:c};e.language1Group.add(h),e.language2Group.add(u),e.dotsGroup.add(c),e.entries.push(d)}))}},{key:"clearAllTint",value:function(){this.entries.forEach((function(e){e.language1.clearTint(),e.language2.clearTint(),e.dots.clearTint()}))}},{key:"showEntryCorrect",value:function(e){this.entries.some((function(t){return e.id===t.word.id&&(t.language1.setTintFill(R.fonts.practiceWordCorrectTint),t.language1.visible=!0,t.language2.setTintFill(R.fonts.practiceWordCorrectTint),t.language2.visible=!0,t.dots.setTintFill(R.fonts.practiceWordCorrectTint),t.dots.visible=!0,!0)}))}},{key:"showEntryWrong",value:function(e){this.entries.some((function(t){return e.id===t.word.id&&(t.language1.setTintFill(R.fonts.practiceWordWrongTint),t.language1.visible=!0,t.language2.setTintFill(R.fonts.practiceWordWrongTint),t.language2.visible=!0,t.dots.setTintFill(R.fonts.practiceWordWrongTint),t.dots.visible=!0,!0)}))}},{key:"hideLanguage1",value:function(){this.language1Group.getChildren().forEach((function(e){e.visible=!1})),this.dotsGroup.getChildren().forEach((function(e){e.visible=!1})),this.language2Group.getChildren().forEach((function(e){e.visible=!0}))}},{key:"hideLanguage2",value:function(){this.language1Group.getChildren().forEach((function(e){e.visible=!0})),this.dotsGroup.getChildren().forEach((function(e){e.visible=!1})),this.language2Group.getChildren().forEach((function(e){e.visible=!1}))}},{key:"showAll",value:function(){this.language1Group.getChildren().forEach((function(e){e.visible=!0})),this.dotsGroup.getChildren().forEach((function(e){e.visible=!0})),this.language2Group.getChildren().forEach((function(e){e.visible=!0}))}},{key:"hideAll",value:function(){this.language1Group.getChildren().forEach((function(e){e.visible=!1})),this.dotsGroup.getChildren().forEach((function(e){e.visible=!1})),this.language2Group.getChildren().forEach((function(e){e.visible=!1}))}}])&&Ia(t.prototype,i),a&&Ia(t,a),e}();function Oa(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ma=5,Pa=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.hideLanguage1=i.hideLanguage1,this.hideLanguage2=i.hideLanguage2,this.showAll=i.showAll,this.startTargetPractice=i.startTargetPractice,this.returnToMap=i.returnToMap,this.startGame=i.startGame,this.inputHandled=!0,this.ui=Sa(this.scene.sys.game.config),this.selectedOption=Ma}var t,i,a;return t=e,(i=[{key:"createMenu",value:function(){this.createInput(),this.menuSprites=this.scene.add.group(),this.option1=this.scene.add.sprite(this.ui.menuOption1X,this.ui.menuOption1Y,W.hudMenuBorder),this.option1.displayWidth=this.ui.menuOptionWidth,this.option1.displayHeight=this.ui.menuOptionHeight,this.option1.setOrigin(this.ui.menuOptionOriginX,this.ui.menuOptionOriginY),this.menuSprites.add(this.option1),this.option2=this.scene.add.sprite(this.ui.menuOption2X,this.ui.menuOption2Y,W.hudMenuBorder),this.option2.displayWidth=this.ui.menuOptionWidth,this.option2.displayHeight=this.ui.menuOptionHeight,this.option2.setOrigin(this.ui.menuOptionOriginX,this.ui.menuOptionOriginY),this.menuSprites.add(this.option2),this.option3=this.scene.add.sprite(this.ui.menuOption3X,this.ui.menuOption3Y,W.hudMenuBorder),this.option3.displayWidth=this.ui.menuOptionWidth,this.option3.displayHeight=this.ui.menuOptionHeight,this.option3.setOrigin(this.ui.menuOptionOriginX,this.ui.menuOptionOriginY),this.menuSprites.add(this.option3),this.option4=this.scene.add.sprite(this.ui.menuOption4X,this.ui.menuOption4Y,W.hudMenuBorder),this.option4.displayWidth=this.ui.menuOptionWidth,this.option4.displayHeight=this.ui.menuOptionHeight,this.option4.setOrigin(this.ui.menuOptionOriginX,this.ui.menuOptionOriginY),this.menuSprites.add(this.option4),this.option5=this.scene.add.sprite(this.ui.menuOption5X,this.ui.menuOption5Y,W.hudMenuBorder),this.option5.displayWidth=this.ui.menuOptionWidth,this.option5.displayHeight=this.ui.menuOptionHeight,this.option5.setOrigin(this.ui.menuOptionOriginX,this.ui.menuOptionOriginY),this.menuSprites.add(this.option5),this.option6=this.scene.add.sprite(this.ui.menuOption6X,this.ui.menuOption6Y,W.hudMenuBorder),this.option6.displayWidth=this.ui.menuOptionWidth,this.option6.displayHeight=this.ui.menuOptionHeight,this.option6.setOrigin(this.ui.menuOptionOriginX,this.ui.menuOptionOriginY),this.menuSprites.add(this.option6),this.option1Text=this.scene.add.bitmapText(this.ui.menuOption1TextX,this.ui.menuOption1TextY,q,"Hide ".concat(j),R.fonts.menuOptionSize),this.option1Text.setOrigin(this.ui.menuOptionTextOrigin),this.option1Text.setTintFill(R.fonts.menuOptionTint),this.menuSprites.add(this.option1Text),this.option2Text=this.scene.add.bitmapText(this.ui.menuOption2TextX,this.ui.menuOption2TextY,q,"Hide ".concat(N),R.fonts.menuOptionSize),this.option2Text.setOrigin(this.ui.menuOptionTextOrigin),this.option2Text.setTintFill(R.fonts.menuOptionTint),this.menuSprites.add(this.option2Text),this.option3Text=this.scene.add.bitmapText(this.ui.menuOption3TextX,this.ui.menuOption3TextY,q,"Show All",R.fonts.menuOptionSize),this.option3Text.setOrigin(this.ui.menuOptionTextOrigin),this.option3Text.setTintFill(R.fonts.menuOptionTint),this.menuSprites.add(this.option3Text),this.option4Text=this.scene.add.bitmapText(this.ui.menuOption4TextX,this.ui.menuOption4TextY,q,"Practice",R.fonts.menuOptionSize),this.option4Text.setOrigin(this.ui.menuOptionTextOrigin),this.option4Text.setTintFill(R.fonts.menuOptionTint),this.menuSprites.add(this.option4Text),this.option5Text=this.scene.add.bitmapText(this.ui.menuOption5TextX,this.ui.menuOption5TextY,q,"Back to Map",R.fonts.menuOptionSize),this.option5Text.setOrigin(this.ui.menuOptionTextOrigin),this.option5Text.setTintFill(R.fonts.menuOptionTint),this.menuSprites.add(this.option5Text),this.option6Text=this.scene.add.bitmapText(this.ui.menuOption6TextX,this.ui.menuOption6TextY,q,"Start Game",R.fonts.menuOptionSize),this.option6Text.setOrigin(this.ui.menuOptionTextOrigin),this.option6Text.setTintFill(R.fonts.menuOptionTint),this.menuSprites.add(this.option6Text),this.updateSelection()}},{key:"updateSelection",value:function(){this.option1.setFrame(W.frames.hudMenuDark),this.option2.setFrame(W.frames.hudMenuDark),this.option3.setFrame(W.frames.hudMenuDark),this.option4.setFrame(W.frames.hudMenuDark),this.option5.setFrame(W.frames.hudMenuDark),this.option6.setFrame(W.frames.hudMenuDark),1===this.selectedOption?this.option1.setFrame(W.frames.hudMenuLight):2===this.selectedOption?this.option2.setFrame(W.frames.hudMenuLight):3===this.selectedOption?this.option3.setFrame(W.frames.hudMenuLight):4===this.selectedOption?this.option4.setFrame(W.frames.hudMenuLight):this.selectedOption===Ma?this.option5.setFrame(W.frames.hudMenuLight):6===this.selectedOption&&this.option6.setFrame(W.frames.hudMenuLight)}},{key:"selectOption",value:function(){1===this.selectedOption?this.hideLanguage1.call(this.scene):2===this.selectedOption?this.hideLanguage2.call(this.scene):3===this.selectedOption?this.showAll.call(this.scene):this.selectedOption===Ma?this.returnToMap.call(this.scene):4===this.selectedOption?this.startTargetPractice.call(this.scene):6===this.selectedOption&&this.startGame.call(this.scene)}},{key:"enableInputHandling",value:function(){this.inputHandled||(this.inputHandled=!0,this.createInput())}},{key:"disableInputHandling",value:function(){this.inputHandled&&(this.inputHandled=!1,this.keys=null,this.scene.input.keyboard.off("keydown",this.handleKeyDown))}},{key:"showMenu",value:function(){this.menuSprites.getChildren().forEach((function(e){e.visible=!0}))}},{key:"hideMenu",value:function(){this.menuSprites.getChildren().forEach((function(e){e.visible=!1}))}},{key:"createInput",value:function(){this.keys=this.scene.input.keyboard.addKeys("SPACE,ENTER,UP,DOWN,LEFT,RIGHT,TAB,ESC"),this.scene.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){if(e.keyCode!==this.keys.UP.keyCode||4!==this.selectedOption&&5!==this.selectedOption&&6!==this.selectedOption)if(e.keyCode!==this.keys.DOWN.keyCode||1!==this.selectedOption&&2!==this.selectedOption&&3!==this.selectedOption)if(e.keyCode!==this.keys.LEFT.keyCode||2!==this.selectedOption&&3!==this.selectedOption&&5!==this.selectedOption&&6!==this.selectedOption)if(e.keyCode!==this.keys.RIGHT.keyCode||1!==this.selectedOption&&2!==this.selectedOption&&4!==this.selectedOption&&5!==this.selectedOption){if(e.keyCode===this.keys.SPACE.keyCode||e.keyCode===this.keys.ENTER.keyCode)return this.scene.audioManager.playSound(R.audio.soundEffects.menuSelect),void this.selectOption()}else this.selectedOption+=1,this.scene.audioManager.playSound(R.audio.soundEffects.menuMove);else this.selectedOption-=1,this.scene.audioManager.playSound(R.audio.soundEffects.menuMove);else this.selectedOption+=3,this.scene.audioManager.playSound(R.audio.soundEffects.menuMove);else this.selectedOption-=3,this.scene.audioManager.playSound(R.audio.soundEffects.menuMove);this.updateSelection()}}])&&Oa(t.prototype,i),a&&Oa(t,a),e}();function Ba(e){return(Ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wa(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ca(e,t){return!t||"object"!==Ba(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function za(e){return(za=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function La(e,t){return(La=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ea=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ca(this,za(t).call(this,{key:A.vocabStudy}))}var i,a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&La(e,t)}(t,e),i=t,(a=[{key:"init",value:function(e){this.stageId=e,this.ui=Sa(this.sys.game.config),this.hudManager=new ai(this),this.hudManager.setSubmitCallback(this.submitAnswer),this.statusManager=new ti(this),this.vocabManager=new xa(this,this.sys.game.db.getStage(e).vocab),this.vocabWordManager=new Ot(this.sys.game.db.getStage(e).vocab),this.ModalChecker=new Ii(this),this.audioManager=new Li(this),this.userOptionsManager=new Gt(this.sys.game),this.menuManager=new Pa(this,{hideLanguage1:function(){this.vocabManager.hideLanguage1()},hideLanguage2:function(){this.vocabManager.hideLanguage2()},showAll:function(){this.vocabManager.showAll()},returnToMap:function(){this.returnToMap()},startTargetPractice:function(){this.createPracticeModal()},startGame:function(){this.startGame()}}),this.inPracticeMode=!1}},{key:"create",value:function(){this.hudManager.createHud(R.ui.hudConfig),this.hudManager.setSubmitCallback(this.submitAnswer),this.vocabManager.createVocab(),this.menuManager.createMenu(),this.createBackground(),this.createStatus(),this.createAudio(),this.checkStartModal(),this.audioManager.playMusic()}},{key:"checkStartModal",value:function(){var e=this;this.ModalChecker.setBeforeStartCallback((function(){e.menuManager.disableInputHandling()})),this.ModalChecker.setCompletedCallback((function(){e.menuManager.enableInputHandling()})),this.ModalChecker.checkModal()}},{key:"createAudio",value:function(){var e=this;this.audioManager.setMusic(R.audio.music.backgroundMusic),Ct(Object.values(R.audio.soundEffects)).forEach((function(t){return e.audioManager.addSound(t)}))}},{key:"createPracticeModal",value:function(){var e=this;this.menuManager.disableInputHandling(),this.practiceModal=new oi(this,R.modals.practice),this.practiceModal.draw(),this.practiceModal.enableInputClose(),this.practiceModal.setCloseCallback((function(){e.practiceModal.disableInputHandling(),e.menuManager.enableInputHandling(),e.audioManager.playSound(R.audio.soundEffects.practiceModalClear),e.startTargetPractice()}))}},{key:"createBackground",value:function(){this.background=this.add.tileSprite(this.ui.grassX,this.ui.grassY,this.ui.grassWidth,this.ui.grassHeight,W.grass),this.background.setOrigin(this.ui.grassOriginX,this.ui.grassOriginY),this.crate=this.add.sprite(this.ui.crateX,this.ui.crateY,W.crate),this.crate.displayWidth=this.ui.crateWidth,this.crate.displayHeight=this.ui.crateHeight,this.crate.setOrigin(this.ui.crateOriginX,this.ui.crateOriginY),this.crate.setScale(W.scales.crate)}},{key:"createStatus",value:function(){this.statusManager.setStatus({message:R.statusMessages.start})}},{key:"startTargetPractice",value:function(){this.inPracticeMode=!0,this.vocabManager.clearAllTint(),this.vocabManager.hideAll(),this.menuManager.disableInputHandling(),this.menuManager.hideMenu(),this.hudManager.showTextInput(),this.hudManager.enableInputHandling(),this.enableInputHandling(),this.showBottle(),this.statusManager.setStatus({message:R.statusMessages.practice}),this.showPracticeWord()}},{key:"startGame",value:function(){var e=this;this.cameras.main.fade(R.screenFadeTime,0,0,0,!1,(function(t,i){e.audioManager.setMusicVolume(1-i),1===i&&(e.audioManager.stopMusic(),e.scene.start(A.minigame,e.stageId))}))}},{key:"endTargetPractice",value:function(){this.inPracticeMode=!1,this.clearPracticeWord(),this.time.removeAllEvents(),this.vocabWordManager.resetContent(),this.vocabManager.showAll(),this.menuManager.enableInputHandling(),this.menuManager.showMenu(),this.hudManager.hideTextInput(),this.hudManager.disableInputHandling(),this.disableInputHandling(),this.hideBottle(),this.audioManager.playSound(R.audio.soundEffects.quitPractice),this.statusManager.setStatus({message:R.statusMessages.start})}},{key:"clearPracticeWord",value:function(){this.practiceWord=null,null!=this.practiceWordText&&(this.practiceWordText.destroy(),this.practiceWordText=null),null!=this.practiceWordBg&&(this.practiceWordBg.destroy(),this.practiceWordBg=null)}},{key:"showPracticeWord",value:function(){this.clearPracticeWord(),this.practiceWord=this.vocabWordManager.getRandomWord(),null!=this.practiceWord?(this.showBottle(),this.practiceWordText=this.add.bitmapText(this.ui.practiceVocabX,this.ui.practiceVocabY,q,this.practiceWord.language1,this.getFontSize()),this.practiceWordText.setOrigin(this.ui.practiceVocabOriginX,this.ui.practiceVocabOriginY),this.practiceWordText.setDepth(r.vocabStudy.word),this.practiceWordText.setTintFill(R.fonts.practiceWordTint),this.practiceWordBg=this.add.graphics(),this.practiceWordBg.fillStyle(R.ui.practiceWordBgColor),this.practiceWordBg.setDepth(r.vocabStudy.wordBackground),this.practiceWordBg.fillRect(this.practiceWordText.x-this.practiceWordText.width/2-R.ui.practiceWordBgPadding,this.practiceWordText.y-R.ui.practiceWordBgPadding,this.practiceWordText.width+2*R.ui.practiceWordBgPadding,this.practiceWordText.height+2*R.ui.practiceWordBgPadding)):this.endTargetPractice()}},{key:"showBottle",value:function(){this.hideBottle(),this.bottle=this.add.sprite(this.ui.bottleX,this.ui.bottleY,W.bottle1),this.bottle.setOrigin(this.ui.bottleOriginX,this.ui.bottleOriginY),this.bottle.setScale(W.scales.bottle1)}},{key:"hideBottle",value:function(){null!=this.bottle&&(this.bottle.destroy(),this.bottle=null),null!=this.explodingBottle&&(this.explodingBottle.destroy(),this.explodingBottle=null)}},{key:"showBottleExplode",value:function(){this.hideBottle(),this.explodingBottle=this.add.sprite(this.ui.bottleX,this.ui.bottleY,W.bottle1Explode),this.explodingBottle.setOrigin(this.ui.bottleOriginX,this.ui.bottleOriginY),this.explodingBottle.setScale(W.scales.bottle1),this.explodingBottle.play(n.bottle1Explode);var e=this.add.sprite(this.explodingBottle.x,this.explodingBottle.y,W.shotBlastBottleExplode);e.setDepth(r.vocabStudy.shotBlastBottleExplode),e.setOrigin(this.ui.shotBlastBottleOriginX,this.ui.shotBlastBottleOriginY),e.on("animationcomplete",(function(e,t,i){return i.destroy()}),this),e.play(n.shotBlastBottleExplode)}},{key:"showMissedShot",value:function(){var e=0,t=0;s.a.Math.RND.pick([!0,!1])?(e=s.a.Math.RND.between(this.ui.missBlastLeftMinX,this.ui.missBlastLeftMaxX),t=s.a.Math.RND.between(this.ui.missBlastLeftMinY,this.ui.missBlastLeftMaxY)):(e=s.a.Math.RND.between(this.ui.missBlastRightMinX,this.ui.missBlastRightMaxX),t=s.a.Math.RND.between(this.ui.missBlastRightMinY,this.ui.missBlastRightMaxY));var i=this.add.sprite(e,t,W.shotBlastDirt);i.setDepth(r.vocabStudy.shotBlast),i.setOrigin(this.ui.missBlastOrigin),i.on("animationcomplete",(function(e,t,i){return i.destroy()}),this),i.play(n.shotBlastDirtExplode),this.add.sprite(e,t,W.dirtPile).setScale(W.scales.dirtPile)}},{key:"returnToMap",value:function(){var e=this;this.cameras.main.fade(R.screenFadeTime,0,0,0,!1,(function(t,i){e.audioManager.setMusicVolume(1-i),1===i&&(e.audioManager.stopMusic(),e.scene.start(A.townMap))}))}},{key:"submitAnswer",value:function(){var e=this;null!=this.practiceWord&&(this.isGuessCorrect()?(this.vocabManager.showEntryCorrect(this.practiceWord),this.statusManager.setStatus({message:R.statusMessages.hit,displayTime:R.practiceWordBuffer}),this.audioManager.playSound(R.audio.soundEffects.guessCorrect),this.showBottleExplode()):(this.vocabManager.showEntryWrong(this.practiceWord),this.statusManager.setStatus({message:R.statusMessages.miss,displayTime:R.practiceWordBuffer}),this.audioManager.playSound(R.audio.soundEffects.guessWrong),this.showMissedShot()),this.hudManager.clearTextEntry(),this.clearPracticeWord(),this.time.addEvent({delay:R.practiceWordBuffer,callback:function(){return e.showPracticeWord()},callbackScope:this}))}},{key:"isGuessCorrect",value:function(){var e=Yt(this.hudManager.getTextEntry()),t=null!=this.practiceWord.alternatives?this.practiceWord.alternatives.map((function(e){return Yt(e)})):null;return e===Yt(this.practiceWord.language2)||null!=t&&t.includes(e)}},{key:"enableInputHandling",value:function(){this.inputHandled||(this.inputHandled=!0,this.createInput())}},{key:"disableInputHandling",value:function(){this.inputHandled&&(this.inputHandled=!1,this.keys=null,this.input.keyboard.off("keydown",this.handleKeyDown))}},{key:"createInput",value:function(){this.keys=this.input.keyboard.addKeys("ESC"),this.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){e.keyCode===this.keys.ESC.keyCode&&this.inPracticeMode&&this.endTargetPractice()}},{key:"getFontSize",value:function(){return this.userOptionsManager.getOptionValue(vt.textSize)===vt.values.normal?R.fonts.practiceWordSize:R.fonts.practiceWordSizeLarge}}])&&Wa(i.prototype,a),o&&Wa(i,o),t}(s.a.Scene),Ra=function(e){var t=Qt(e);return{w:t.w,h:t.h,padding:t.padding,paddingBig:t.paddingBig,textMargin:.07*t.w,cornerSquareWidth:.04*t.w,borderWidth:.015*t.w,choiceTextX:t.w_2,choiceTextOriginX:t.left,choiceTextOriginY:t.center,choiceTextVerticalPadding:.075*t.h,textOriginX:t.center,textOriginY:t.bottom,selectX:t.w_2-t.paddingBig,selectOriginX:t.right,selectOriginY:t.center,selectWidth:t.w_10p,selectHeight:t.w_5p}};function Ya(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Xa=function(){function e(t,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.textContent=i,this.choices=a,this.ui=Ra(this.scene.sys.game.config),this.audioManager=new Li(this.scene),this.selectedIndex=0}var t,i,a;return t=e,(i=[{key:"draw",value:function(){this.createChoices(),this.createText(),this.createFade(),this.createBackground(),this.createBorder(),this.createAudio(),this.createSelector()}},{key:"close",value:function(){null!=this.fade&&(this.fade.destroy(),this.fade=null),null!=this.backgroundGraphics&&(this.backgroundGraphics.destroy(),this.backgroundGraphics=null),null!=this.borderGraphics&&(this.borderGraphics.destroy(),this.borderGraphics=null),null!=this.choiceTexts&&(this.choiceTexts.forEach((function(e){return e.destroy()})),this.choiceTexts=null),null!=this.selector&&(this.selector.destroy(),this.selector=null),null!=this.text&&(this.text.destroy(),this.text=null)}},{key:"enableInputHandling",value:function(){this.inputHandled||(this.inputHandled=!0,this.createInput())}},{key:"disableInputHandling",value:function(){this.inputHandled&&(this.inputHandled=!1,this.keys=null,this.scene.input.keyboard.off("keydown",this.handleKeyDown))}},{key:"setCloseCallback",value:function(e){this.closeCallback=e.bind(this.scene)}},{key:"setCancelCallback",value:function(e){this.cancelCallback=e.bind(this.scene)}},{key:"createAudio",value:function(){var e=this;Ct(Object.values(ie.audio)).forEach((function(t){return e.audioManager.addSound(t)}))}},{key:"createFade",value:function(){this.fade=this.scene.add.graphics(),this.fade.fillStyle(ie.fadeColor,ie.fadeAlpha),this.fade.fillRect(0,0,this.ui.w,this.ui.h),this.fade.setDepth(r.choiceModal.fade)}},{key:"createBackground",value:function(){this.backgroundGraphics=this.scene.add.graphics(),this.backgroundGraphics.fillStyle(ie.backgroundColor);var e=Math.max(this.getMaxTextWidth()+2*this.ui.textMargin,450);this.bgRect=new s.a.Geom.Rectangle(this.ui.w/2-e/2,this.getChoiceTextYBase()-this.getTextHeightOffset()-this.ui.textMargin,e,this.getTextHeightOffset()+this.ui.choiceTextVerticalPadding*(this.choices.length-1)+2*this.ui.textMargin),this.backgroundGraphics.fillRectShape(this.bgRect),this.backgroundGraphics.setDepth(r.choiceModal.bg)}},{key:"createBorder",value:function(){this.borderGraphics=this.scene.add.graphics(),this.borderGraphics.fillStyle(ie.borderColor),this.borderGraphics.setDepth(r.choiceModal.border),this.borderGraphics.fillRect(this.bgRect.x+this.ui.padding,this.bgRect.y+this.ui.padding,this.ui.cornerSquareWidth,this.ui.cornerSquareWidth),this.borderGraphics.fillRect(this.bgRect.x+this.bgRect.width-this.ui.cornerSquareWidth-this.ui.padding,this.bgRect.y+this.ui.padding,this.ui.cornerSquareWidth,this.ui.cornerSquareWidth),this.borderGraphics.fillRect(this.bgRect.x+this.ui.padding,this.bgRect.y+this.bgRect.height-this.ui.cornerSquareWidth-this.ui.padding,this.ui.cornerSquareWidth,this.ui.cornerSquareWidth),this.borderGraphics.fillRect(this.bgRect.x+this.bgRect.width-this.ui.cornerSquareWidth-this.ui.padding,this.bgRect.y+this.bgRect.height-this.ui.cornerSquareWidth-this.ui.padding,this.ui.cornerSquareWidth,this.ui.cornerSquareWidth),this.borderGraphics.fillRect(this.bgRect.x+this.ui.cornerSquareWidth+2*this.ui.padding,this.bgRect.y+this.ui.padding+this.ui.cornerSquareWidth/2-this.ui.borderWidth/2,this.bgRect.width-2*this.ui.cornerSquareWidth-4*this.ui.padding,this.ui.borderWidth),this.borderGraphics.fillRect(this.bgRect.x+this.ui.cornerSquareWidth+2*this.ui.padding,this.bgRect.y+this.bgRect.height-this.ui.padding-this.ui.cornerSquareWidth/2-this.ui.borderWidth/2,this.bgRect.width-2*this.ui.cornerSquareWidth-4*this.ui.padding,this.ui.borderWidth),this.borderGraphics.fillRect(this.bgRect.x+this.ui.padding+this.ui.cornerSquareWidth/2-this.ui.borderWidth/2,this.bgRect.y+this.ui.cornerSquareWidth+2*this.ui.padding,this.ui.borderWidth,this.bgRect.height-2*this.ui.cornerSquareWidth-4*this.ui.padding),this.borderGraphics.fillRect(this.bgRect.x+this.bgRect.width-this.ui.padding-this.ui.cornerSquareWidth/2-this.ui.borderWidth/2,this.bgRect.y+this.ui.cornerSquareWidth+2*this.ui.padding,this.ui.borderWidth,this.bgRect.height-2*this.ui.cornerSquareWidth-4*this.ui.padding)}},{key:"createText",value:function(){var e=this.getChoiceTextYBase()-this.ui.textMargin;this.text=this.scene.add.bitmapText(this.ui.w/2,e,q,this.textContent,ie.textFontSize),this.text.setOrigin(this.ui.textOriginX,this.ui.textOriginY),this.text.setCenterAlign(),this.text.setDepth(r.choiceModal.text),this.text.setTintFill(ie.textTint)}},{key:"createChoices",value:function(){var e=this;this.choiceTexts=[],this.choices.forEach((function(t,i){var a=e.ui.choiceTextVerticalPadding*i,s=e.scene.add.bitmapText(e.ui.choiceTextX,e.getChoiceTextYBase()+a,q,t,ie.choiceFontSize);s.setOrigin(e.ui.choiceTextOriginX,e.ui.choiceTextOriginY),s.setDepth(r.choiceModal.text),s.setTintFill(ie.choiceColor),e.choiceTexts.push(s)}))}},{key:"createSelector",value:function(){this.selector=this.scene.add.sprite(this.ui.selectX,this.getChoiceTextYBase()+this.ui.choiceTextVerticalPadding*this.selectedIndex,W.shotgun,W.frames.shotgunNormal),this.selector.displayWidth=this.ui.selectWidth,this.selector.displayHeight=this.ui.selectHeight,this.selector.setDepth(r.choiceModal.selector),this.selector.flipX=!0,this.selector.setOrigin(this.ui.selectOriginX,this.ui.selectOriginY)}},{key:"updateSelector",value:function(){this.selector.y=this.getChoiceTextYBase()+this.ui.choiceTextVerticalPadding*this.selectedIndex}},{key:"getMaxTextWidth",value:function(){var e=0;return this.choiceTexts.forEach((function(t){e=Math.max(e,2*t.getTextBounds().global.width)})),null!=this.text&&(e=Math.max(e,this.text.getTextBounds().global.width)),e}},{key:"getTextHeightOffset",value:function(){var e=0;return null!=this.text&&(e=this.text.getTextBounds().global.height+this.ui.textMargin),e}},{key:"getChoiceTextYBase",value:function(){return this.ui.h/2-this.ui.choiceTextVerticalPadding*(this.choices.length-1)/2}},{key:"optionSelected",value:function(){this.audioManager.playSound(ie.audio.menuSelect),this.close(),this.closeCallback(this.selectedIndex)}},{key:"createInput",value:function(){this.keys=this.scene.input.keyboard.addKeys("SPACE,ENTER,UP,DOWN,ESC"),this.scene.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){e.keyCode===this.keys.UP.keyCode?this.decrementSelection():e.keyCode===this.keys.DOWN.keyCode?this.incrementSelection():e.keyCode===this.keys.SPACE.keyCode||e.keyCode===this.keys.ENTER.keyCode?this.optionSelected():e.keyCode===this.keys.ESC.keyCode&&this.cancelCallback()}},{key:"decrementSelection",value:function(){this.audioManager.playSound(ie.audio.menuMove),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.updateSelector()}},{key:"incrementSelection",value:function(){this.audioManager.playSound(ie.audio.menuMove),this.selectedIndex=Math.min(this.selectedIndex+1,this.choices.length-1),this.updateSelector()}}])&&Ya(t.prototype,i),a&&Ya(t,a),e}();function Ha(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ga=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,a;return t=e,(i=[{key:"drawSquares",value:function(e,t,i){i.forEach((function(i){e.fillRect(i[0],i[1],t,t)}))}}])&&Ha(t.prototype,i),a&&Ha(t,a),e}();function Fa(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Aa=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.mapHelper=new Ga,this.progressManager=new ui(this.scene.sys.game.db),this.selectedCell={x:0,y:0},this.inputHandled=!1,this.enabled=!1,this.requirementGraphics=this.scene.add.graphics(),this.requirementGraphics.setDepth(r.townMap.requirementLine),this.requirementGraphics.lineStyle(this.scene.ui.requirementLineWidth,ae.ui.requirementLineColor)}var t,i,a;return t=e,(i=[{key:"initialize",value:function(){this.enabled=!1,this.selectedCell={x:0,y:0},this.inputHandled=!1,this.drawBorder(!1),this.createLocation(),this.createMapGrid(),this.createLessonPins(),this.createLessonSelector(),this.drawRequirementLines(),this.clearTitle(),this.clearFlashTimer()}},{key:"enable",value:function(){this.enabled=!0,this.flashBorder(),this.createTitle(),this.enableInputHandling()}},{key:"disable",value:function(){this.enabled=!1,this.clearFlashTimer(),this.drawBorder(!1),this.clearTitle(),this.clearFlashLines(),this.disableInputHandling()}},{key:"enableInputHandling",value:function(){this.inputHandled||(this.inputHandled=!0,this.createInput())}},{key:"disableInputHandling",value:function(){this.inputHandled&&(this.inputHandled=!1,this.keys=null,this.scene.input.keyboard.off("keydown",this.handleKeyDown))}},{key:"setLessonChangedCallback",value:function(e){this.lessonChangedCallback=e.bind(this.scene)}},{key:"setLessonSelectedCallback",value:function(e){this.lessonSelectedCallback=e.bind(this.scene)}},{key:"setCancelCallback",value:function(e){this.cancelCallback=e.bind(this.scene)}},{key:"getLesson",value:function(){var e=this,t=Je.find((function(t){return t.position.x===e.selectedCell.x&&t.position.y===e.selectedCell.y}));return null!=t?t:null}},{key:"getLessonId",value:function(){var e=this.getLesson();return null!=e?e.id:null}},{key:"getLessonLocation",value:function(){var e=this.getLesson();if(null!=e){var t=this.progressManager.isLessonCompleted(e.id),i=this.progressManager.isLessonLocked(e.id),a=e.location;return t?a+=" - ".concat(ae.clearedText):i&&(a+=" - ".concat(ae.lockedText)),a}return null}},{key:"setLesson",value:function(e){var t=this;Je.some((function(i){return i.id===e&&(t.selectedCell.x=i.position.x,t.selectedCell.y=i.position.y,t.updateLessonSelector(),!0)}))}},{key:"resetLesson",value:function(){this.selectedCell.x=0,this.selectedCell.y=0,this.updateLessonSelector()}},{key:"flashBorder",value:function(){var e=this;this.clearFlashTimer(),this.drawBorder(!0),this.selectorFlashOn=!0,this.flashTimer=this.scene.time.addEvent({delay:ae.selectorFlashDelay,callback:function(){e.selectorFlashOn=!e.selectorFlashOn,e.selectorFlashOn?e.drawFlashLines():e.clearFlashLines()},callbackScope:this,repeat:-1})}},{key:"drawBorder",value:function(e){this.clearBorder(),this.borderGraphics=this.scene.add.graphics(),this.borderGraphics.setDepth(r.townMap.border);var t=e?ae.ui.borderColor:ae.ui.borderDisableColor;this.borderGraphics.lineStyle(this.scene.ui.borderWidth,t),this.borderGraphics.fillStyle(t),this.borderGraphics.strokeRect(this.scene.ui.mapX,this.scene.ui.mapY,this.scene.ui.mapWidth,this.scene.ui.mapHeight),this.mapHelper.drawSquares(this.borderGraphics,this.scene.ui.squareWidth,[[this.scene.ui.mapSquareTLX,this.scene.ui.mapSquareTLY],[this.scene.ui.mapSquareTRX,this.scene.ui.mapSquareTRY],[this.scene.ui.mapSquareBLX,this.scene.ui.mapSquareBLY],[this.scene.ui.mapSquareBRX,this.scene.ui.mapSquareBRY]])}},{key:"drawFlashLines",value:function(){this.clearFlashLines(),this.lineGraphics=this.scene.add.graphics(),this.lineGraphics.setDepth(r.townMap.border);var e=ae.ui.borderColor;this.lineGraphics.lineStyle(this.scene.ui.flashLineWidth,e),this.lineGraphics.fillStyle(e),this.lineGraphics.beginPath(),this.lineGraphics.moveTo(this.scene.ui.mapFlashLineLTX,this.scene.ui.mapFlashLineLTY),this.lineGraphics.lineTo(this.scene.ui.mapFlashLineLBX,this.scene.ui.mapFlashLineLBY),this.lineGraphics.moveTo(this.scene.ui.mapFlashLineRTX,this.scene.ui.mapFlashLineRTY),this.lineGraphics.lineTo(this.scene.ui.mapFlashLineRBX,this.scene.ui.mapFlashLineRBY),this.lineGraphics.moveTo(this.scene.ui.mapFlashLineTLX,this.scene.ui.mapFlashLineTLY),this.lineGraphics.lineTo(this.scene.ui.mapFlashLineTRX,this.scene.ui.mapFlashLineTRY),this.lineGraphics.moveTo(this.scene.ui.mapFlashLineBLX,this.scene.ui.mapFlashLineBLY),this.lineGraphics.lineTo(this.scene.ui.mapFlashLineBRX,this.scene.ui.mapFlashLineBRY),this.lineGraphics.closePath(),this.lineGraphics.strokePath()}},{key:"clearFlashLines",value:function(){null!=this.lineGraphics&&(this.lineGraphics.clear(),this.lineGraphics=null)}},{key:"createTitle",value:function(){this.clearTitle(),this.mapTitle=this.scene.add.bitmapText(this.scene.ui.mapTitleX,this.scene.ui.mapTitleY,q,ae.mapTitleText,ae.fonts.mapTitleSize),this.mapTitle.setOrigin(this.scene.ui.mapTitleOriginX,this.scene.ui.mapTitleOriginY),this.mapTitle.setTintFill(ae.fonts.mapTitleTint)}},{key:"clearTitle",value:function(){null!=this.mapTitle&&(this.mapTitle.destroy(),this.mapTitle=null)}},{key:"clearFlashTimer",value:function(){this.selectorFlashOn=!1,null!=this.flashTimer&&(this.flashTimer.destroy(),this.flashTimer=null)}},{key:"clearBorder",value:function(){null!=this.borderGraphics&&(this.borderGraphics.destroy(),this.borderGraphics=null)}},{key:"createLocation",value:function(){this.clearLocation();var e=this.getLessonLocation();null!=e&&this.isLessonVisible(this.getLesson().id)&&(this.mapLocation=this.scene.add.bitmapText(this.scene.ui.mapLocationX,this.scene.ui.mapLocationY,q,e,ae.fonts.mapLocationSize),this.mapLocation.setOrigin(this.scene.ui.mapLocationOriginX,this.scene.ui.mapLocationOriginY),this.mapLocation.setTintFill(ae.fonts.mapLocationTint))}},{key:"clearLocation",value:function(){null!=this.mapLocation&&(this.mapLocation.destroy(),this.mapLocation=null)}},{key:"createMapGrid",value:function(){this.clearMapGrid(),this.gridGraphics=this.scene.add.graphics(),this.gridGraphics.lineStyle(this.scene.ui.mapGridLineWidth,ae.ui.mapGridColor),this.gridGraphics.setDepth(r.townMap.mapGrid),this.cellWidth=(this.scene.ui.mapGridWidth-2*this.scene.ui.squareWidth-2*this.scene.ui.padding)/9,this.cellHeight=(this.scene.ui.mapGridHeight-2*this.scene.ui.squareWidth-2*this.scene.ui.padding)/5,this.baseX=this.scene.ui.mapGridX+this.scene.ui.squareWidth+this.scene.ui.padding,this.baseY=this.scene.ui.mapGridY+this.scene.ui.squareWidth+this.scene.ui.padding;for(var e=0;e<9;e+=1)for(var t=0;t<5;t+=1)this.gridGraphics.strokeRect(this.baseX+this.cellWidth*e,this.baseY+this.cellHeight*t,this.cellWidth,this.cellHeight)}},{key:"clearMapGrid",value:function(){null!=this.gridGraphics&&(this.gridGraphics.clear(),this.gridGraphics=null)}},{key:"createLessonPins",value:function(){var e=this;this.clearLessonPins(),this.pins=[],Je.forEach((function(t){var i=e.baseX+t.position.x*e.cellWidth+e.cellWidth/2,a=e.baseY+t.position.y*e.cellHeight+e.cellHeight/2,s=e.progressManager.isLessonCompleted(t.id),n=e.progressManager.isLessonLocked(t.id),o=e.isLessonVisible(t.id),l=W.frames.colorSquareYellow;if(s?l=W.frames.colorSquareGreen:n&&(l=W.frames.colorSquareRed),o){var h=e.scene.add.sprite(i,a,W.colorSquare,l);h.setOrigin(e.scene.ui.mapPinOrigin),h.setDepth(r.townMap.lessonPin),h.displayWidth=e.cellWidth*ae.ui.mapPinCellRatio,h.displayHeight=e.cellHeight*ae.ui.mapPinCellRatio,e.pins.push(h)}}))}},{key:"clearLessonPins",value:function(){null!=this.pins&&(this.pins.forEach((function(e){return e.destroy()})),this.pins=null)}},{key:"createLessonSelector",value:function(){this.lessonSelector=this.scene.add.sprite(this.getSelectorXPosition(),this.getSelectorYPosition(),W.hudItemBorder),this.lessonSelector.displayWidth=this.cellWidth-2*this.scene.ui.padding,this.lessonSelector.displayHeight=this.cellHeight-2*this.scene.ui.padding,this.lessonSelector.setOrigin(this.scene.ui.mapSelectorOrigin)}},{key:"clearLessonSelector",value:function(){null!=this.lessonSelector&&(this.lessonSelector.destroy(),this.lessonSelector=null)}},{key:"createInput",value:function(){this.keys=this.scene.input.keyboard.addKeys("SPACE,ENTER,LEFT,RIGHT,UP,DOWN,ESC"),this.scene.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){if(e.keyCode===this.keys.LEFT.keyCode)this.moveSelectedCellLeft();else if(e.keyCode===this.keys.RIGHT.keyCode)this.moveSelectedCellRight();else if(e.keyCode===this.keys.UP.keyCode)this.moveSelectedCellUp();else if(e.keyCode===this.keys.DOWN.keyCode)this.moveSelectedCellDown();else if(e.keyCode===this.keys.SPACE.keyCode||e.keyCode===this.keys.ENTER.keyCode){var t=this.getLessonId();null!=t&&this.lessonSelectedCallback(t)}else e.keyCode===this.keys.ESC.keyCode&&this.cancelCallback()}},{key:"moveSelectedCellUp",value:function(){this.selectedCell.y=Math.max(this.selectedCell.y-1,0),this.scene.audioManager.playSound(ae.audio.soundEffects.mapGridMove),this.updateLessonSelector()}},{key:"moveSelectedCellDown",value:function(){this.selectedCell.y=Math.min(this.selectedCell.y+1,4),this.scene.audioManager.playSound(ae.audio.soundEffects.mapGridMove),this.updateLessonSelector()}},{key:"moveSelectedCellLeft",value:function(){this.selectedCell.x=Math.max(this.selectedCell.x-1,0),this.scene.audioManager.playSound(ae.audio.soundEffects.mapGridMove),this.updateLessonSelector()}},{key:"moveSelectedCellRight",value:function(){this.selectedCell.x=Math.min(this.selectedCell.x+1,8),this.scene.audioManager.playSound(ae.audio.soundEffects.mapGridMove),this.updateLessonSelector()}},{key:"updateLessonSelector",value:function(){this.lessonSelector.x=this.getSelectorXPosition(),this.lessonSelector.y=this.getSelectorYPosition(),this.createLocation(),this.lessonChangedCallback(this.getLessonId())}},{key:"getSelectorXPosition",value:function(){return this.baseX+this.selectedCell.x*this.cellWidth+this.cellWidth/2}},{key:"getSelectorYPosition",value:function(){return this.baseY+this.selectedCell.y*this.cellHeight+this.cellHeight/2}},{key:"drawRequirementLines",value:function(){var e=this;Je.forEach((function(t){var i=e.scene.sys.game.db.getLesson(t.id);e.isLessonVisible(i.id)&&null!=i.requirements&&i.requirements.forEach((function(i){var a=Je.find((function(e){return e.id===i})),s=e.baseX+t.position.x*e.cellWidth+e.cellWidth/2,n=e.baseY+t.position.y*e.cellHeight+e.cellHeight/2,o=e.baseX+a.position.x*e.cellWidth+e.cellWidth/2,r=e.baseY+a.position.y*e.cellHeight+e.cellHeight/2;e.requirementGraphics.beginPath(),e.requirementGraphics.moveTo(s,n),e.requirementGraphics.lineTo(o,r),e.requirementGraphics.closePath(),e.requirementGraphics.strokePath()}))}))}},{key:"isLessonVisible",value:function(e){if(ae.showAllLessons)return!0;if(null==e)return!1;var t=this.progressManager.isLessonCompleted(e),i=this.progressManager.isLessonLocked(e),a=this.progressManager.isLessonUpcoming(e);return t||!i||a}}])&&Fa(t.prototype,i),a&&Fa(t,a),e}();function Da(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var qa=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.mapHelper=new Ga,this.borderGraphics=this.scene.add.graphics(),this.borderGraphics.setDepth(r.townMap.border),this.lessonId=null}var t,i,a;return t=e,(i=[{key:"initialize",value:function(){this.lessonId=null,this.drawBorder(!1),this.clearLessonInfo()}},{key:"setLesson",value:function(e){this.lessonId=e,this.createLessonInfo()}},{key:"clear",value:function(){this.lessonId=null,this.clearLessonInfo()}},{key:"drawBorder",value:function(){this.borderGraphics.clear();var e=ae.ui.borderColor;this.borderGraphics.lineStyle(this.scene.ui.borderWidth,e),this.borderGraphics.fillStyle(e),this.borderGraphics.strokeRect(this.scene.ui.lessonInfoX,this.scene.ui.lessonInfoY,this.scene.ui.lessonInfoWidth,this.scene.ui.lessonInfoHeight),this.mapHelper.drawSquares(this.borderGraphics,this.scene.ui.squareWidth,[[this.scene.ui.lessonInfoSquareTLX,this.scene.ui.lessonInfoSquareTLY],[this.scene.ui.lessonInfoSquareTRX,this.scene.ui.lessonInfoSquareTRY],[this.scene.ui.lessonInfoSquareBLX,this.scene.ui.lessonInfoSquareBLY],[this.scene.ui.lessonInfoSquareBRX,this.scene.ui.lessonInfoSquareBRY]])}},{key:"createLessonInfo",value:function(){if(this.clearLessonInfo(),null!=this.lessonId){var e=this.scene.sys.game.db.getLesson(this.lessonId);this.lessonInfoTitle=this.scene.add.bitmapText(this.scene.ui.lessonInfoTitleX,this.scene.ui.lessonInfoTitleY,q,e.name,ae.fonts.lessonInfoTitleSize),this.lessonInfoTitle.setOrigin(this.scene.ui.lessonInfoTitleOriginX,this.scene.ui.lessonInfoTitleOriginY),this.lessonInfoTitle.setTintFill(ae.fonts.lessonInfoTitleTint),this.lessonInfoTitle.setCenterAlign(),this.lessonInfoText=this.scene.add.bitmapText(this.scene.ui.lessonInfoTextX,this.scene.ui.lessonInfoTextY,q,e.info,ae.fonts.lessonInfoTextSize),this.lessonInfoText.setOrigin(this.scene.ui.lessonInfoTextOriginX,this.scene.ui.lessonInfoTextOriginY),this.lessonInfoText.setTintFill(ae.fonts.lessonInfoTextTint)}}},{key:"clearLessonInfo",value:function(){null!=this.lessonInfoTitle&&(this.lessonInfoTitle.destroy(),this.lessonInfoTitle=null),null!=this.lessonInfoText&&(this.lessonInfoText.destroy(),this.lessonInfoText=null)}}])&&Da(t.prototype,i),a&&Da(t,a),e}();function _a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Va=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.mapHelper=new Ga,this.progressManager=new ui(this.scene.sys.game.db),this.selectedStageIndex=0,this.inputHandled=!1,this.enabled=!1,this.lesson=null,this.selectorFlashOn=!1}var t,i,a;return t=e,(i=[{key:"initialize",value:function(){this.enabled=!1,this.lesson=null,this.selectedStageIndex=0,this.drawBorder(!1),this.clear()}},{key:"enable",value:function(){this.enabled=!0,this.flashBorder(),this.createTitle(),this.createStageSelector(),this.enableInputHandling()}},{key:"disable",value:function(){this.enabled=!1,this.clearFlashTimer(),this.clearTitle(),this.clearStageSelector(),this.drawBorder(!1),this.clearFlashLines(),this.disableInputHandling()}},{key:"setLesson",value:function(e){this.lesson=this.scene.sys.game.db.getLesson(e),this.selectedStageIndex=0,this.createStageIcons()}},{key:"setStage",value:function(e){if(null!=e&&(this.selectedStageIndex=0,null!=this.lesson))for(var t=0;t<this.lesson.stages.length;t+=1)if(this.lesson.stages[t]===e){this.selectedStageIndex=t,this.enabled&&this.updateStageSelector();break}}},{key:"resetStage",value:function(){this.selectedStageIndex=0,this.enabled&&this.updateStageSelector()}},{key:"clear",value:function(){this.clearTitle(),this.clearStageIcons(),this.clearStageSelector(),this.clearFlashTimer()}},{key:"enableInputHandling",value:function(){this.inputHandled||(this.inputHandled=!0,this.createInput())}},{key:"disableInputHandling",value:function(){this.inputHandled&&(this.inputHandled=!1,this.keys=null,this.scene.input.keyboard.off("keydown",this.handleKeyDown))}},{key:"setStageChangedCallback",value:function(e){this.stageChangedCallback=e.bind(this.scene)}},{key:"setStageSelectedCallback",value:function(e){this.stageSelectedCallback=e.bind(this.scene)}},{key:"setCancelCallback",value:function(e){this.cancelCallback=e.bind(this.scene)}},{key:"getStageId",value:function(){return null!=this.lesson?this.lesson.stages[this.selectedStageIndex]:null}},{key:"getStageNumber",value:function(){return this.selectedStageIndex+1}},{key:"flashBorder",value:function(){var e=this;this.clearFlashTimer(),this.drawBorder(!0),this.selectorFlashOn=!0,this.flashTimer=this.scene.time.addEvent({delay:ae.selectorFlashDelay,callback:function(){e.selectorFlashOn=!e.selectorFlashOn,e.selectorFlashOn?e.drawFlashLines():e.clearFlashLines()},callbackScope:this,repeat:-1})}},{key:"drawBorder",value:function(e){this.clearBorder();var t=e?ae.ui.borderColor:ae.ui.borderDisableColor;this.borderGraphics=this.scene.add.graphics(),this.borderGraphics.setDepth(r.townMap.border),this.borderGraphics.lineStyle(this.scene.ui.borderWidth,t),this.borderGraphics.fillStyle(t),this.borderGraphics.strokeRect(this.scene.ui.stageX,this.scene.ui.stageY,this.scene.ui.stageWidth,this.scene.ui.stageHeight),this.mapHelper.drawSquares(this.borderGraphics,this.scene.ui.squareWidth,[[this.scene.ui.stageSquareTLX,this.scene.ui.stageSquareTLY],[this.scene.ui.stageSquareTRX,this.scene.ui.stageSquareTRY],[this.scene.ui.stageSquareBLX,this.scene.ui.stageSquareBLY],[this.scene.ui.stageSquareBRX,this.scene.ui.stageSquareBRY]])}},{key:"drawFlashLines",value:function(){this.clearFlashLines(),this.lineGraphics=this.scene.add.graphics(),this.lineGraphics.setDepth(r.townMap.border);var e=ae.ui.borderColor;this.lineGraphics.lineStyle(this.scene.ui.flashLineWidth,e),this.lineGraphics.fillStyle(e),this.lineGraphics.beginPath(),this.lineGraphics.moveTo(this.scene.ui.stageFlashLineLTX,this.scene.ui.stageFlashLineLTY),this.lineGraphics.lineTo(this.scene.ui.stageFlashLineLBX,this.scene.ui.stageFlashLineLBY),this.lineGraphics.moveTo(this.scene.ui.stageFlashLineRTX,this.scene.ui.stageFlashLineRTY),this.lineGraphics.lineTo(this.scene.ui.stageFlashLineRBX,this.scene.ui.stageFlashLineRBY),this.lineGraphics.moveTo(this.scene.ui.stageFlashLineTLX,this.scene.ui.stageFlashLineTLY),this.lineGraphics.lineTo(this.scene.ui.stageFlashLineTRX,this.scene.ui.stageFlashLineTRY),this.lineGraphics.moveTo(this.scene.ui.stageFlashLineBLX,this.scene.ui.stageFlashLineBLY),this.lineGraphics.lineTo(this.scene.ui.stageFlashLineBRX,this.scene.ui.stageFlashLineBRY),this.lineGraphics.closePath(),this.lineGraphics.strokePath()}},{key:"clearFlashLines",value:function(){null!=this.lineGraphics&&(this.lineGraphics.clear(),this.lineGraphics=null)}},{key:"createTitle",value:function(){this.clearTitle(),this.stageTitle=this.scene.add.bitmapText(this.scene.ui.stageTitleX,this.scene.ui.stageTitleY,q,ae.stageTitleText,ae.fonts.stageTitleSize),this.stageTitle.setOrigin(this.scene.ui.stageTitleOriginX,this.scene.ui.stageTitleOriginY),this.stageTitle.setTintFill(ae.fonts.stageTitleTint),this.stageTitle.setCenterAlign()}},{key:"clearTitle",value:function(){null!=this.stageTitle&&(this.stageTitle.destroy(),this.stageTitle=null)}},{key:"createStageIcons",value:function(){var e=this;this.clearStageIcons(),null!=this.lesson&&(this.stageIcons=[],this.lesson.stages.forEach((function(t,i){var a=e.scene.add.sprite(e.getStageXPosition(i),e.scene.ui.stageDotY,W.yellowBubble);e.progressManager.isStageCompleted(t)?a.setFrame(W.frames.yellowBubbleFull):a.setFrame(W.frames.yellowBubbleEmpty),a.setOrigin(e.scene.ui.stageDotOriginX,e.scene.ui.stageDotOriginY),e.stageIcons.push(a);var s=e.scene.game.db.getStage(t).type;s===se.zombieAssault?(a.displayWidth=e.scene.ui.stageDotWidth,a.displayHeight=e.scene.ui.stageDotWidth):s===se.zombieAssaultReview&&(a.displayWidth=e.scene.ui.stageReviewDotWidth,a.displayHeight=e.scene.ui.stageReviewDotWidth)})))}},{key:"clearStageIcons",value:function(){null!=this.stageIcons&&(this.stageIcons.forEach((function(e){return e.destroy()})),this.stageIcons=null)}},{key:"createStageSelector",value:function(){this.clearStageSelector(),this.stageSelector=this.scene.add.sprite(this.getStageXPosition(this.selectedStageIndex)-this.scene.ui.stageSelectorXBuffer,this.scene.ui.stageDotY,W.hudItemBorder),this.stageSelector.setOrigin(this.scene.ui.stageDotOriginX,this.scene.ui.stageDotOriginY),this.setSelectorSize()}},{key:"clearStageSelector",value:function(){null!=this.stageSelector&&(this.stageSelector.destroy(),this.stageSelector=null)}},{key:"clearFlashTimer",value:function(){this.selectorFlashOn=!1,null!=this.flashTimer&&(this.flashTimer.destroy(),this.flashTimer=null)}},{key:"clearBorder",value:function(){null!=this.borderGraphics&&(this.borderGraphics.destroy(),this.borderGraphics=null)}},{key:"updateStageSelector",value:function(){this.stageSelector.x=this.getStageXPosition(this.selectedStageIndex)-this.scene.ui.stageSelectorXBuffer,this.setSelectorSize(),this.stageChangedCallback(this.getStageId(),this.getStageNumber())}},{key:"setSelectorSize",value:function(){this.getStageType()===se.zombieAssaultReview?(this.stageSelector.displayWidth=this.scene.ui.stageSelectorReviewWidth,this.stageSelector.displayHeight=this.scene.ui.stageSelectorReviewWidth):(this.stageSelector.displayWidth=this.scene.ui.stageSelectorWidth,this.stageSelector.displayHeight=this.scene.ui.stageSelectorWidth)}},{key:"getStageXPosition",value:function(e){var t=this.lesson.stages.length*this.scene.ui.stageDotSpaceWidth;return this.scene.ui.stageX+this.scene.ui.stageWidth/2-t/2+t*(e/this.lesson.stages.length)}},{key:"getStageType",value:function(){return this.scene.game.db.getStage(this.getStageId()).type}},{key:"createInput",value:function(){this.keys=this.scene.input.keyboard.addKeys("SPACE,ENTER,LEFT,RIGHT,ESC"),this.scene.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){e.keyCode===this.keys.LEFT.keyCode?this.decrementSelectedStage():e.keyCode===this.keys.RIGHT.keyCode?this.incrementSelectedStage():e.keyCode===this.keys.SPACE.keyCode||e.keyCode===this.keys.ENTER.keyCode?this.stageSelectedCallback(this.getStageId()):e.keyCode===this.keys.ESC.keyCode&&this.cancelCallback()}},{key:"decrementSelectedStage",value:function(){this.scene.audioManager.playSound(ae.audio.soundEffects.stageMove),this.selectedStageIndex=Math.max(this.selectedStageIndex-1,0),this.updateStageSelector()}},{key:"incrementSelectedStage",value:function(){this.scene.audioManager.playSound(ae.audio.soundEffects.stageMove),this.selectedStageIndex=Math.min(this.selectedStageIndex+1,this.lesson.stages.length-1),this.updateStageSelector()}}])&&_a(t.prototype,i),a&&_a(t,a),e}();function ja(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Na=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.mapHelper=new Ga,this.progressManager=new ui(this.scene.sys.game.db),this.borderGraphics=this.scene.add.graphics(),this.borderGraphics.setDepth(r.townMap.border),this.stageId=null,this.stageNumber=null,this.currentStageType=null,this.currentStageCleared=null}var t,i,a;return t=e,(i=[{key:"initialize",value:function(){this.enabled=!1,this.stageId=null,this.stageNumber=null,this.currentStageType=null,this.drawBorder(!1),this.clearStageInfo()}},{key:"enable",value:function(){this.enabled=!0,this.drawBorder(!0),this.createStageInfo()}},{key:"disable",value:function(){this.enabled=!1,this.currentStageType=null,this.drawBorder(!1),this.clearStageInfo()}},{key:"setStage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.stageId=e,this.stageNumber=t,this.createStageInfo()}},{key:"drawBorder",value:function(e){var t=e?ae.ui.borderColor:ae.ui.borderDisableColor;this.borderGraphics.lineStyle(this.scene.ui.borderWidth,t),this.borderGraphics.fillStyle(t),this.borderGraphics.strokeRect(this.scene.ui.stageInfoX,this.scene.ui.stageInfoY,this.scene.ui.stageInfoWidth,this.scene.ui.stageInfoHeight),this.mapHelper.drawSquares(this.borderGraphics,this.scene.ui.squareWidth,[[this.scene.ui.stageInfoSquareTLX,this.scene.ui.stageInfoSquareTLY],[this.scene.ui.stageInfoSquareTRX,this.scene.ui.stageInfoSquareTRY],[this.scene.ui.stageInfoSquareBLX,this.scene.ui.stageInfoSquareBLY],[this.scene.ui.stageInfoSquareBRX,this.scene.ui.stageInfoSquareBRY]])}},{key:"createStageInfo",value:function(){if(null!=this.stageId){var e=this.scene.sys.game.db.getStage(this.stageId),t=this.progressManager.isStageCompleted(this.stageId),i=this.shouldMaintainAnimations(t);switch(this.currentStageType=e.type,this.currentStageCleared=t,this.clearStageInfo(i),e.type){case se.zombieAssault:this.createZombieAssaultStageInfo(i,t);break;case se.zombieAssaultReview:this.createZombieAssaultReviewStageInfo(i,t);break;default:throw Error("Invalid stage type '".concat(e.type,"'"))}}else this.clearStageInfo(!1)}},{key:"createCommonStageInfo",value:function(e,t){this.stageInfoType=this.scene.add.bitmapText(this.scene.ui.stageInfoTypeX,this.scene.ui.stageInfoTypeY,q,zt(e),ae.fonts.stageInfoTypeSize),this.stageInfoType.setOrigin(this.scene.ui.stageInfoTypeOriginX,this.scene.ui.stageInfoTypeOriginY),this.stageInfoType.setTintFill(ae.fonts.stageInfoTypeColor),this.stageInfoType.setCenterAlign(),this.stageInfoType.setTintFill(ae.fonts.stageInfoTypeColor);var i=t?ae.clearedText:Lt(e);this.stageInfoSubtitle=this.scene.add.bitmapText(this.scene.ui.stageInfoSubtitleX,this.scene.ui.stageInfoSubtitleY,q,i,ae.fonts.stageInfoSubtitleSize),this.stageInfoSubtitle.setOrigin(this.scene.ui.stageInfoSubtitleOriginX,this.scene.ui.stageInfoSubtitleOriginY),this.stageInfoSubtitle.setTintFill(ae.fonts.stageInfoSubtitleTint),this.stageInfoSubtitle.setCenterAlign()}},{key:"createZombieAssaultStageInfo",value:function(e,t){this.createCommonStageInfo(se.zombieAssault,t),this.stageInfoTitle=this.scene.add.bitmapText(this.scene.ui.stageInfoTitleX,this.scene.ui.stageInfoTitleY,q,"Stage ".concat(this.stageNumber.toString().padStart(2,"0")),ae.fonts.stageInfoTitleSize),this.stageInfoTitle.setOrigin(this.scene.ui.stageInfoTitleOriginX,this.scene.ui.stageInfoTitleOriginY),this.stageInfoTitle.setTintFill(ae.fonts.stageInfoTitleTint),this.stageInfoTitle.setCenterAlign(),e||(this.stageInfoSprites=[],this.stageInfoZombie1=this.scene.add.sprite(this.scene.ui.stageInfoZombie1X,this.scene.ui.stageInfoZombie1Y,W.zombieNormal1),this.stageInfoZombie1.setScale(2.5),this.stageInfoSprites.push(this.stageInfoZombie1),this.stageInfoZombie2=this.scene.add.sprite(this.scene.ui.stageInfoZombie2X,this.scene.ui.stageInfoZombie2Y,W.zombieNormal3),this.stageInfoZombie2.setScale(2.5),this.stageInfoSprites.push(this.stageInfoZombie2),this.stageInfoZombie3=this.scene.add.sprite(this.scene.ui.stageInfoZombie3X,this.scene.ui.stageInfoZombie3Y,W.zombieNormal5),this.stageInfoZombie3.setScale(2.5),this.stageInfoSprites.push(this.stageInfoZombie3),t?(this.stageInfoZombie1.setFrame(W.frames.zombieDead),this.stageInfoZombie2.setFrame(W.frames.zombieDead),this.stageInfoZombie3.setFrame(W.frames.zombieDead)):(this.stageInfoZombie1.play(Mt(W.zombieNormal1,n.zombieWalk)),this.stageInfoZombie1.anims.msPerFrame=200,this.stageInfoZombie2.play(Mt(W.zombieNormal3,n.zombieWalk)),this.stageInfoZombie2.anims.msPerFrame=225,this.stageInfoZombie3.play(Mt(W.zombieNormal5,n.zombieWalk)),this.stageInfoZombie3.anims.msPerFrame=175))}},{key:"createZombieAssaultReviewStageInfo",value:function(e,t){this.createCommonStageInfo(se.zombieAssaultReview,t),this.stageInfoTitle=this.scene.add.bitmapText(this.scene.ui.stageInfoTitleX,this.scene.ui.stageInfoTitleY,q,"Lesson Review",ae.fonts.stageInfoTitleSize),this.stageInfoTitle.setOrigin(this.scene.ui.stageInfoTitleOriginX,this.scene.ui.stageInfoTitleOriginY),this.stageInfoTitle.setTintFill(ae.fonts.stageInfoTitleTint),this.stageInfoTitle.setCenterAlign(),e||(this.stageInfoSprites=[],this.stageInfoZombie1=this.scene.add.sprite(this.scene.ui.stageInfoReviewZombie1X,this.scene.ui.stageInfoReviewZombie1Y,W.zombieNormal1),this.stageInfoZombie1.setScale(2.5),this.stageInfoSprites.push(this.stageInfoZombie1),this.stageInfoZombie2=this.scene.add.sprite(this.scene.ui.stageInfoReviewZombie2X,this.scene.ui.stageInfoReviewZombie2Y,W.zombieSpecial1),this.stageInfoZombie2.setScale(2.5),this.stageInfoSprites.push(this.stageInfoZombie2),this.stageInfoZombie3=this.scene.add.sprite(this.scene.ui.stageInfoReviewZombie3X,this.scene.ui.stageInfoReviewZombie3Y,W.zombieNormal3),this.stageInfoZombie3.setScale(2.5),this.stageInfoSprites.push(this.stageInfoZombie3),this.stageInfoZombie4=this.scene.add.sprite(this.scene.ui.stageInfoReviewZombie4X,this.scene.ui.stageInfoReviewZombie4Y,W.zombieNormal5),this.stageInfoZombie4.setScale(2.5),this.stageInfoSprites.push(this.stageInfoZombie4),this.stageInfoZombie5=this.scene.add.sprite(this.scene.ui.stageInfoReviewZombie5X,this.scene.ui.stageInfoReviewZombie5Y,W.zombieSpecial2),this.stageInfoZombie5.setScale(2.5),this.stageInfoSprites.push(this.stageInfoZombie5),t?(this.stageInfoZombie1.setFrame(W.frames.zombieDead),this.stageInfoZombie2.setFrame(W.frames.zombieDead),this.stageInfoZombie3.setFrame(W.frames.zombieDead),this.stageInfoZombie4.setFrame(W.frames.zombieDead),this.stageInfoZombie5.setFrame(W.frames.zombieDead)):(this.stageInfoZombie1.play(Mt(W.zombieNormal1,n.zombieRun)),this.stageInfoZombie1.anims.msPerFrame=100,this.stageInfoZombie2.play(Mt(W.zombieSpecial1,n.zombieRun)),this.stageInfoZombie2.anims.msPerFrame=112,this.stageInfoZombie3.play(Mt(W.zombieNormal3,n.zombieRun)),this.stageInfoZombie3.anims.msPerFrame=88,this.stageInfoZombie4.play(Mt(W.zombieNormal5,n.zombieRun)),this.stageInfoZombie4.anims.msPerFrame=120,this.stageInfoZombie5.play(Mt(W.zombieSpecial2,n.zombieRun)),this.stageInfoZombie5.anims.msPerFrame=90))}},{key:"clearStageInfo",value:function(e){null!=this.stageInfoTitle&&(this.stageInfoTitle.destroy(),this.stageInfoTitle=null),null!=this.stageInfoType&&(this.stageInfoType.destroy(),this.stageInfoType=null),null!=this.stageInfoSubtitle&&(this.stageInfoSubtitle.destroy(),this.stageInfoSubtitle=null),e||null!=this.stageInfoSprites&&(this.stageInfoSprites.forEach((function(e){return e.destroy()})),this.stageInfoSprites=null)}},{key:"shouldMaintainAnimations",value:function(e){return null!=this.currentStageType&&this.scene.sys.game.db.getStage(this.stageId).type===this.currentStageType&&e===this.currentStageCleared}}])&&ja(t.prototype,i),a&&ja(t,a),e}();function Za(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ua=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.mapHelper=new Ga,this.borderGraphics=this.scene.add.graphics(),this.borderGraphics.lineStyle(this.scene.ui.borderWidth,ae.ui.borderColor),this.borderGraphics.fillStyle(ae.ui.borderColor),this.borderGraphics.setDepth(r.townMap.border)}var t,i,a;return t=e,(i=[{key:"initialize",value:function(){this.drawBorder(),this.createText()}},{key:"drawBorder",value:function(){this.borderGraphics.strokeRect(this.scene.ui.instructionsX,this.scene.ui.instructionsY,this.scene.ui.instructionsWidth,this.scene.ui.instructionsHeight),this.mapHelper.drawSquares(this.borderGraphics,this.scene.ui.squareWidth,[[this.scene.ui.instructionsSquareTLX,this.scene.ui.instructionsSquareTLY],[this.scene.ui.instructionsSquareTRX,this.scene.ui.instructionsSquareTRY],[this.scene.ui.instructionsSquareBLX,this.scene.ui.instructionsSquareBLY],[this.scene.ui.instructionsSquareBRX,this.scene.ui.instructionsSquareBRY]])}},{key:"createText",value:function(){this.instructionsText=this.scene.add.bitmapText(this.scene.ui.instructionsTextX,this.scene.ui.instructionsTextY,q,ae.statusMessages.instructions,ae.fonts.instructionsSize),this.instructionsText.setOrigin(this.scene.ui.instructionsTextOriginX,this.scene.ui.instructionsTextOriginY),this.instructionsText.setTintFill(ae.fonts.instructionsTint),this.instructionsText.setCenterAlign()}}])&&Za(t.prototype,i),a&&Za(t,a),e}();function Ka(e){return(Ka="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ja(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Qa(e,t){return!t||"object"!==Ka(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $a(e){return($a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function es(e,t){return(es=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ts=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Qa(this,$a(t).call(this,{key:A.townMap}))}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&es(e,t)}(t,e),i=t,(a=[{key:"init",value:function(){var e,t;this.mapHelper=new Ga,this.ui=(e=this.sys.game.config,{padding:(t=Qt(e)).padding,borderWidth:.005*t.w,squareWidth:.02*t.w,flashLineWidth:.005*t.w,mapGridLineWidth:.0025*t.w,mapX:t.paddingBig,mapY:t.paddingBig,mapWidth:t.w_60p-2*t.paddingBig,mapHeight:t.h_60p-2*t.paddingBig,mapOriginX:t.left,mapOriginY:t.top,get mapSquareTLX(){return this.mapX},get mapSquareTLY(){return this.mapY},get mapSquareTRX(){return this.mapX+this.mapWidth-this.squareWidth},get mapSquareTRY(){return this.mapY},get mapSquareBLX(){return this.mapX},get mapSquareBLY(){return this.mapY+this.mapHeight-this.squareWidth},get mapSquareBRX(){return this.mapX+this.mapWidth-this.squareWidth},get mapSquareBRY(){return this.mapY+this.mapHeight-this.squareWidth},get mapFlashLineLTX(){return this.mapSquareTLX+this.squareWidth/2},get mapFlashLineLBX(){return this.mapSquareBLX+this.squareWidth/2},get mapFlashLineLTY(){return this.mapSquareTLY+this.squareWidth+t.padding},get mapFlashLineLBY(){return this.mapSquareBLY-t.padding},get mapFlashLineRTX(){return this.mapSquareTRX+this.squareWidth/2},get mapFlashLineRBX(){return this.mapSquareBRX+this.squareWidth/2},get mapFlashLineRTY(){return this.mapSquareTRY+this.squareWidth+t.padding},get mapFlashLineRBY(){return this.mapSquareBRY-t.padding},get mapFlashLineTLX(){return this.mapSquareTLX+this.squareWidth+t.padding},get mapFlashLineTRX(){return this.mapSquareTRX-t.padding},get mapFlashLineTLY(){return this.mapSquareTLY+this.squareWidth/2},get mapFlashLineTRY(){return this.mapSquareTRY+this.squareWidth/2},get mapFlashLineBLX(){return this.mapSquareBLX+this.squareWidth+t.padding},get mapFlashLineBRX(){return this.mapSquareBRX-t.padding},get mapFlashLineBLY(){return this.mapSquareBLY+this.squareWidth/2},get mapFlashLineBRY(){return this.mapSquareBRY+this.squareWidth/2},get mapTitleX(){return this.mapX+this.mapWidth/2},get mapTitleY(){return this.mapY+this.squareWidth+t.padding},mapTitleOriginX:t.center,mapTitleOriginY:t.top,get mapLocationX(){return this.mapX+this.mapWidth/2},get mapLocationY(){return this.mapY+this.mapHeight-this.squareWidth-t.padding},mapLocationOriginX:t.center,mapLocationOriginY:t.bottom,get mapGridX(){return this.mapX},get mapGridY(){return this.mapY+.06*t.h},get mapGridWidth(){return this.mapWidth},get mapGridHeight(){return this.mapHeight+this.mapY-this.mapGridY-.06*t.h},mapPinOrigin:t.center,mapSelectorOrigin:t.center,requirementLineWidth:.004*t.w,lessonInfoX:t.paddingBig,get lessonInfoY(){return this.mapY+this.mapHeight+t.paddingBig},lessonInfoWidth:t.w_60p-2*t.paddingBig,get lessonInfoHeight(){return t.h-this.mapHeight-3*t.paddingBig},lessonInfoOriginX:t.left,lessonInfoOriginY:t.top,get lessonInfoSquareTLX(){return this.lessonInfoX},get lessonInfoSquareTLY(){return this.lessonInfoY},get lessonInfoSquareTRX(){return this.lessonInfoX+this.lessonInfoWidth-this.squareWidth},get lessonInfoSquareTRY(){return this.lessonInfoY},get lessonInfoSquareBLX(){return this.lessonInfoX},get lessonInfoSquareBLY(){return this.lessonInfoY+this.lessonInfoHeight-this.squareWidth},get lessonInfoSquareBRX(){return this.lessonInfoX+this.lessonInfoWidth-this.squareWidth},get lessonInfoSquareBRY(){return this.lessonInfoY+this.lessonInfoHeight-this.squareWidth},get lessonInfoTitleX(){return this.lessonInfoX+this.lessonInfoWidth/2},get lessonInfoTitleY(){return this.lessonInfoY+this.squareWidth+t.padding},lessonInfoTitleOriginX:t.center,lessonInfoTitleOriginY:t.top,get lessonInfoTextX(){return this.lessonInfoX+t.paddingBig},get lessonInfoTextY(){return this.lessonInfoY+.09*t.h},lessonInfoTextOriginX:t.left,lessonInfoTextOriginY:t.top,get stageX(){return this.mapX+this.mapWidth+t.paddingBig},stageY:t.paddingBig,get stageWidth(){return t.w-this.mapWidth-3*t.paddingBig},get stageHeight(){return this.mapHeight/3},stageOriginX:t.left,stageOriginY:t.top,get stageSquareTLX(){return this.stageX},get stageSquareTLY(){return this.stageY},get stageSquareTRX(){return this.stageX+this.stageWidth-this.squareWidth},get stageSquareTRY(){return this.stageY},get stageSquareBLX(){return this.stageX},get stageSquareBLY(){return this.stageY+this.stageHeight-this.squareWidth},get stageSquareBRX(){return this.stageX+this.stageWidth-this.squareWidth},get stageSquareBRY(){return this.stageY+this.stageHeight-this.squareWidth},get stageFlashLineLTX(){return this.stageSquareTLX+this.squareWidth/2},get stageFlashLineLBX(){return this.stageSquareBLX+this.squareWidth/2},get stageFlashLineLTY(){return this.stageSquareTLY+this.squareWidth+t.padding},get stageFlashLineLBY(){return this.stageSquareBLY-t.padding},get stageFlashLineRTX(){return this.stageSquareTRX+this.squareWidth/2},get stageFlashLineRBX(){return this.stageSquareBRX+this.squareWidth/2},get stageFlashLineRTY(){return this.stageSquareTRY+this.squareWidth+t.padding},get stageFlashLineRBY(){return this.stageSquareBRY-t.padding},get stageFlashLineTLX(){return this.stageSquareTLX+this.squareWidth+t.padding},get stageFlashLineTRX(){return this.stageSquareTRX-t.padding},get stageFlashLineTLY(){return this.stageSquareTLY+this.squareWidth/2},get stageFlashLineTRY(){return this.stageSquareTRY+this.squareWidth/2},get stageFlashLineBLX(){return this.stageSquareBLX+this.squareWidth+t.padding},get stageFlashLineBRX(){return this.stageSquareBRX-t.padding},get stageFlashLineBLY(){return this.stageSquareBLY+this.squareWidth/2},get stageFlashLineBRY(){return this.stageSquareBRY+this.squareWidth/2},get stageTitleX(){return this.stageX+this.stageWidth/2},get stageTitleY(){return this.stageY+this.squareWidth+t.padding},stageTitleOriginX:t.center,stageTitleOriginY:t.top,get stageDotY(){return this.stageY+.6*this.stageHeight},stageDotWidth:t.w_5p,stageReviewDotWidth:.065*t.w,stageDotSpaceWidth:.058*t.w,stageDotOriginX:t.left,stageDotOriginY:t.center,get stageSelectorWidth(){return this.stageDotSpaceWidth},get stageSelectorReviewWidth(){return.075*t.w},get stageSelectorXBuffer(){return(this.stageSelectorWidth-this.stageDotWidth)/2},get stageInfoX(){return this.mapX+this.mapWidth+t.paddingBig},get stageInfoY(){return this.stageY+this.stageHeight+t.paddingBig},get stageInfoWidth(){return t.w-this.mapWidth-3*t.paddingBig},get stageInfoHeight(){return this.mapHeight-this.stageHeight-t.paddingBig},stageInfoOriginX:t.left,stageInfoOriginY:t.top,get stageInfoSquareTLX(){return this.stageInfoX},get stageInfoSquareTLY(){return this.stageInfoY},get stageInfoSquareTRX(){return this.stageInfoX+this.stageInfoWidth-this.squareWidth},get stageInfoSquareTRY(){return this.stageInfoY},get stageInfoSquareBLX(){return this.stageInfoX},get stageInfoSquareBLY(){return this.stageInfoY+this.stageInfoHeight-this.squareWidth},get stageInfoSquareBRX(){return this.stageInfoX+this.stageInfoWidth-this.squareWidth},get stageInfoSquareBRY(){return this.stageInfoY+this.stageInfoHeight-this.squareWidth},get stageInfoTitleX(){return this.stageInfoX+this.stageInfoWidth/2},get stageInfoTitleY(){return this.stageInfoY+this.squareWidth+t.padding},stageInfoTitleOriginX:t.center,stageInfoTitleOriginY:t.top,get stageInfoTypeX(){return this.stageInfoX+this.stageInfoWidth/2},get stageInfoTypeY(){return this.stageInfoY+.075*t.h},stageInfoTypeOriginX:t.center,stageInfoTypeOriginY:t.top,get stageInfoSubtitleX(){return this.stageInfoX+this.stageInfoWidth/2},get stageInfoSubtitleY(){return this.stageInfoY+.14*t.h},stageInfoSubtitleOriginX:t.center,stageInfoSubtitleOriginY:t.top,get stageInfoZombie1X(){return this.stageInfoX+this.stageInfoWidth/2},get stageInfoZombie1Y(){return this.stageInfoY+.8*this.stageInfoHeight},get stageInfoZombie2X(){return this.stageInfoX+.2*this.stageInfoWidth},get stageInfoZombie2Y(){return this.stageInfoY+.64*this.stageInfoHeight},get stageInfoZombie3X(){return this.stageInfoX+.8*this.stageInfoWidth},get stageInfoZombie3Y(){return this.stageInfoY+.72*this.stageInfoHeight},get stageInfoReviewZombie1X(){return this.stageInfoX+.15*this.stageInfoWidth},get stageInfoReviewZombie1Y(){return this.stageInfoY+.65*this.stageInfoHeight},get stageInfoReviewZombie2X(){return this.stageInfoX+.33*this.stageInfoWidth},get stageInfoReviewZombie2Y(){return this.stageInfoY+.81*this.stageInfoHeight},get stageInfoReviewZombie3X(){return this.stageInfoX+.47*this.stageInfoWidth},get stageInfoReviewZombie3Y(){return this.stageInfoY+.59*this.stageInfoHeight},get stageInfoReviewZombie4X(){return this.stageInfoX+.62*this.stageInfoWidth},get stageInfoReviewZombie4Y(){return this.stageInfoY+.78*this.stageInfoHeight},get stageInfoReviewZombie5X(){return this.stageInfoX+.83*this.stageInfoWidth},get stageInfoReviewZombie5Y(){return this.stageInfoY+.69*this.stageInfoHeight},get instructionsX(){return this.lessonInfoX+this.lessonInfoWidth+t.paddingBig},get instructionsY(){return this.stageInfoY+this.stageInfoHeight+t.paddingBig},get instructionsWidth(){return t.w-this.mapWidth-3*t.paddingBig},get instructionsHeight(){return t.h-this.instructionsY-t.paddingBig},instructionsOriginX:t.left,instructionsOriginY:t.top,get instructionsSquareTLX(){return this.instructionsX},get instructionsSquareTLY(){return this.instructionsY},get instructionsSquareTRX(){return this.instructionsX+this.instructionsWidth-this.squareWidth},get instructionsSquareTRY(){return this.instructionsY},get instructionsSquareBLX(){return this.instructionsX},get instructionsSquareBLY(){return this.instructionsY+this.instructionsHeight-this.squareWidth},get instructionsSquareBRX(){return this.instructionsX+this.instructionsWidth-this.squareWidth},get instructionsSquareBRY(){return this.instructionsY+this.instructionsHeight-this.squareWidth},get instructionsTextX(){return this.instructionsX+this.instructionsWidth/2},get instructionsTextY(){return this.instructionsY+this.instructionsHeight/2},instructionsTextOriginX:t.center,instructionsTextOriginY:t.center}),this.mapManager=new Aa(this),this.lessonInfoManager=new qa(this),this.stageSelectManager=new Va(this),this.stageInfoManager=new Na(this),this.instructionsManager=new Ua(this),this.progressManager=new ui(this.sys.game.db),this.modalChecker=new Ii(this),this.modalHelper=new wi(this),this.audioManager=new Li(this),this.selectState="lesson-select"}},{key:"create",value:function(){this.createMap(),this.createLessonInfo(),this.createStageSelect(),this.createStageInfo(),this.createInstructions(),this.createAudio(),this.audioManager.playMusic(),this.setSelectedPosition(),this.checkStartModal()}},{key:"createMap",value:function(){this.mapManager.initialize(),this.mapManager.setLessonChangedCallback(this.lessonChanged),this.mapManager.setLessonSelectedCallback(this.lessonSelected),this.mapManager.setCancelCallback(this.lessonSelectCancelled)}},{key:"createLessonInfo",value:function(){this.lessonInfoManager.initialize()}},{key:"createStageSelect",value:function(){this.stageSelectManager.initialize(),this.stageSelectManager.setStageChangedCallback(this.stageChanged),this.stageSelectManager.setStageSelectedCallback(this.stageSelected),this.stageSelectManager.setCancelCallback(this.stageSelectCancelled)}},{key:"createStageInfo",value:function(){this.stageInfoManager.initialize()}},{key:"createInstructions",value:function(){this.instructionsManager.initialize()}},{key:"createAudio",value:function(){var e=this;this.audioManager.setMusic(ae.audio.music.backgroundMusic),Ct(Object.values(ae.audio.soundEffects)).forEach((function(t){return e.audioManager.addSound(t)}))}},{key:"setSelectedPosition",value:function(){var e=this.progressManager.getMapPosition();if(null!=e){this.mapManager.setLesson(e.lesson);var t=this.mapManager.getLessonId();if(this.lessonInfoManager.setLesson(t),this.stageSelectManager.setLesson(t),null!=e.stage){this.stageSelectManager.setStage(e.stage);var i=this.stageSelectManager.getStageNumber();this.stageInfoManager.setStage(e.stage,i),this.assignControl("stage-select")}else this.stageSelectManager.resetStage(),this.assignControl("lesson-select")}else this.mapManager.resetLesson()}},{key:"disableInputHandling",value:function(){this.stageSelectManager.disableInputHandling(),this.mapManager.disableInputHandling()}},{key:"assignControl",value:function(e){this.selectState=e,"lesson-select"===e?(this.disableStageSelect(),this.enableLessonSelect()):"stage-select"===e&&(this.disableLessonSelect(),this.enableStageSelect())}},{key:"disableLessonSelect",value:function(){this.mapManager.disable()}},{key:"disableStageSelect",value:function(){this.stageSelectManager.disable(),this.stageInfoManager.disable()}},{key:"enableLessonSelect",value:function(){this.mapManager.enable()}},{key:"enableStageSelect",value:function(){this.stageSelectManager.enable(),this.stageInfoManager.enable()}},{key:"checkStartModal",value:function(){var e=this;this.modalChecker.setBeforeStartCallback((function(){e.disableInputHandling()})),this.modalChecker.setCompletedCallback((function(){e.assignControl(e.selectState)})),this.modalChecker.checkModal()}},{key:"createStageSelectedModal",value:function(e){var t=this;this.disableInputHandling();var i=e?ae.choiceModals.clearedStageSelected.text:ae.choiceModals.stageSelected.text;this.stageModal=new Xa(this,i,ae.choiceModals.stageSelected.choices),this.stageModal.draw(),this.stageModal.enableInputHandling(),this.stageModal.setCloseCallback((function(e){t.stageModal.disableInputHandling(),0===e?t.nextScreen=A.minigame:1===e&&(t.nextScreen=A.vocabStudy),t.nextScreen!==A.minigame||t.progressManager.isModalSeen("vocab-study-intro")?t.cameras.main.fade(ae.screenFadeTime,0,0,0,!1,t.stageSelectedFadeCallback):t.createFirstLessonStartLockedModal()})),this.stageModal.setCancelCallback((function(){t.audioManager.playSound(ae.audio.soundEffects.stageSelectedModalBackout),t.stageModal.disableInputHandling(),t.stageModal.close(),t.stageSelectManager.enableInputHandling()}))}},{key:"createReviewStageSelectedModal",value:function(e){var t=this;this.disableInputHandling();var i=e?ae.choiceModals.clearedReviewStageSelected.text:ae.choiceModals.reviewStageSelected.text;this.stageModal=new Xa(this,i,ae.choiceModals.reviewStageSelected.choices),this.stageModal.draw(),this.stageModal.enableInputHandling(),this.stageModal.setCloseCallback((function(e){t.stageModal.disableInputHandling(),0===e&&(t.nextScreen=A.minigame),t.cameras.main.fade(ae.screenFadeTime,0,0,0,!1,t.stageSelectedFadeCallback)})),this.stageModal.setCancelCallback((function(){t.stageModal.disableInputHandling(),t.stageModal.close(),t.stageSelectManager.enableInputHandling()}))}},{key:"stageChanged",value:function(e,t){this.stageInfoManager.setStage(e,t)}},{key:"stageSelected",value:function(e){var t=this.progressManager.getStageType(e),i=this.progressManager.isStageCompleted(e),a=this.progressManager.isStageUnlocked(e);t!==se.zombieAssaultReview?a?(this.audioManager.playSound(ae.audio.soundEffects.stageSelect),this.createStageSelectedModal(i)):this.createStageLockedModal():a?(this.audioManager.playSound(ae.audio.soundEffects.stageSelect),this.createReviewStageSelectedModal(i)):this.createStageLockedModal()}},{key:"createStageLockedModal",value:function(){var e=this;this.disableInputHandling(),this.audioManager.playSound(ae.audio.soundEffects.stageLockedModal);var t=this.modalHelper.getModalConfig("stage-locked");this.stageLockedModal=new Si(this,t.text),this.stageLockedModal.draw(),this.stageLockedModal.setCloseCallback((function(){e.audioManager.playSound(ae.audio.soundEffects.stageLockedModalBackout),e.assignControl("stage-select")}))}},{key:"createLessonLockedModal",value:function(){var e=this;this.disableInputHandling(),this.audioManager.playSound(ae.audio.soundEffects.lessonLockedModal);var t=this.modalHelper.getModalConfig("lesson-locked");this.lessonLockedModal=new Si(this,t.text),this.lessonLockedModal.draw(),this.lessonLockedModal.setCloseCallback((function(){e.audioManager.playSound(ae.audio.soundEffects.lessonLockedModalBackout),e.assignControl("lesson-select")}))}},{key:"createFirstLessonSelectedModal",value:function(){var e=this;this.disableInputHandling();var t=this.modalHelper.getModalConfig("stage-select-intro");this.firstLessonModal=new Si(this,t.text),this.firstLessonModal.draw(),this.firstLessonModal.setCloseCallback((function(){e.assignControl("stage-select")}))}},{key:"createFirstLessonStartLockedModal",value:function(){var e=this;this.disableInputHandling();var t=this.modalHelper.getModalConfig("first-stage-game-locked");this.startLockedModal=new Si(this,t.text),this.startLockedModal.draw(),this.startLockedModal.setCloseCallback((function(){e.createStageSelectedModal(!1)}))}},{key:"stageSelectCancelled",value:function(){this.audioManager.playSound(ae.audio.soundEffects.stageSelectBackout),this.assignControl("lesson-select")}},{key:"lessonChanged",value:function(e){var t=this.mapManager.isLessonVisible(e);null!=e&&t?(this.lessonInfoManager.setLesson(e),this.stageSelectManager.setLesson(e)):(this.lessonInfoManager.clear(),this.stageSelectManager.clear())}},{key:"lessonSelected",value:function(e){null!=e&&(this.progressManager.isLessonLocked(e)?this.createLessonLockedModal():(this.audioManager.playSound(ae.audio.soundEffects.mapGridSelect),this.stageSelectManager.setLesson(e),this.stageInfoManager.setStage(this.stageSelectManager.getStageId(),this.stageSelectManager.getStageNumber()),this.progressManager.isNewGame()?this.createFirstLessonSelectedModal():this.assignControl("stage-select")))}},{key:"lessonSelectCancelled",value:function(){this.audioManager.playSound(ae.audio.soundEffects.lessonSelectBackout),this.cameras.main.fade(ae.screenFadeTime,0,0,0,!1,this.lessonSelectCanceledFadeCallback)}},{key:"lessonSelectCanceledFadeCallback",value:function(e,t){this.audioManager.setMusicVolume(1-t),1===t&&this.scene.start(A.titleMenu)}},{key:"stageSelectedFadeCallback",value:function(e,t){if(this.audioManager.setMusicVolume(1-t),1===t){var i=this.mapManager.getLessonId(),a=this.stageSelectManager.getStageId();this.progressManager.saveMapPosition(i,a),this.audioManager.stopMusic(),this.scene.start(this.nextScreen,a)}}}])&&Ja(i.prototype,a),s&&Ja(i,s),t}(s.a.Scene);function is(e){return(is="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function as(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ss(e,t){return!t||"object"!==is(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ns(e){return(ns=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function os(e,t){return(os=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rs=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ss(this,ns(t).call(this,{key:A.story}))}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&os(e,t)}(t,e),i=t,(a=[{key:"init",value:function(e){if(null==e.modalConfig||null==e.nextScreen)throw Error("Story screen requires modalConfig and nextScreen init params");this.audioManager=new Li(this),this.modalConfig=e.modalConfig,this.nextScreen=e.nextScreen}},{key:"create",value:function(){var e,t;this.ui=(e=this.sys.game.config,{backgroundImageX:0,backgroundImageY:0,backgroundImageWidth:(t=Qt(e)).w,backgroundImageHeight:t.h,backgroundImageOriginX:t.left,backgroundImageOriginY:t.top}),this.createBackground(),this.createAudio(),this.createModal(),this.audioManager.playMusic()}},{key:"createBackground",value:function(){this.background=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.storyScreenBackground),this.background.displayWidth=this.ui.backgroundImageWidth,this.background.displayHeight=this.ui.backgroundImageHeight,this.background.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY),this.background.setDepth(r.story.background)}},{key:"createAudio",value:function(){this.audioManager.setMusic(pt.audio.backgroundMusic)}},{key:"createModal",value:function(){var e=this;this.modal=new Si(this,this.modalConfig.text,!1),this.modal.draw(),this.modal.setCloseCallback((function(){e.cameras.main.fade(pt.screenFadeTime,0,0,0,!1,e.fadeCallback)}))}},{key:"fadeCallback",value:function(e,t){this.audioManager.setMusicVolume(1-t),1===t&&(this.audioManager.stopMusic(),this.scene.start(this.nextScreen))}}])&&as(i.prototype,a),s&&as(i,s),t}(s.a.Scene);function ls(e){return(ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hs(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function us(e,t){return!t||"object"!==ls(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cs(e){return(cs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ds(e,t){return(ds=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gs=[vt.values.on,vt.values.off],ms=[vt.values.on,vt.values.off],ps=[vt.values.normal,vt.values.large],fs=[vt.values.red,vt.values.green,vt.values.off],bs=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),us(this,cs(t).call(this,{key:A.optionsMenu}))}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ds(e,t)}(t,e),i=t,(a=[{key:"init",value:function(){this.userOptionsManager=new Gt(this.sys.game),this.audioManager=new Li(this),this.selectedOption=0,this.menuOptions=[{key:vt.music,label:yt.labels.music,values:gs},{key:vt.soundEffects,label:yt.labels.soundEffects,values:ms},{key:vt.textSize,label:yt.labels.textSize,values:ps},{key:vt.blood,label:yt.labels.blood,values:fs}]}},{key:"create",value:function(){var e,t;this.ui=(e=this.sys.game.config,{backgroundImageX:0,backgroundImageY:0,backgroundImageWidth:(t=Qt(e)).w,backgroundImageHeight:t.h,backgroundImageOriginX:t.left,backgroundImageOriginY:t.top,menuHorizontalPadding:t.w_5p,get menuLabelBaseX(){return t.w_2-this.menuHorizontalPadding},get menuValueBaseX(){return t.w_2+this.menuHorizontalPadding},menuBaseY:t.h_25p,menuVerticalPadding:t.h_10p,menuLabelOriginX:t.right,menuLabelOriginY:t.top,menuValueOriginX:t.left,menuValueOriginY:t.top,menuValueHorizontalPadding:.03*t.w,returnOptionX:t.w_2,returnOptionOriginX:t.center,returnOptionOriginY:t.top,returnOptionVerticalPadding:t.h_10p,selectorPadding:t.padding,selectorWidth:.01*t.h}),this.loadUserOptions(),this.createGraphics(),this.createBackground(),this.createMenu(),this.createOptionSelector(),this.createAllValueSelectors(),this.createInput(),this.createAudio(),this.audioManager.playMusic()}},{key:"createAudio",value:function(){this.audioManager.setMusic(yt.audio.backgroundMusic),this.audioManager.addSound(yt.audio.menuMove)}},{key:"createBackground",value:function(){this.background=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.storyScreenBackground),this.background.displayWidth=this.ui.backgroundImageWidth,this.background.displayHeight=this.ui.backgroundImageHeight,this.background.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY),this.background.setDepth(r.optionsMenu.background)}},{key:"createGraphics",value:function(){var e=this;this.optionSelectorGraphics=this.add.graphics(),this.optionSelectorGraphics.setDepth(r.optionsMenu.selector),this.selectedValues.forEach((function(t){var i=e.add.graphics();i.setDepth(r.optionsMenu.selector),t.graphics=i}))}},{key:"createMenu",value:function(){var e=this;this.menuStates=[],this.menuOptions.forEach((function(t,i){var a=e.ui.menuBaseY+e.ui.menuVerticalPadding*i,s=e.add.bitmapText(e.ui.menuLabelBaseX,a,q,t.label,yt.fonts.labelSize);s.setOrigin(e.ui.menuLabelOriginX,e.ui.menuLabelOriginY),s.setDepth(r.optionsMenu.text),s.setTintFill(yt.fonts.labelTint);var n=[],o=0;t.values.forEach((function(t){var a=e.ui.menuValueBaseX+o,s=e.ui.menuBaseY+e.ui.menuVerticalPadding*i,l=e.add.bitmapText(a,s,q,t,yt.fonts.optionSize);l.setOrigin(e.ui.menuValueOriginX,e.ui.menuValueOriginY),l.setDepth(r.optionsMenu.text),l.setTintFill(yt.fonts.optionTint);var h=l.getTextBounds().global;o+=h.width+e.ui.menuValueHorizontalPadding,n.push(l)}));var l={key:t.key,label:s,values:n};e.menuStates.push(l)}));var t=this.ui.menuBaseY+this.ui.menuVerticalPadding*this.menuOptions.length+this.ui.returnOptionVerticalPadding,i=this.add.bitmapText(this.ui.returnOptionX,t,q,yt.labels.return,yt.fonts.labelSize);i.setOrigin(this.ui.returnOptionOriginX,this.ui.returnOptionOriginY),i.setDepth(r.optionsMenu.text),i.setTintFill(yt.fonts.labelTint),this.menuStates.push({key:"return",label:i})}},{key:"loadUserOptions",value:function(){var e=this;this.selectedValues=[{key:vt.music},{key:vt.soundEffects},{key:vt.textSize},{key:vt.blood}],this.selectedValues.forEach((function(t){var i=e.userOptionsManager.getOptionValue(t.key),a=e.menuOptions.find((function(e){return e.key===t.key})).values.findIndex((function(e){return e===i}));t.selectedIndex=a,t.value=i}))}},{key:"createInput",value:function(){this.keys=this.input.keyboard.addKeys("SPACE,ENTER,UP,DOWN,LEFT,RIGHT,TAB"),this.input.keyboard.on("keydown",this.handleKeyDown,this)}},{key:"handleKeyDown",value:function(e){e.keyCode===this.keys.UP.keyCode?this.decrementOptionSelection():e.keyCode===this.keys.DOWN.keyCode?this.incrementOptionSelection():e.keyCode===this.keys.RIGHT.keyCode?this.incrementValueSelection():e.keyCode===this.keys.LEFT.keyCode?this.decrementValueSelection():e.keyCode!==this.keys.SPACE.keyCode&&e.keyCode!==this.keys.ENTER.keyCode||this.optionSelected()}},{key:"decrementOptionSelection",value:function(){this.selectedOption=Math.max(this.selectedOption-1,0),this.playMenuMove(),this.createOptionSelector()}},{key:"incrementOptionSelection",value:function(){this.selectedOption=Math.min(this.selectedOption+1,this.menuStates.length-1),this.playMenuMove(),this.createOptionSelector()}},{key:"decrementValueSelection",value:function(){var e=this.menuStates[this.selectedOption],t=this.selectedValues.find((function(t){return t.key===e.key}));t.selectedIndex=Math.max(t.selectedIndex-1,0),t.value=e.values[t.selectedIndex].text,this.playMenuMove(),e.key===vt.music&&this.setMusicState(),this.createValueSelector(e.key)}},{key:"incrementValueSelection",value:function(){var e=this.menuStates[this.selectedOption],t=this.selectedValues.find((function(t){return t.key===e.key}));t.selectedIndex=Math.min(t.selectedIndex+1,e.values.length-1),t.value=e.values[t.selectedIndex].text,this.playMenuMove(),e.key===vt.music&&this.setMusicState(),this.createValueSelector(e.key)}},{key:"clearOptionSelector",value:function(){this.optionSelectorGraphics.clear()}},{key:"createOptionSelector",value:function(){this.clearOptionSelector();var e=this.menuStates[this.selectedOption].label.getTextBounds().global,t=e.x,i=e.x+e.width,a=e.y+e.height+this.ui.selectorPadding,s=a;this.optionSelectorGraphics.lineStyle(this.ui.selectorWidth,yt.ui.optionSelectorColor),this.optionSelectorGraphics.beginPath(),this.optionSelectorGraphics.moveTo(t,a),this.optionSelectorGraphics.lineTo(i,s),this.optionSelectorGraphics.closePath(),this.optionSelectorGraphics.strokePath()}},{key:"clearAllValueSelectors",value:function(){var e=this;this.menuOptions.forEach((function(t){return e.clearValueSelector(t.key)}))}},{key:"createAllValueSelectors",value:function(){var e=this;this.menuOptions.forEach((function(t){return e.createValueSelector(t.key)}))}},{key:"clearValueSelector",value:function(e){this.selectedValues.find((function(t){return t.key===e})).graphics.clear()}},{key:"createValueSelector",value:function(e){this.clearValueSelector(e);var t=this.menuStates.find((function(t){return t.key===e})),i=this.selectedValues.find((function(t){return t.key===e})),a=t.values.find((function(e){return e.text===i.value})).getTextBounds().global,s=a.x,n=a.x+a.width,o=a.y+a.height+this.ui.selectorPadding,r=o;i.graphics.lineStyle(this.ui.selectorWidth,yt.ui.valueSelectorColor),i.graphics.beginPath(),i.graphics.moveTo(s,o),i.graphics.lineTo(n,r),i.graphics.closePath(),i.graphics.strokePath()}},{key:"optionSelected",value:function(){var e=this;"return"===this.getSelectedOptionKey()&&this.userOptionsManager.setOptions(this.selectedValues,(function(){e.cameras.main.fade(yt.screenFadeTime,0,0,0,!1,e.fadeCallback)}))}},{key:"getSelectedOptionKey",value:function(){return this.menuStates[this.selectedOption].key}},{key:"fadeCallback",value:function(e,t){this.audioManager.setMusicVolume(1-t),1===t&&(this.audioManager.stopMusic(),this.scene.start(A.titleMenu))}},{key:"setMusicState",value:function(){var e=this.selectedValues.find((function(e){return e.key===vt.music})).value;e===vt.values.on?this.audioManager.playMusic(!0):e===vt.values.off&&this.audioManager.pauseMusic()}},{key:"playMenuMove",value:function(){this.selectedValues.find((function(e){return e.key===vt.soundEffects})).value===vt.values.on&&this.audioManager.playSound(yt.audio.menuMove,!0)}}])&&hs(i.prototype,a),s&&hs(i,s),t}(s.a.Scene);function ys(e){return(ys="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vs(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ws(e,t){return!t||"object"!==ys(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ks(e){return(ks=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ss(e,t){return(Ss=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ts=["",".","..","..."],Is=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ws(this,ks(t).call(this,{key:A.registration}))}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ss(e,t)}(t,e),i=t,(a=[{key:"create",value:function(){var e,t;this.ellipsesStateIndex=0,this.ui=(e=this.sys.game.config,{backgroundImageX:0,backgroundImageY:0,backgroundImageWidth:(t=Qt(e)).w,backgroundImageHeight:t.h,backgroundImageOriginX:t.left,backgroundImageOriginY:t.top,loadingLabelX:t.w_2,loadingLabelY:t.h_2,loadingLabelOriginX:t.left,loadingLabelOriginY:t.center}),this.createBackground(),this.createText(),this.checkRegistration()}},{key:"createBackground",value:function(){this.background=this.add.sprite(this.ui.backgroundImageX,this.ui.backgroundImageY,W.titleScreenBackground),this.background.displayWidth=this.ui.backgroundImageWidth,this.background.displayHeight=this.ui.backgroundImageHeight,this.background.setOrigin(this.ui.backgroundImageOriginX,this.ui.backgroundImageOriginY),this.background.setDepth(r.registration.background)}},{key:"createText",value:function(){var e=this;this.loadingLabel=this.add.bitmapText(0,this.ui.loadingLabelY,q,kt,Tt.loadingSize);var t=this.loadingLabel.getTextBounds().global;this.loadingLabel.x=this.ui.loadingLabelX-t.width/2,this.loadingLabel.setOrigin(this.ui.loadingLabelOriginX,this.ui.loadingLabelOriginY),this.loadingLabel.setDepth(r.registration.text),this.loadingLabel.setTintFill(Tt.loadingTint),this.time.addEvent({loop:!0,delay:St,callbackScope:this,callback:function(){e.ellipsesStateIndex+=1,e.ellipsesStateIndex>=Ts.length&&(e.ellipsesStateIndex=0),e.loadingLabel.text=kt+Ts[e.ellipsesStateIndex]}})}},{key:"checkRegistration",value:function(){var e=this;this.time.addEvent({loop:!0,delay:wt,callbackScope:this,callback:function(){e.sys.game.db.loadUserProfile((function(t){t!==Vi&&e.sys.game.web.restartGame()}),e)}})}}])&&vs(i.prototype,a),s&&vs(i,s),t}(s.a.Scene),xs=i(160);function Os(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ms=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=ri.firestore(),this.lessonsLoaded=!1,this.stagesLoaded=!1,this.userProfileLoaded=!1}var t,i,a;return t=e,(i=[{key:"isFullyLoaded",value:function(){return this.lessonsLoaded&&this.stagesLoaded&&(this.userProfileLoaded||!this.isUserLoggedIn())}},{key:"loadLessons",value:function(e,t){var i=this;this.db.collection("lessons").get().then((function(a){i.lessons=a,i.lessonsLoaded=!0,null!=e&&e.call(t)}))}},{key:"loadStages",value:function(e,t){var i=this;this.db.collection("stages").get().then((function(a){i.stages=a,i.stagesLoaded=!0,null!=e&&e.call(t)}))}},{key:"loadUserProfile",value:function(e,t){var i=this;this.isUserLoggedIn()?this.db.collection("users").doc(this.getCurrentUserId()).get().then((function(a){null==a.data()?null!=e&&e.call(t,Vi):(i.userProfile=a.data(),i.userProfileLoaded=!0,null!=e&&e.call(t,_i))})):null!=e&&e.call(t,qi)}},{key:"getLesson",value:function(e){if(this.lessonsLoaded){var t=this.lessons.docs.find((function(t){return t.id===e}));if(null!=t){var i=t.data();return i.id=t.id,i}throw Error("lesson with id ".concat(e," was not found in the database."))}throw Error("lessons have not been loaded. Call loadLessons() first")}},{key:"getStage",value:function(e){if(this.stagesLoaded){var t=this.stages.docs.find((function(t){return t.id===e}));if(null!=t)return t.data();throw Error("stage with id ".concat(e," was not found in the database."))}throw Error("stages have not been loaded. Call loadStages() first")}},{key:"getLessonForStage",value:function(e){if(this.lessonsLoaded&&this.stagesLoaded){var t=this.lessons.docs.find((function(t){return t.data().stages.includes(e)})),i=t.data();return i.id=t.id,i}throw Error("stages or lessons not loaded. Call loadLessons() and loadStages() first.")}},{key:"isUserLoggedIn",value:function(){return null!=this.getCurrentUser()}},{key:"getCurrentUser",value:function(){return ri.auth().currentUser}},{key:"getCurrentUserId",value:function(){var e=this.getCurrentUser();return null!=e?e.uid:null}},{key:"getCurrentUserProfile",value:function(){return null!=this.getCurrentUserId()?this.db.collection("users").doc(this.getCurrentUserId()):null}}])&&Os(t.prototype,i),a&&Os(t,a),e}(),Ps={ui:{callbacks:{signInSuccessWithAuthResult:function(){return!1},uiShown:function(){document.getElementById("auth-loader").style.display="none"}},signInOptions:[{provider:ri.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1}],credentialHelper:xs.a.CredentialHelper.NONE},firestore:{apiKey:"AIzaSyBKU1fuptRd7xOx0UQAITKDtztQUhpyVD0",authDomain:"dead-language.firebaseapp.com",databaseURL:"https://dead-language.firebaseio.com",projectId:"dead-language",storageBucket:"dead-language.appspot.com",messagingSenderId:"352281236042",appId:"1:352281236042:web:85411d0ca6d5ae39"}};function Bs(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ws=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.phaserConfig=t}var t,i,a;return t=e,(i=[{key:"initializeFirebase",value:function(){ri.initializeApp(Ps.firestore),this.authUi=new xs.a.AuthUI(ri.auth()),this.authUi.start("#firebaseui-auth-container",Ps.ui)}},{key:"setupCallbacks",value:function(){var e=this;ri.auth().onAuthStateChanged((function(t){t?(e.showUserProfileUi(t),e.hideMoreInfo(),e.authUi.reset(),e.restartGame()):(e.showLoginUi(),e.authUi.start("#firebaseui-auth-container",Ps.ui),e.restartGame())})),document.getElementById("sign-out-button").addEventListener("click",(function(){ri.auth().signOut().then((function(){return e.showLoginUi()}))})),document.getElementById("modal-toggle").addEventListener("change",(function(){this.checked?(document.getElementsByName("email")[0].focus(),window.game.input.keyboard.enabled=!1):window.game.input.keyboard.enabled=!0}))}},{key:"createGame",value:function(){window.game=new s.a.Game(this.phaserConfig),window.game.db=new Ms,window.game.web=this,window.game.fullyLoaded=!1}},{key:"restartGame",value:function(){var e=this;null!=window.game?(window.game.events.addListener("destroy",(function(){return e.createGame()})),window.game.destroy(!0)):this.createGame()}},{key:"showLoginUi",value:function(){document.getElementById("sign-in-modal").style.display="inline-block",document.getElementById("modal-toggle").checked=!1,document.getElementById("user-info").style.display="none"}},{key:"showUserProfileUi",value:function(e){document.getElementById("sign-in-modal").style.display="none",document.getElementById("user-info").style.display="inline-block",document.getElementById("username").innerHTML=e.email}},{key:"hideMoreInfo",value:function(){document.getElementById("more-info-container").style.display="none"}}])&&Bs(t.prototype,i),a&&Bs(t,a),e}())({type:s.a.AUTO,parent:"game-container",width:800,height:600,pixelArt:!0,scene:[Ji,aa,pa,Di,ka,Ea,ts,rs,bs,Is]});Ws.initializeFirebase(),Ws.setupCallbacks()},539:
/*!**************************!*\
  !*** multi ./js/main.js ***!
  \**************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=i(/*! /Users/seth/Development/Projects/dead-language/js/main.js */1443)}});